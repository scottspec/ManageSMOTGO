/*!
* Data Aquarium Framework - Classic UI
* Copyright 2008-2019 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function ct(n){return parseInt(n,10)}Type.registerNamespace("Web");var r=window,k=$(r),pt=$(document),p=r.Web,d=Sys.Application,n=$app,st=Sys.Serialization.JavaScriptSerializer,rt=st.serialize,u=Sys.Browser,lt=Sys.CultureInfo.CurrentCulture.dateTimeFormat,t=p.DataViewResources,c=p.MembershipResources,e=Web.DataViewResources.Data,nt=e.Filters,b=nt.Labels,o=t.HeaderFilter,w=t.ModalPopup,l=t.Pager,at=t.Mobile,wt=at.Files,ut=t.Validator,vt=t.Actions.Scopes,a=t.Grid,ht=a.PerformAdvancedSearch,it=b.Clear,h=e.NullValueInForms,tt=e.NullValue,g,bt=vt.Form.Update.WhenLastCommandName.BatchEdit,yt,ft,s,et,ot,y;et={updateSummary:function(){var n,f,i,v,u,c,l,e,o,a,h;if(this.get_showInSummary()&&!s&&(n=null,this._summaryId||(f=$getSideBar(),f?(this._summaryId="PageSummary_"+this.get_id(),n=$get("PageSummaryBox"),n||(n=document.createElement("div"),n.id="PageSummaryBox",n.className="TaskBox Summary",n.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}<\/div><\/div>',t.Menu.Summary),f.insertBefore(n,f.childNodes[f._hasActivators?1:0]),n._numberOfVisibleSummaries=0),i=$get(this._summaryId),i||(i=document.createElement("div"),i.id=this._summaryId,n.childNodes[0].appendChild(i))):this._summaryId=""),this._summaryId)){if(n||(n=$get("PageSummaryBox")),!this._rows||this._rows.length==0){this._filterSource||Sys.UI.DomElement.setVisible(n,!1);return}v=this.get_selectedRow();i=$get(this._summaryId);var r=new Sys.StringBuilder,y=this._lastCommandName,p=this.get_view().Type;if(this.get_view().Type="Grid",this._lastCommandName=null,u=!0,this._selectedKey.length>0)for(c=!0,l=0,e=0;e<this._allFields.length;e++)if(o=this._allFields[e],o.ShowInSummary&&(u=!1,r.append('<div class="Field">'),c?c=!1:r.append('<div class="Divider"><\/div>'),r.appendFormat('<div class="Label">{0}<\/div>',String.trimLongWords(this._allFields[o.AliasIndex].Label)),r.append('<div class="Value">'),this._renderItem(r,o,v,!1,!1,!1,!1,!0),r.append("<\/div><\/div>"),l++,this.get_summaryFieldCount()>0&&l>=this.get_summaryFieldCount()))break;Sys.UI.DomElement.setVisible(i,!u);u&&this._summaryIsVisible?n._numberOfVisibleSummaries--:(u||this._summaryIsVisible)&&(u||this._summaryIsVisible!=null)||n._numberOfVisibleSummaries++;this._summaryIsVisible=!u;Sys.UI.DomElement.setVisible(n,n._numberOfVisibleSummaries>0);a=r.toString();i.innerHTML=a;h=this._lastArgs!=this._lastClearArgs&&this._lastArgs.CommandName==="Delete";s||u&&!h||this.get_filterSource()!=null||typeof Web.Membership=="undefined"||(h&&(this._lastClearArgs=this._lastArgs),Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",this.get_keyRef(),this.get_controller()),h?null:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}<\/div>{1}<\/div><\/div>',document.title,a,i.offsetWidth==0?135:i.offsetWidth)));r.clear();this._lastCommandName=y;this.get_view().Type=p}},_render:function(){var t=this,r,u,i;t._restoreEmbeddedViews();t._detachBehaviors();t._disposeSearchBarExtenders();t._useLEVs();t._configure();t._internalRender();t._viewMessages&&t.showViewMessage(t._viewMessages[t.get_viewId()]);t._raisePopulateDynamicLookups();!t.get_modalAnchor()&&t.get_lookupField()&&t._focusQuickFind();t.raiseSelectedDelayed();t._scrollIntoView&&(t._scrollIntoView=!1,r=$common.getBounds(t._element),u=n.scrolling(),r.y<u.y&&t._element.scrollIntoView(!0));t._incorporateEmbeddedViews();t.get_isModal()&&t._adjustModalPopupSize();t.get_searchOnStart()&&t.get_isGrid()&&(t._focusSearchBar(),t.set_searchOnStart(!1));t.get_isDataSheet()&&(i=t._get_focusedCell(),t.inserting()&&!i?t._startInputListenerOnCell(0,0):i&&t._id===n._activeDataSheetId&&(t._skipCellFocus=!0,t._focusCell(-1,-1,!0)));t.get_isGrid()&&t._synced&&(t._synced=!1,t._selectedRowIndex==null&&(t._forgetSelectedRow(!0),t.refresh(!0)));t._syncKeyFilter()},_internalRender:function(){var o,i,s,r,u,h,f,e,v;if(this._multipleSelection=null,this._dynamicActionButtons=!1,o=this.get_viewType(),i=new Sys.StringBuilder,this.get_mode()==Web.DataViewMode.Lookup)r=this._fields[0],u=this.get_lookupText(),u==null&&(u=t.Lookup.SelectLink),h=r.format(u),this._renderCreateNewBegin(i,r),i.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',this.get_id(),r.Index,this.htmlEncode(r,h),String.format(resourcesLookup.SelectToolTip,r.Label),this.get_lookupValue(),String.format(t.Lookup.ClearToolTip,r.Label),n.htmlAttributeEncode(h),$nextTabIndex(),this.get_enabled()?"":' disabled="true" class="Disabled"'),this._renderCreateNewEnd(i,r),this.get_element().appendChild(this._container),this._container.innerHTML=i.toString(),this.get_lookupValue()!=""&&this.get_enabled()||($get(this.get_id()+"_Item0_ClearLookupLink").style.display="none");else{if(s=o=="Form",i.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',this.get_isModal()?String.format(' style="width:{0}px"',this._container.offsetWidth-20):"",this.get_controller(),this.get_viewId(),this._numberOfColumns>0?" MultiColumn":"",this._tabs.length>0?" Tabbed":"",o),s?this._renderFormView(i):this._renderGridView(i),i.append("<\/table>"),this._mergedRow){var c=this._get_focusedCell(),l=this.inserting(),a=this.get_isDataSheet();for(f=0;f<this._allFields.length;f++)e=this._allFields[f],v=c&&f!=this._fields[c.colIndex].Index,(e.Hidden&&(!e.IsPrimaryKey||l)||v||!c&&l&&a)&&(u=this._mergedRow[f],(u!=null||a&&!l)&&i.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',this.get_id(),f,n.htmlAttributeEncode(u!=null?e.format(u):"")))}this._container.innerHTML=i.toString();this._multipleSelection!=null&&this._multipleSelection==!0&&($get(this.get_id()+"_ToggleButton").checked=!0);this._attachBehaviors();this._updateVisibility();this.editing()&&(this._lastCommandName=="BatchEdit"&&$(this._element).find("div.BatchSelect input:checkbox:checked").each(function(){n._updateBatchSelectStatus(this,s)}),this._focus())}i.clear();this._updateChart();this._updateSearchBar();this._removeRowUpdates();this._fixWidthOfColumns();this._fixHeightOfRow(!0);this._refreshExtension()},_get_headerRowElement:function(){for(var t=this._container.childNodes[0].childNodes[0].childNodes,n=0;n<t.length;){if(Sys.UI.DomElement.containsCssClass(t[n],"HeaderRow"))return t[n];n++}return null},_fixWidthOfColumns:function(){var t,i,n,u,f,h,e;if((this.get_isDataSheet()||this.get_isGrid())&&!this.extension()&&(t=this._get_headerRowElement(),t)){if(this._viewColumnSettings||(this._viewColumnSettings=[]),i=this._viewColumnSettings[this.get_viewId()],!i){for(i=[],$(t).addClass("Fixed"),n=0;n<t.childNodes.length;n++){if(u=t.childNodes[n],f=$common.getBounds(u),f.width==0){Sys.UI.DomElement.removeCssClass(t,"Fixed");return}var o=$common.getPaddingBox(u),s=$common.getBorderBox(u),r={w:f.width-o.horizontal-s.horizontal,h:f.height-o.vertical-s.vertical};Array.add(i,r)}for(h=$common.getBounds(t),n=0;n<i.length;n++)i[n].h=h.height;this._viewColumnSettings[this.get_viewId()]=i;Sys.UI.DomElement.removeCssClass(t,"Fixed")}for(n=0;n<t.childNodes.length;n++)r=i[n],r&&(e=t.childNodes[n],e.style.height=r.h+"px",e.style.width=r.w+"px")}},_fixHeightOfRow:function(n){var i,e,f,r,t,u,o;if((this.get_isDataSheet()||this.get_isGrid())&&(!n||this.editing())){if(i=this._get_headerRowElement(),!i)return;if(e=this._get_focusedCell(),f=this.get_isGrid()?this._selectedRowIndex:e.rowIndex,f>=0){for(r=i.parentNode,t=0;t<r.childNodes.length;t++)if(r.childNodes[t]==i)break;u=r.childNodes[t+f+1];u&&(n?this._selectedRowHeight&&(u.style.height=this._selectedRowHeight+"px"):(o=$common.getBounds(u),this._selectedRowHeight=o.height))}}},_updateChart:function(){var t,i,n,u,r;this.get_isChart()&&(t=this._get("$Chart"),i=t.offsetWidth,i<100&&(i=t.parentNode.offsetWidth),n=this._createParams(),delete n.LookupContextFieldName,delete n.LookupContextController,delete n.LookupContextView,delete n.LookupContext,delete n.LastCommandName,delete n.LastCommandArgument,delete n.Inserting,delete n.DoesNotRequireData,u=rt(n),r=this,r._chartHeight&&(t.style.height=r._chartHeight+"px"),$(t).one("load",function(){try{r._chartHeight=$(this).height()}catch(n){}}).attr("src",String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",this.get_baseUrl(),this.get_controller(),this.get_viewId(),i,encodeURIComponent(u))))},_toggleCategoryVisibility:function(n,i){var u=$get(String.format("{0}$Category${1}",this.get_id(),n)),f,r;u&&(f=this.get_categories()[n],i||(i=!Sys.UI.DomElement.getVisible(u)),$(u).css("display",i?"":"none"),r=$get(String.format("{0}$CategoryButton${1}",this.get_id(),n)),f.Collapsed=!i,i?(Sys.UI.DomElement.removeCssClass(r,"Maximize"),r.childNodes[0].title=t.Form.Minimize):($(r).addClass("Maximize"),r.childNodes[0].title=t.Form.Maximize),_body_performResize())},_processTemplatedText:function(n,t){var e,r,i,u,f,o,s;if(t||(t=""),e=/\{(\w+)\}/g,r=e.exec(t),!r)return t;for(i=new Sys.StringBuilder,u=0;r;)i.append(t.substring(u,r.index)),f=r[1],u=r.index+f.length+2,o=this.findField(f),o?(i.append('<span class="FieldPlaceholder">'),this._renderItem(i,o,n,!1,!1,!1,!1,!1,!0),i.append("<\/span>")):i.appendFormat("[{0}]",f),r=e.exec(t);return s=t.length-1,u<s&&i.append(t.substring(u,s)),i.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(r){var tt=this.editing(),e,s,y,nt,p,l,w,v,u,c,k,d,o,g;if(this._renderStatusBar(r),this._renderViewDescription(r),t.Form.ShowActionBar&&this._renderActionBar(r),e=this.get_currentRow(),this._mergeRowUpdates(e),this._updateVisibility(e),this.inserting()&&this._expressions)for(i=0;i<this._expressions.length;i++)s=this._expressions[i],s.Scope==Web.DynamicExpressionScope.DefaultValues&&s.Type==Web.DynamicExpressionType.ClientScript&&(f=this.findField(s.Target),f&&e[f.Index]==null&&(isNullOrEmpty(s.Test)?e[f.Index]=s.Result:(y=eval(s.Test),y&&(e[f.Index]=isNullOrEmpty(s.Result)?y:s.Result))));for(nt=0,i=0;i<this._allFields.length;i++)this._allFields[i].Hidden||nt++;if(p=e!=null,p&&this._renderActionButtons(r,"Top","Form"),l=this._get_selectedTab(),this._tabs.length>0){for(r.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',this._get_colSpan(),p?"":" WithMargin"),r.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>'),i=0;i<this._tabs.length;i++)r.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}<\/a><\/span><\/span><\/span><\/td>',n.htmlEncode(this._tabs[i]),i==this.get_categoryTabIndex()?" Selected":"",this.get_id(),i,$nextTabIndex());r.append("<\/tr><\/table><\/td><\/tr>")}if(e)if(w=this._get_template(),w)r.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',this._get_colSpan()),this._renderTemplate(w,r,e,!0,!1),r.append("<\/td><\/tr>");else{var a=this.get_categories(),h=this.get_fields(),b=this._numberOfColumns;if(b>0){for(r.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',this._get_colSpan()),v=0;v<b;v++){for(v>0&&r.append('<td class="CategorySeparator">&nbsp;<\/td>'),r.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/b),i=0;i<a.length;i++)if(u=a[i],u.ColumnIndex==v||this._ignoreColumnIndex){for(this.get_isModal()&&(u.Collapsed=!1),r.appendFormat('<div id="{0}_Category{1}" class="Category {3}" style="display:{2}">',this.get_id(),i,!l||l==u.Tab?"block":"none",u.Id),c=this._processTemplatedText(e,u.Description),k=this._formatViewText(t.Views.DefaultCategoryDescriptions[c],!0,c),r.appendFormat('<table class="Category {8}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}<\/span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"><\/span><\/a><div style="clear:both;height:1px;margin-top:-1px;"><\/div><\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}<\/td><\/tr><\/table>',u.HeaderText,k,this.get_id(),i,u.Collapsed?t.Form.Maximize:t.Form.Minimize,a.length>1&&!this.get_isModal()?"":"display:none",u.Collapsed?" Maximize":"",isNullOrEmpty(k)?"none":"block",u.Id),d=!0,j=0;j<h.length;j++)if(o=h[j],!o.Hidden&&o.CategoryIndex==u.Index){d=!1;break}if(!d){if(r.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',this.get_id(),i,u.Collapsed?"display:none":""),isNullOrEmpty(u.Template))for(j=0;j<h.length;j++)o=h[j],o.Hidden||o.CategoryIndex!=u.Index||(g=o.Name.match(/^(_[A-Za-z_]+)\d/),r.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',g?g[1]:o.Name),this._renderItem(r,o,e,!0,!1,!1,!0),r.appendFormat('<\/td><td class="Item{0}" valign="top">',tt&&!o.isReadOnly()?"":" ReadOnly"),this._renderItem(r,o,e,!0),r.append("<\/td><\/tr><\/table>"));else this._renderTemplate(u.Template,r,e,!0,!1);r.append("<\/td><\/tr><\/table>")}r.append("<\/div>")}r.append("<\/td>")}r.append("<\/tr><\/table><\/td><\/tr>")}else for(i=0;i<a.length;i++){if(u=a[i],c=this._processTemplatedText(e,u.Description),r.appendFormat('<tr class="CategoryRow {5}" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category {5}"><table class="Category {5}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}<\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}<\/td><\/tr><\/table><\/td><td valign="top" class="Fields {5}">',u.HeaderText,this._formatViewText(t.Views.DefaultCategoryDescriptions[c],!0,c),this.get_id(),i,!l||l==u.Tab?"":"none",u.Id),isNullOrEmpty(u.Template))for(j=0;j<h.length;j++)o=h[j],o.Hidden||o.CategoryIndex!=u.Index||this._renderItem(r,o,e,!0);else this._renderTemplate(u.Template,r,e,!0,!1);r.append("<\/td><\/tr>")}}else this._renderNoRecordsWhenNeeded(r);e&&this._renderActionButtons(r,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var i,n,t,r;if(this._tabs&&this._tabs.length>0){for(i=this._tabs[this.get_categoryTabIndex()],n=0;n<this._tabs.length;n++)t=this._get("_Tab",n),t&&(n==this.get_categoryTabIndex()?$(t).addClass("Selected"):$(t).removeClass("Selected"));for(n=0;n<this._categories.length;n++)r=this._categories[n],t=this._get("_Category",n),t&&Sys.UI.DomElement.setVisible(t,r.Tab==i);this._updateVisibility()}this._adjustModalHeight()},_renderItem:function(i,r,u,f,s,c,l,a,v){var k=this.get_isForm()||s,p=u[r.Index],pt,vt,yt,ei,wt,gt,ni,bt,nt,rt,at,ft,et,ot,d,g,ci,ii,li,w,ai,vi,kt,ri,dt,ui,ht;p!=null&&(p=p.toString());var it=null,st=r.ItemsStyle=="CheckBoxList",ut=this.editing(),ct=r.Index!=r.AliasIndex,fi=ct&&!r.ItemsStyle;if(ut&&r.ItemsStyle=="CheckBox"&&r.Items.length==2&&(pt=r.Items[0][0],vt=r.Items[1][0],pt=="true"&&(pt="false",vt="true"),p==null&&(p=r.Items[0][0]),it=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{7}"/>',this.get_id(),r.Index,vt&&(p=="true"||p==vt)?" checked":"",$nextTabIndex(),p,pt,vt,r.ToolTip)),yt=r.isReadOnly(),k){if(ei=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),r.Index),l||i.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',this.get_id(),r.Index,r.Name),wt=(ut&&fi?this.findFieldUnderAlias(r):this._allFields[r.AliasIndex]).HeaderText,it&&l&&!(ut&&yt)){i.append('<div class="Header">&nbsp;<\/div>');return}if(wt.length>0&&(v&&it&&this._numberOfColumns>0?i.append('<div class="Header">&nbsp;<\/div>'):i.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}<\/label><\/div>',this.get_id(),r.Index,wt,this._numberOfColumns>0||v?"":it,ut&&!r.AllowNulls&&!it&&!yt&&t.Form.RequiredFieldMarker?t.Form.RequiredFieldMarker:"",r.Name)),l)return;(it==null||this._numberOfColumns>0)&&i.append('<div class="Value">')}if(gt=!ut&&!isNullOrEmpty(r.ItemsDataController)&&!st&&!c&&p&&this._disableObjectRef!=!0&&!r.tagged("lookup-details-hidden"),gt&&!k&&i.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>'),ut&&f&&!yt){fi&&(r=this.findFieldUnderAlias(r));ni=r;r._LEV!=null&&i.append('<table cellpadding="0" cellspacing="0"><tr><td>');!k&&it&&i.append(it);var oi=!isNullOrEmpty(r.ItemsStyle),ti=r.ItemsStyle=="Lookup",si=!isNullOrEmpty(r.ContextFields),lt=r.ItemsStyle=="AutoComplete",b=r.DynamicItems?r.DynamicItems:r.Items,hi=oi&&!ti&&!lt;if(hi&&b.length==0&&!st&&si)b=[],(r.AllowNulls||p==null||si)&&Array.add(b,["",h]),p!=null&&Array.add(b,[p,u[r.AliasIndex]]);else if(r.DynamicItems&&!st){for(bt=!1,nt=0;nt<b.length;nt++)if(b[nt][0]==p){bt=!0;break}bt||(p=null);!r.AllowNulls&&bt||isNullOrEmpty(b[0][0])||Array.insert(b,0,["",h])}else hi&&!r.AllowNulls&&p==null&&!st&&b.length&&b[0][0]!=null&&(b=b.slice(0),b.splice(0,0,["",h]));if(it!=null)(this._numberOfColumns>0||v)&&(i.append(it),i.appendFormat('<label for="{0}_Item{1}" title="{3}">{2}<\/label>',this.get_id(),r.Index,wt,r.ToolTip));else if(b.length>0||st||oi&&!ti&&!lt)if(r.ItemsStyle=="RadioButtonList"){for(i.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',r.ToolTip),rt=r.Columns==0?1:r.Columns,at=Math.floor(b.length/rt)+(b.length%rt>0?1:0),ft=0;ft<at;ft++){for(i.append("<tr>"),et=0;et<rt;et++)ot=et*at+ft,ot<b.length?(d=b[ot],g=d[0]==null?"":d[0].toString(),p==null&&(p=""),i.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),r.Index,ot,g,g==p?" checked":"",this.htmlEncode(r,d[1]),$nextTabIndex())):i.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');i.append("<\/tr>")}i.append("<\/table>")}else if(st)if(ci=p?p.split(","):[],ii=!isNullOrEmpty(r.ContextFields)&&!r.DynamicItems,i.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',this.get_id(),r.Index,ii?p:""),ii)i.append(o.Loading);else{for(i.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',r.ToolTip),rt=r.Columns==0?1:r.Columns,at=Math.floor(b.length/rt)+(b.length%rt>0?1:0),ft=0;ft<at;ft++){for(i.append("<tr>"),et=0;et<rt;et++)ot=et*at+ft,ot<b.length?(d=b[ot],g=d[0]==null?"":d[0].toString(),p==null&&(p=""),i.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),r.Index,ot,g,Array.indexOf(ci,g)!=-1?" checked":"",this.htmlEncode(r,d[1]),$nextTabIndex())):i.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');i.append("<\/tr>")}i.append("<\/table>")}else{for(i.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{4}">',this.get_id(),r.Index,r.ItemsStyle=="ListBox"?r.Rows==0?5:r.Rows:"1",$nextTabIndex(),r.ToolTip),p==null&&(p=""),p=p.toString(),nt=0;nt<b.length;nt++)d=b[nt],g=d[0],li=g==null&&!r.AllowNulls?t.Lookup.SelectLink:d[1],g==null&&(g=""),g=g.toString(),i.appendFormat('<option value="{0}"{1}>{2}<\/option>',g,g==p?" selected":"",this.htmlEncode(r,li));i.append("<\/select>")}else!isNullOrEmpty(r.ItemsDataController)&&ti?(p=u[r.AliasIndex],p==null&&(p=t.Lookup.SelectLink),w=this._allFields[r.AliasIndex].format(p),this._renderCreateNewBegin(i,r),i.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',this.get_id(),r.Index,this.htmlEncode(r,w),isNullOrEmpty(r.ToolTip)?String.format(t.Lookup.SelectToolTip,r.Label):r.ToolTip,u[r.Index],$nextTabIndex(),$nextTabIndex(),String.format(t.Lookup.ClearToolTip,r.Label),u[r.Index]!=null?"display":"none",r.AliasIndex),this._renderCreateNewEnd(i,r)):r.OnDemand?this._renderOnDemandItem(i,r,u,f,k):r.Editor?(ai=r.Editor,i.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),r.Index,n.htmlAttributeEncode(p)),i.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}" tabindex="{4}"><\/iframe>',this.resolveClientUrl(this.get_appRootPath()+"ControlHost.aspx"),this.get_id(),r.Index,ai,$nextTabIndex())):r.Rows>1?(i.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{3}" style="',this.get_id(),r.Index,$nextTabIndex(),r.ToolTip),r.TextMode!=3||isNullOrEmpty(p)||i.append("display:none;"),k?i.appendFormat('" cols="{0}"',r.Columns>0?r.Columns:50):i.append('display:block;width:100%;"'),i.appendFormat(' rows="{0}"',r.Rows),n.supportsPlaceholder&&!isNullOrEmpty(r.Watermark)&&i.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(r.Watermark)),i.append(">"),i.append(r.HtmlEncode?this.htmlEncode(r,p):p),i.append("<\/textarea>"),r.TextMode!=3||isNullOrEmpty(p)||i.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}<\/a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}<\/a><\/div><\/div>",this.get_id(),r.Index,this.htmlEncode(r,p).replace(/((\r\n*)|\n)/g,"<br/>"),e.NoteEditLabel,e.NoteDeleteLabel,e.NoteDeleteConfirm)):(rt=r.Columns>0?r.Columns:50,vi=r.ToolTip,lt&&(!ct||ut)&&(p=u[r.Index],i.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),r.Index,n.htmlAttributeEncode(p)),r=this._allFields[r.AliasIndex]),r.TimeFmtStr&&i.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">'),i.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),r.Index,$nextTabIndex(),r.TextMode!=1?"text":"password"),k?i.appendFormat(' size="{0}"',rt):i.append(' style="display:block;width:90%;"'),r.Len>0&&i.appendFormat(' maxlength="{0}"',r.Len),lt&&i.appendFormat(' title="{0}"',vi),p=u[r.Index],p==null?w=lt?h:"":ct?w=p.toString():(r.DateFmtStr&&(typeof p=="string"&&(p=Date.parseLocale(p,r.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])),r.DataFormatString=r.DateFmtStr),w=r.format(p),r.DateFmtStr&&(r.DataFormatString=r.DataFmtStr)),i.appendFormat(' value="{0}" {1}',n.htmlAttributeEncode(w),k?' class="TextInput"':String.format('class="TextInput {0}Type"',r.Type)),i.appendFormat(' title="{0}"',r.ToolTip),n.supportsPlaceholder&&!isNullOrEmpty(r.Watermark)&&i.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(r.Watermark)),i.append("/>"),r.Type.startsWith("DateTime")&&k&&t.Form.ShowCalendarButton&&!r.TimeFmtStr&&i.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;<\/a>',this.get_id(),r.Index),r.TimeFmtStr&&(i.appendFormat('<\/td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),r.Index,$nextTabIndex()),k?i.appendFormat(' size="{0}"',rt):i.append(' style="display:block;width:90%;"'),p==null?w=lt?h:"":ct?w=p.toString():(r.DataFormatString=r.TimeFmtStr,w=r.format(p),r.DataFormatString=r.DataFmtStr),i.appendFormat(' value="{0}" {1}/><\/td><\/table>',n.htmlAttributeEncode(w),k?"":'class="TimeType"')));r._LEV!=null&&(kt=this._allFields[r.AliasIndex]._LEV,kt==null&&(kt=""),i.appendFormat('<\/td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),r.Index,$nextTabIndex(),n.htmlAttributeEncode(String.format(e.UseLEV,this._allFields[r.AliasIndex].format(kt)))));this._lastCommandName=="BatchEdit"&&i.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="$app._updateBatchSelectStatus(this,{3})"{4}/><\/td><td><label for="{0}$BatchSelect{1}">{2}<\/a><\/td><\/tr><\/table><\/div>',this.get_id(),ni.Index,e.BatchUpdate,k==!0,this._batchEdit&&Array.contains(this._batchEdit,ni.Name)?' checked="checked"':"")}else if(r.OnDemand)this._renderOnDemandItem(i,r,u,f,k);else{if(p=this.htmlEncode(r,u[r.AliasIndex]),ut&&yt&&f&&(ri=u[r.Index],i.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),r.Index,ri!=null?n.htmlAttributeEncode(this._allFields[r.AliasIndex].format(ri)):"")),dt=r.DynamicItems?r.DynamicItems:r.Items,dt.length==0)r.Type=="String"&&p!=null&&p.length>e.MaxReadOnlyStringLen&&!(r.TextMode==3||r.TextMode==2)&&(p=p.substring(0,e.MaxReadOnlyStringLen)+"..."),p&&r.TextMode==3&&(p=p.replace(/\r?\n/g,"<br/>")),w=y(p)?k?h:tt:this._allFields[r.AliasIndex].format(p);else if(st){for(b=p?p.split(","):[],ui=!0,nt=0;nt<dt.length;nt++)d=dt[nt],g=d[0]==null?"":d[0].toString(),Array.contains(b,g)&&(ui?ui=!1:i.append(", "),i.append(n.htmlEncode(d[1])));w=b.length==0?h:""}else ct&&!f?w=p:(d=this._findItemByValue(r,ct?u[r.Index]:p),w=d[1],k||w!=h||(w=tt));isNullOrEmpty(r.HyperlinkFormatString)||p==null||(ht=this._parseLocation(r.HyperlinkFormatString,u),w=ht&&ht.match(/^mailto\:/)?String.format('<a href="{0}" title="{2}">{1}<\/a>',ht,w,r.ToolTip):ht.match(/^javascript\:/)?String.format('<a href="javascript:" onclick="{0};return false;" title="{2}">{1}<\/a>',ht.substring(11),w,r.ToolTip):String.format('<a href="javascript:" onclick="$find(\'{2}\')._navigate(\'{0}\');" title="{3}">{1}<\/a>',ht,w,this.get_id(),r.ToolTip));r.TextMode==1&&(w="**********");r.Type!="Byte[]"||r.OnDemand||(w=n.toHexString(w));a==!0&&(w=String.trimLongWords(w));__designer()&&typeof w=="string"&&(w=w.replace(/\^\w+\^/g,""));i.append(w)}gt&&(k||i.append('<\/td><td align="right">'),i.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;<\/span>',String.format(t.Lookup.DetailsToolTip,n.htmlAttributeEncode(this._allFields[r.AliasIndex].HeaderText)),this.get_id(),r.Name),k||i.append("<\/td><\/tr><\/table>"));k&&((it==null||this._numberOfColumns>0)&&i.append("<\/div>"),i.append(ei),isNullOrEmpty(r.FooterText)||i.appendFormat('<div class="Footer">{0}<\/div>',r.FooterText),i.append("<\/div>"))},_renderOnDemandItem:function(t,i,r,u,f){var o=r[i.Index],l=o!=null?o.toString().match(/^null\|(.+)$/):null,s=l!=null||o==null,c;l&&(o=l[1]);s&&!u&&i.OnDemandStyle==1?t.append(f?h:tt):(c=this.resolveClientUrl(this.get_appRootPath()+e.BlobHandler),u&&!s&&t.appendFormat('<a href="{0}?{1}=o|{2}" title="{3}" onclick="$find(&quot;{4}&quot;)._showDownloadProgress();open(this.href, &quot;_blank&quot;,&quot;height={5},width={6},resizable=yes&quot;);return false">',c,i.OnDemandHandler,o,e.BlobDownloadHint,this.get_id(),k.height()/2,k.width()/2),i.OnDemandStyle==1?s?t.append(f?h:tt):t.append(u?e.BlobDownloadLink:e.BlobDownloadLinkReadOnly):s?t.append(f?h:tt):t.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',c,i.OnDemandHandler,o),u&&!s&&t.append("<\/a>"),!i.ReadOnly&&this.editing()&&u&&(n.upload()?t.appendFormat('<div class="drop-box-{0}"><\/div>',i.Index):t.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}" tabindex="{6}"><\/iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}<\/div>',c,i.OnDemandHandler,o,this.get_id(),i.Index,"Uploading...",$nextTabIndex())))},_renderGridView:function(n){var o,t,r,i,u,f,e;if(this._renderViewDescription(n),this._renderActionBar(n),this._renderSearchBar(n),o=this.get_showPager(),t=this.extension(),this._renderPager(n,"Top"),this.get_isChart()){for(this._renderInfoBar(n),this._sortingDisabled=!1,r=!1,i=0;i<this._fields.length;i++)u=this._fields[i],u.Aggregate!=0?this._sortingDisabled=!0:r||(r=!0,this.set_sortExpression(null),this.set_sortExpression(u.Name));t||n.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/><\/td><\/tr>',this.get_id(),this._get_colSpan())}else f=this._hasKey(),e=this.multiSelect()&&f,this.get_searchOnStart()||(this._renderInfoBar(n),t||this._renderRows(n,f,e)),t||(this._renderAggregates(n,e),this._renderNoRecordsWhenNeeded(n));t||this._renderPager(n,"Bottom")},_renderAggregates:function(n,t){var e=this.get_aggregates(),f,i,r,u,o;if(this._totalRowCount!=0&&e!=null){for(n.append('<tr class="AggregateRow">'),t&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_showIcons()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_isDataSheet()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this._actionColumn&&n.append('<td class="Aggregate">&nbsp;<\/td>'),f=0;f<this.get_fields().length;f++)i=this.get_fields()[f],i.Aggregate==0?n.append('<td class="None">&nbsp;<\/td>'):(r=e[i.Index],r=r==null?tt:i.format(r),u=this._allFields[i.AliasIndex],u.IsMirror&&(r=e[i.AliasIndex]),o=a.Aggregates[Web.DataViewAggregates[i.Aggregate]],n.appendFormat('<td class="Aggregate {0} {1}Type" title="',u.Name,u.Type),n.appendFormat(o.ToolTip,u.HeaderText),n.append('">'),n.appendFormat(o.FmtStr,r),n.append("<\/td>"));n.append("<\/tr>")}},_renderSearchBar:function(n){this.get_showSearchBar()&&__tf==4&&(this._searchBarInitialized=!1,n.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/><\/td><\/tr>',this.get_id(),this._get_colSpan(),this.get_searchBarIsVisible()?"":"display:none"))},_renderNoRecordsWhenNeeded:function(n){if(this._totalRowCount==0){var i=this.get_isDataSheet()&&this._keyFields.length>0&&this.executeActionInScope(["Row","ActionBar"],"New",null,null,!0)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}<\/a>',this.get_id(),a.NewRowLink,t.Lookup.GenericNewToolTip):"";n.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}<\/td><\/tr>',this._get_colSpan(),e.NoRecords,i)}},_attachBehaviors:function(){this._detachBehaviors();this._attachFieldBehaviors();var n=this.get_quickFindElement();n&&$addHandlers(n,this._quickFindHandlers,this)},_get:function(n,t){return t==null?$get(this.get_id()+n):$get(this.get_id()+n+t)},_attachTimeOptions:function(t,i){var f=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:this.get_id()+"_AutoComplete$Time"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength,typeCssClass:"AutoComplete"},null,null,i),r,e,u,o;if(Sys.UI.DomElement.addCssClass(f._completionListElement,"Time"),r=null,e=t.DataFormatString&&t.DataFormatString.replace(/\W/g,"_")||"Default",t.Type=="TimeSpan"){if(n._timeSpanOptions||(n._timeSpanOptions={}),r=n._timeSpanOptions[e],!r){for(r=[],u=new Date,o=t.DataFormatString||"{0:HH:mm}",u.setHours(0,0,0,0);r.length<96;)Array.add(r,String.localeFormat(o,u)),u.setMinutes(u.getMinutes()+15);n._timeSpanOptions[e]=r}}else if(r=n._timeOptions,!r){for(r=[],u=new Date,u.setHours(u.getHours(),0,0,0);r.length<48;)Array.add(r,String.localeFormat("{0:"+lt.ShortTimePattern+"}",u)),u.setMinutes(u.getMinutes()+30);n._timeOptions=r}return(f._cache=[])["%"]=r,f},_executeClientEditorFactories:function(t,i,r){var h=i==null?t.Editor:t.ClientEditor,e,f,s,c;if(!isNullOrEmpty(h))for(e=h.split(n._simpleListRegex),f=0;f<e.length;f++){var l=e[f],o=l.replace(/\W/g,"$"),u=n.EditorFactories[o];if(u==null){try{u=eval(String.format('typeof {0}!="undefined"?new {0}():""',o))}catch(a){u=""}n.EditorFactories[o]=u}if(i==null)return u!="";if(u!=""){if(!r&&Array.indexOf(n._customInputElements,i.id)<0)return;if(s=this.get_viewType(),c=r?u.attach(i,s):u.detach(i,s),c)return r?Array.add(n._customInputElements,i.id):Array.remove(n._customInputElements,i.id),!0}}return!1},_attachFieldBehaviors:function(){var c=this,e,s,h,f;if(c.editing())for(e=0;e<this.get_fields().length;e++){var t=this.get_fields()[e],i=this._get("_Item",t.Index),r=null;if(!i||t.ReadOnly||this._executeClientEditorFactories(t,i,!0))t.OnDemand&&(f=$(this._container).find(".drop-box-"+t.Index),f.length&&(t._dropBox?(t._dropBoxInput.insertAfter(f),t._dropBox.insertAfter(f),f.remove(),t._dropBoxInput=null,t._dropBox=null):n.upload("create",{container:f,dataViewId:c._id,fieldName:t.Name})));else{if(i.tagName=="TEXTAREA"&&t.Len>0&&(i.setAttribute("maxlength",t.Len),$addHandler(i,"keyup",this._checkMaxLengthHandler),$addHandler(i,"blur",this._checkMaxLengthHandler)),!isNullOrEmpty(t.Mask)){var u=Sys.CultureInfo.CurrentCulture,o=u.dateTimeFormat.ShortDatePattern.toUpperCase().split(u.dateTimeFormat.DateSeparator),l=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:u.dateTimeFormat.AMDesignator+";"+u.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:u.numberFormat.CurrencySymbol,CultureDateFormat:o[0].substring(0,1)+o[1].substring(0,1)+o[2].substring(0,1),CultureDatePlaceholder:u.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:u.numberFormat.NumberDecimalSeparator,CultureName:u.name,CultureThousandsPlaceholder:u.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:u.dateTimeFormat.TimeSeparator,DisplayMoney:t.DataFormatString=="{0:c}",Mask:t.Mask,MaskType:t.MaskType,ClearMaskOnLostFocus:t.MaskType>0,id:this.get_id()+"_MaskedEdit"+t.Index},null,null,i);t.MaskType==2&&l.set_InputDirection(1);Array.add(t.Behaviors,l)}t.Type.startsWith("Date")?(r=$create(AjaxControlToolkit.CalendarBehavior,{id:this._get("_Calendar",t.Index)},null,null,i),r.set_format((t.DateFmtStr?t.DateFmtStr:t.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]),s=$get(i.id+"_Button"),s&&r.set_button(s),t.TimeFmtStr&&(i=this._get("_Item$Time",t.Index),i&&(Array.add(t.Behaviors,r),r=this._attachTimeOptions(t,i)))):t.Type=="TimeSpan"?r=this._attachTimeOptions(t,i):i.type=="text"&&t.AutoCompletePrefixLength>0?r=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",this.get_controller(),this.get_viewId(),t.Name),delimiterCharacters:",;",id:this.get_id()+"_AutoComplete"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:this.get_servicePath(),useContextKey:!0,typeCssClass:"AutoComplete"},null,null,i):t.ItemsStyle=="AutoComplete"&&(h=this._allFields[t.AliasIndex],i=this._get("_Item",h.Index),i&&i.type=="text"&&(r=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",this.get_id(),h.Name),delimiterCharacters:"",id:this.get_id()+"_AutoComplete"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:this.get_servicePath(),useContextKey:!0,fieldName:t.Name,enableCaching:!1,typeCssClass:"Lookup"},null,null,i)));r&&Array.add(t.Behaviors,r)}}},_detachBehaviors:function(){var e,t,r,f,u;if(!s&&(e=this.get_quickFindElement(),e&&$clearHandlers(e),this.get_fields()!=null))for(i=0;i<this.get_fields().length;i++)if(t=this.get_fields()[i],r=this._get("_Item",t.Index),!r||!this._executeClientEditorFactories(t,r,!1)){for(t.Len>0&&t.Rows>1&&r&&r.tagName=="TEXTAREA"&&r._events&&($removeHandler(r,"keyup",this._checkMaxLengthHandler),$removeHandler(r,"blur",this._checkMaxLengthHandler)),t._lookupModalBehavior!=null&&(t._lookupModalBehavior.dispose(),t._lookupModalPanel.parentNode.removeChild(t._lookupModalPanel),delete t._lookupModalPanel,t._lookupModalBehavior=null),t._lookupDataControllerBehavior!=null&&(t._lookupDataControllerBehavior.dispose(),t._lookupDataControllerBehavior=null),f=0;f<t.Behaviors.length;f++)t.Behaviors[f].dispose();Array.clear(t.Behaviors);t.Editor&&(n.Editors[t.EditorId]=null);t.OnDemand&&(u=$(this._container).find(".drop-box-"+t.Index),u.length&&u.is(".app-drop-box")&&!u.is(".app-drop-box-destroyed")&&(t._dropBoxInput=u.next().detach(),t._dropBox=u.detach()))}},_registerDataTypeFilterItems:function(n,t,i,r,u){for(var f,o,e=null,s=0;s<i.length;s++)if(f=i[s],f){if(!f.Hidden&&(!u.SearchOptions||Array.indexOf(u.SearchOptions,f.Function)>=0)&&(e=new Web.Item(n,f.Prompt?f.Text+"...":f.Text),t.addChild(e),f.List?this._registerDataTypeFilterItems(n,e,f.List,r,u):f.Prompt?e.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),u.Index,f.Function,f.Text):e.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),u.Index,f.Function),r&&f.Function==r))for(o=e;o;)o.set_selected(!0),o=o.get_parent()}else u.SearchOptions||(e=new Web.Item(n),t.addChild(e))},_registerFieldHeaderItems:function(n,t,i,r){var ut=n==null?0:n,ft=n==null?this.get_fields().length-1:n,y=this.get_sortExpression(),p,w,b,d,g,u,k,tt,l,it;for(y&&(y=y.match(/^(\w+)\s+(asc|desc)/)),p=ut;p<=ft;p++){var e=null,s=[],c=t?t:String.format("{0}$FieldHeaderSelector${1}",this.get_id(),p),a=this.get_fields()[p],f=this._allFields[a.AliasIndex];if(!r||f.Aggregate==0){if(f.AllowSorting||f.AllowQBE){w=o.GenericSortAscending;b=o.GenericSortDescending;switch(f.FilterType){case"Text":w=o.StringSortAscending;b=o.StringSortDescending;break;case"Date":w=o.DateSortAscending;b=o.DateSortDescending}if(d=f.AllowSorting&&!this._sortingDisabled,d&&(g=y&&y[1]==f.Name,u=new Web.Item(c,w),g&&y[2]=="asc"?u.set_selected(!0):u.set_cssClass("SortAscending"),u.set_script('$find("{0}").sort("{1} asc")',this.get_id(),f.Name),Array.add(s,u),u=new Web.Item(c,b),g&&y[2]=="desc"?u.set_selected(!0):u.set_cssClass("SortDescending"),u.set_script('$find("{0}").sort("{1} desc")',this.get_id(),f.Name),Array.add(s,u)),f.AllowQBE&&(e=this.filterOf(f),d&&Array.add(s,new Web.Item),u=new Web.Item(c,String.format(o.ClearFilter,f.HeaderText)),u.set_cssClass("FilterOff"),e||u.set_disabled(!0),u.set_script('$find("{0}").applyFilterByIndex({1},-1)',this.get_id(),a.AliasIndex),Array.add(s,u),k=null,__designer()||(tt=nt[f.FilterType],f.Items.length==0&&(u=new Web.Item(c,tt.Text),Array.add(s,u),k=this.get_fieldFilter(f,!0),this._registerDataTypeFilterItems(c,u,tt.List,k,f)),f.FilterType!="Boolean"&&(!f.SearchOptions||Array.indexOf(f.SearchOptions,"$in")>=0)&&f.AllowMultipleValues!=!1&&(u=new Web.Item(c,o.CustomFilterOption),e&&e.match(/\$(in|out)\$/)?u.set_selected(!0):u.set_cssClass("CustomFilter"),u.set_script('$find("{0}").showCustomFilter({1})',this.get_id(),a.AliasIndex),Array.add(s,u))),a.AllowSamples!=!1))if(a._listOfValues)for(e&&e.startsWith("=")&&(e=e.substring(1),e.endsWith('\0')&&(e=e.substring(0,e.length-1))),l=0;l<a._listOfValues.length;l++){l==0&&Array.add(s,new Web.Item);var v=a._listOfValues[l],rt=!1,h=v;v==null?h=o.EmptyValue:f.Items.length>0?(u=this._findItemByValue(f,v),h=u[1]):f.Type=="String"&&v.length==0?h=o.BlankValue:isNullOrEmpty(f.DataFormatString)||(h=f.Type.startsWith("DateTime")?String.localeFormat("{0:d}",v):f.format(v));v=this.convertFieldValueToString(f,v);rt=k=="="&&e&&v==e;h.length>o.MaxSampleTextLen&&(h=h.substring(0,o.MaxSampleTextLen)+"...");typeof h!="string"&&(h=h.toString());u=new Web.Item(c,h);rt&&u.set_selected(!0);u.set_script("$find('{0}').applyFilterByIndex({1},{2});",this.get_id(),a.AliasIndex,l);u.set_group(1);Array.add(s,u)}else(!f.SearchOptions||Array.indexOf(f.SearchOptions,"=")>=0)&&(u=new Web.Item(c,o.Loading),u.set_dynamic(!0),u.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',this.get_id(),c,a.Name,f.Name),Array.add(s,u))}if(t){for(u=new Web.Item(t,f.HeaderText),Array.add(i,u),l=0;l<s.length;l++)it=s[l],u.addChild(it);it.get_selected()&&u.set_selected(!0);e&&u.set_selected(!0)}else $registerItems(c,s,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}}},_get_specialAction:function(n){if(!this._specialActions)return null;var i=this._specialActions[n+"Text"],t=this._specialActions[n+"Script"];return isNullOrEmpty(t)?null:{text:i,script:t}},_registerSpecialAction:function(n,t,i,r){var f=this,e=f.get_id(),o=n.CommandName,s=n.HeaderText,u=f._specialActions;if(!u.PrintText&&o&&o.match(/^Report/)){if(r!==!0&&!f._isActionAvailable(n))return;u.PrintText=s;u.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",e,i,t)}else if(n.CssClass==="AttachIcon"){if(r!==!0&&!f._isActionAvailable(n))return;u.AnnotateText=s;u.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",e,i,t)}},_registerActionBarItems:function(){var o=this.get_actionGroups("ActionBar"),s=this.get_isChart(),r,u,i,f,n,t,e;for(s&&!this.get_showViewSelector()&&(r=String.format("{0}${1}$ActionGroup$Chart",this.get_id(),this.get_viewId()),u=[],this._registerFieldHeaderItems(null,r,u,!0),$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)),this._specialActions={PrintText:null,PrintScript:null,AnnotateText:null,AnnotateScript:null},i=0;i<o.length;i++)if(f=o[i],r=String.format("{0}${1}$ActionGroup${2}",this.get_id(),this.get_viewId(),i),f.Flat)for($unregisterItems(r),n=0;n<f.Actions.length;n++)this._registerSpecialAction(f.Actions[n],i,n);else{for(u=[],n=0;n<f.Actions.length;n++)t=f.Actions[n],this._isActionAvailable(t)&&(e=new Web.Item(r,t.HeaderText,t.Description),e.set_cssClass(t.CssClassEx+(isNullOrEmpty(t.CssClass)?t.CommandName+"LargeIcon":t.CssClass)),Array.add(u,e),e.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",this.get_id(),n,i)),this._registerSpecialAction(t,i,n,!0));$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}Array.clear(o)},_registerViewSelectorItems:function(){for(var t,i,r=[],n=this,u=n.get_id()+"$ViewSelector",f=0;f<n.get_views().length;f++)t=n.get_views()[f],(t.Type!="Form"&&t.ShowInSelector||t.Id==n.get_viewId())&&(i=new Web.Item(u,t.Label),t.Id==this.get_viewId()&&i.set_selected(!0),i.set_script(function(t){n.executeCommand({commandName:"Select",commandArgument:t.Id})}),i.context(t),Array.add(r,i));n.get_isChart()&&(Array.add(r,new Web.Item),n._registerFieldHeaderItems(null,u,r,!0));$registerItems(u,r,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var r=this.get_actions("Grid"),n,u,e,i,t,f;if(r&&r.length>0)for(n=0;n<this._rows.length;n++){for(u=[],e=String.format("{0}$RowSelector${1}",this.get_id(),n),i=0;i<r.length;i++)t=r[i],this._isActionAvailable(t,n)&&(f=new Web.Item(e,t.HeaderText,t.Description),f.set_cssClass(t.CssClassEx+(isNullOrEmpty(t.CssClass)?t.CommandName+"Icon":t.CssClass)+(u.length==0?" Default":"")),Array.add(u,f),f.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',this.get_id(),i,n)));$registerItems(e,u,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(n=0;n<this._rows.length;n++)$unregisterItems(String.format("{0}$RowSelector${1}",this.get_id(),n))},_get_searchBarSettings:function(){var o,i,l,t,it,f,rt,u,b,g,r,s,h,e,v,y,k,p,tt;if(this._searchBarSettings||(this._searchBarSettings=[]),o=this._searchBarSettings[this.get_viewId()],!o){var d=[],c=[],w=this.get_filter();if(w.length>0&&!this.filterIsExternal())for(i=0;i<w.length;i++)(l=w[i].match(n._fieldFilterRegex),t=this.findField(l[1]),t&&!this._fieldIsInExternalFilter(t))&&(it=this._allFields[t.AliasIndex],f=l[2].match(n._filterRegex),l[2].startsWith("~")||(t._renderedOnSearchBar=!0,rt=this._findItemByValue(t,f[3]),u=f[3],u=="null"&&(u=""),b=u.match(/^([\s\S]+?)\0?$/),b&&(u=b[1]),g=t.Items.length==0?f[1]:"$in",r=n.filterDef(nt[t.FilterType].List,t.FilterType=="Boolean"&&f[3].length>1?f[3]=="%js%true"?"$true":"$false":g),r&&(s=u.match(/^(.+?)\$and\$(.+?)$/),Array.add(c,{Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false"),Value:s?s[1]:u,Value2:s?s[2]:""}))));for(h=!1,i=0;i<this._allFields.length;i++)if(t=this._allFields[i],h=t.Search==Web.FieldSearchMode.Required||t.Search==Web.FieldSearchMode.Suggested,h)break;for(i=0;i<this._allFields.length;i++)if(e=this._allFields[i],t=this._allFields[e.AliasIndex],t.AllowQBE&&t.Search!=Web.FieldSearchMode.Forbidden&&(!e.Hidden||e.Search!=Web.FieldSearchMode.Default)){if(v=!h&&c.length<a.VisibleSearchBarFields||h&&(e.Search==Web.FieldSearchMode.Required||e.Search==Web.FieldSearchMode.Suggested),!t._renderedOnSearchBar){for(y=t.Items.length==0||t.FilterType=="Boolean"?null:"$in",t.SearchOptions&&(y=t.SearchOptions[0]),k=nt[t.FilterType].List,p=0;p<k.length;p++)if(r=k[p],r!=null&&(y==null||r.Function==y))break;tt={Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false")};(v||this.findFieldUnderAlias(t)==t||t.VisibleOnSearchBar==null)&&Array.add(v?c:d,tt);t.VisibleOnSearchBar=v}t._renderedOnSearchBar=!1}o={visibleFields:c,availableFields:d};this._searchBarSettings[this.get_viewId()]=o}return o},_toggleSearchBar:function(){this._hasSearchShortcut&&this.search()||(this.set_searchBarIsVisible(!this.get_searchBarIsVisible()),this._updateSearchBar(),this.get_searchBarIsVisible()&&(this.get_lookupField()&&this._adjustLookupSize(),this._focusSearchBar()),_body_performResize())},_renderSearchBarFieldNameOptions:function(t,i,r){var u,f,e;if(i.Search!=Web.FieldSearchMode.Required)for(u=0;u<r.availableFields.length;u++)f=r.availableFields[u],e=this._allFields[f.Index],t.appendFormat('<option value="{0}">{1}<\/option>',u,n.htmlEncode(e.HeaderText))},_renderSearchBarFunctionOptions:function(t,i,r,u,f){for(var e,s,o=0;o<r.length;o++)if(e=r[o],e)if(e.List)this._renderSearchBarFunctionOptions(t,i,e.List,u);else if(f==null||e.Function==f){var h=String.format("{0},{1}",n.htmlAttributeEncode(e.Function),e.Prompt?"true":"false"),l=h==u.Function?' selected="selected"':"",c=String.format('<option value="{0}"{1}>{2}{3}<\/option>',h,l,e.Prompt?"":b.Equals+" ",e.Function.match(n._keepCapitalization)?e.Text:e.Text.toLowerCase());i.SearchOptions?(s=Array.indexOf(i.SearchOptions,e.Function),s>=0&&(i.SearchOptionSet[s]=c)):t.append(c)}},_renderSearchBarField:function(i,r,u){var v=r.visibleFields[u],f=this._allFields[v.Index],rt=f.Items.length==0||f.FilterType=="Boolean"?null:"$in",y=v.Function.match(/^(.+?),(true|false)$/),s,c,l,g,h,tt,w,p;if(i.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}<\/option>',this.get_id(),u,n.htmlEncode(f.HeaderText),$nextTabIndex()),this._renderSearchBarFieldNameOptions(i,f,r),i.append("<\/select><\/td>"),i.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',this.get_id(),u,$nextTabIndex()),f.SearchOptions&&(f.SearchOptionSet=[]),this._renderSearchBarFunctionOptions(i,f,nt[f.FilterType].List,v,rt),f.SearchOptions)for(s=0;s<f.SearchOptionSet.length;s++)i.append(f.SearchOptionSet[s]);i.append("<\/select><\/td>");var k=f.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",d=y[1]=="$in"||y[1]=="$notin",e=v.Value;if(d){if(c=new Sys.StringBuilder,l=!isNullOrEmpty(e),c.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="$app.highlightFilterValues(this,true,\'Active\')" onmouseout="$app.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" title="{5}">',this.get_id(),f.Index,u,l?"":" Empty",$nextTabIndex(),b.FilterToolTip),l)for(g=e.split(/\$or\$/),s=0;s<g.length;s++)s>0&&c.append('<span class="Highlight">, <\/span>'),h=g[s],String.isJavaScriptNull(h)?h=o.EmptyValue:(h=this.convertStringToFieldValue(f,h),tt=this._findItemByValue(f,h),h=tt?tt[1]:f.format(h)),c.append(h);else c.append(t.Lookup.SelectLink);c.appendFormat('<\/a><\/div><\/td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" >&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),l?-1:f.Index,u,l?it:b.FilterToolTip,$nextTabIndex(),l?" Clear":"");k=c.toString()}else isNullOrEmpty(e)||(e=e.split(/\$or\$/)[0]);y[2]=="true"?(typeof e!="string"||d||(e=f.format(this.convertStringToFieldValue(f,e))),i.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2} {7}" value="{3}" tabindex="{4}"/>{5}<\/td>',this.get_id(),u,f.FilterType,n.htmlAttributeEncode(e=="null"?o.EmptyValue:e),$nextTabIndex(),k,d?"hidden":"text",f.AllowAutoComplete!=!1?" AutoComplete":"")):i.append("<td>&nbsp;<\/td>");w=$nextTabIndex();y[1]=="$between"&&(w=$nextTabIndex());i.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span><\/span<\/a><\/td>',this.get_id(),w,a.RemoveCondition,u);i.append("<\/tr>");f.FilterType!="Text"&&y[1]=="$between"&&(p=v.Value2,typeof p=="string"&&(p=f.format(this.convertStringToFieldValue(f,p))),i.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}<\/td><td><input id="{0}$SearchBarValue2${1}" type="text" class="{2}" value="{3}" tabindex="{5}"/>{6}<\/td><td>&nbsp;<\/td><\/tr>',this.get_id(),u,f.FilterType,n.htmlAttributeEncode(p),b.And,w-1,k))},_focusSearchBar:function(n){var u=n!=null,i,t,r;u||(n=0);i=this._get_searchBarControl("Function",n);i||(n=0,i=this._get_searchBarControl("Function",0));t=this._get_searchBarControl("Value",n);t?t.type=="hidden"?(r=t.parentNode.getElementsByTagName("a")[0],r.focus(),u&&this._searchBarVisibleIndex==null&&isNullOrEmpty(t.value)&&r.click()):Sys.UI.DomElement.setFocus(t):i&&i.focus()},_searchBarNameChanged:function(n,t){var i,u,f,r;this._saveSearchBarSettings();i=this._get_searchBarSettings();u=i.visibleFields[n];t?Array.removeAt(i.visibleFields,n):(f=this._get_searchBarControl("Name",n),r=ct(f.value),i.visibleFields[n]=i.availableFields[r],Array.removeAt(i.availableFields,r));Array.insert(i.availableFields,0,u);this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarFuncChanged:function(n){this._saveSearchBarSettings();var t=this._get_searchBarSettings(),i=t.visibleFields[n],r=this._get_searchBarControl("Function",n);i.Function=r.value;this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarAddField:function(){this._saveSearchBarSettings();var n=this._get_searchBarSettings();Array.add(n.visibleFields,n.availableFields[0]);Array.removeAt(n.availableFields,0);this._renderSearchBarControls(!0);this._focusSearchBar(n.visibleFields.length-1)},_createSearchBarFilter:function(n){for(var c,i,r,a,u,f,e,o,v,p,w=Array.clone(this._filter),l=this._get_searchBarSettings(),s=[],h=!0,t=0;t<l.visibleFields.length;t++)if(c=l.visibleFields[t],i=this._allFields[c.Index],this.removeFromFilter(i),r=c.Function.match(/^(.+?),(true|false)$/),a=[],r[2]=="true"){if(u=this._get_searchBarControl("Value",t),f=this._get_searchBarControl("Value2",t),y(u.value)&&(!f||y(f.value))&&i.Search!=Web.FieldSearchMode.Required)continue;if(r[1]=="$in"||r[1]=="$notin"){Array.add(s,{Index:i.Index,Function:r[1],Values:[u.value]});continue}if(y(u.value)){if(n)continue;else alert(ut.RequiredField),Sys.UI.DomElement.setFocus(u),h=!1;break}if(e={NewValue:u.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(u);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?u.value.trim():e.NewValue);if(r[1]=="$between"){if(y(f.value)){if(n)continue;else alert(ut.RequiredField),Sys.UI.DomElement.setFocus(f),h=!1;break}if(e={NewValue:f.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(f);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?f.value.trim():e.NewValue)}Array.add(s,{Index:i.Index,Function:r[1],Values:a})}else Array.add(s,{Index:i.Index,Function:r[1],Values:null});if(!h)return null;for(t=0;t<l.availableFields.length;t++)c=l.availableFields[t],i=this._allFields[c.Index],this.removeFromFilter(i);for(t=0;t<s.length;t++)v=s[t],this.applyFieldFilter(v.Index,v.Function,v.Values,!0);return p=this._filter,this._filter=w,p},_performSearch:function(){if(!this._isBusy){this._saveSearchBarSettings();var n=this._createSearchBarFilter(!1);n&&(this.set_filter(n),this.refreshData(),this._setFocusOnSearchBar=!0);this._forgetSelectedRow(!0)}},_resetSearchBar:function(){this._isBusy||(this.clearFilter(),this._searchBarSettings[this.get_viewId()]=null,this._renderSearchBarControls(!0),this._focusSearchBar())},_get_searchBarControl:function(n,t){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),n,t))},_saveSearchBarSettings:function(){for(var r=this._get_searchBarSettings(),n=0;n<r.visibleFields.length;n++){var t=r.visibleFields[n],f=this._get_searchBarControl("Function",n),i=this._get_searchBarControl("Value",n),u=this._get_searchBarControl("Value2",n);t.Function=f.value;i&&(i.value==o.EmptyValue?"null":i.value,t.Value=this._formatSearchField(i,t.Index));u&&(t.Value2=this._formatSearchField(u,t.Index))}},_formatSearchField:function(n,t){var i=this._allFields[t],r,u;return i.Type.startsWith("Date")?(r=Date.tryParseFuzzyDate(n.value,i.DataFormatString),r!=null&&(n.value=i.format(r))):i.Type!="String"&&(u=Number.tryParse(n.value,i.DataFormatString),u!=null&&(n.value=i.format(u))),n.value},_renderSearchBarControls:function(n){var s,i,u,t,f,h,e,r,o,l;if(!this._searchBarInitialized||n){for(s=$get(this.get_id()+"$SearchBarContent"),this._searchBarInitialized=!0,i=new Sys.StringBuilder,i.append('<table class="SearchBarFrame">'),u=this._get_searchBarSettings(),t=0;t<u.visibleFields.length;t++)this._renderSearchBarField(i,u,t);for(u.availableFields.length>0&&i.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}<\/a><\/td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span><\/span><\/a><\/td>',this.get_id(),$nextTabIndex(),a.AddCondition,a.AddConditionText),i.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"><\/div><\/td><td><div id="{0}$SearchBarFuncStub" class="Stub"><\/div><\/td><td><\/td><\/tr>',this.get_id()),i.append("<\/table>"),i.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}" class="Search">{1}<\/button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}" class="Reset">{2}<\/button><\/div>',this.get_id(),ht,it,$nextTabIndex(),$nextTabIndex()),s.innerHTML=i.toString(),i.clear(),f=$get(this.get_id()+"$SearchBarNameStub"),f.style.width=f.offsetWidth+"px",f=$get(this.get_id()+"$SearchBarFuncStub"),f.style.width=f.offsetWidth+"px",h=s.getElementsByTagName("select"),t=0;t<h.length;t++)h[t].style.width="100%";for(this._searchBarExtenders||(this._searchBarExtenders=[]),t=0;t<u.visibleFields.length;t++){var v=u.visibleFields[t],y=this._allFields[v.Index],c=this._get_searchBarControl("Value",t);if(c)if(v.Function.match(/\$(in|notin),/)==null)e=this._createFieldInputExtender("SearchBar",y,c,t),e&&Array.add(this._searchBarExtenders,e);else{for(r=c;r&&r.tagName!="TR";)r=r.parentNode;for(o=0;o<r.childNodes.length;o++)r.childNodes[o].vAlign="top"}l=this._get_searchBarControl("Value2",t);l&&(e=this._createFieldInputExtender("SearchBar",y,l,t+"$2"),e&&Array.add(this._searchBarExtenders,e))}}},_updateSearchBar:function(){var r=this._get("$SearchBar"),n,t,u,i;r&&(n=this.get_searchBarIsVisible(),t=this._get("$SearchBarActivator"),t&&(n?Sys.UI.DomElement.addCssClass(t,"Activated"):Sys.UI.DomElement.removeCssClass(t,"Activated")),Sys.UI.DomElement.setVisible(r,n),n&&this._renderSearchBarControls(r),t&&(Sys.UI.DomElement.setVisible(this._get("$QuickFind"),!n),u=this._get("$SearchToggle"),u.title=this._hasSearchAction&&this._hasSearchShortcut?ht:this.get_searchBarIsVisible()?a.HideAdvancedSearch:a.ShowAdvancedSearch),i=this._get("$InfoRow"),i&&(n?Sys.UI.DomElement.addCssClass(i,"WithSearchBar"):Sys.UI.DomElement.removeCssClass(i,"WithSearchBar")),this._setFocusOnSearchBar&&(this._setFocusOnSearchBar=!1,this._focusSearchBar()))},_renderSearchBarActivator:function(n){this.get_showSearchBar()&&(this.get_showQuickFind()||!this.get_searchOnStart())&&(n.appendFormat('<td class="SearchBarActivator{1}" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span><\/span><\/a><\/td>',this.get_id(),this._hasSearchAction&&this._hasSearchShortcut?" Search":""),this.get_showQuickFind()||n.append('<td class="Divider"><div><\/div><\/td>'))},_internalRenderActionBar:function(i){var s=this.get_actionGroups("ActionBar"),h,c,l,e,f,o,v,u,r;if(i.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>'),h=this.get_isGrid(),h&&this._renderSearchBarActivator(i),h&&this.get_showQuickFind()?(c=this.get_quickFindText(),i.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/><\/td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;<\/span><\/a><\/td><\/tr><\/table><\/div><\/td>',this.get_id(),n.htmlAttributeEncode(c),a.QuickFindToolTip,c==a.QuickFindText?"Empty":"NonEmpty",$nextTabIndex()),i.append('<td class="Divider"><div><\/div><\/td>'),this.get_lookupField()&&!isNullOrEmpty(this.get_lookupField().ItemsNewDataView)&&i.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"><\/span><\/a><\/td>',this.get_id(),t.Lookup.GenericNewToolTip,$nextTabIndex())):(s.length==0||this.get_lookupField())&&i.append('<td class="Divider"><div style="visibility:hidden"><\/div><\/td>'),!this.get_lookupField())for(this._registerActionBarItems(),l=this.get_isChart()&&!this.get_showViewSelector(),l&&i.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),e=0;e<s.length;e++)if((e>0||l)&&i.append('<td class="Divider"><div><\/div><\/td>'),f=s[e],f.Flat){for(o=-1,v=-1,u=0;u<f.Actions.length;u++)r=f.Actions[u],r._isAvailable=this._isActionAvailable(r)&&!isNullOrEmpty(r.HeaderText),r._isFirst=!1,r._isLast=!1,r._isAvailable&&(o==-1&&(o=u),v=u);for(o>=0&&(f.Actions[o]._isFirst=!0,f.Actions[v]._isLast=!0),u=0;u<f.Actions.length;u++)r=f.Actions[u],r._isAvailable&&i.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})" title="{10}"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)">{3}<\/a><\/span><\/td>',this.get_id(),u,e,n.htmlEncode(r.HeaderText),$nextTabIndex(),isNullOrEmpty(r.CssClass)?"":String.format('<span class="FlatGroupIcon {0}">&nbsp;<\/span>',n.cssToIcon(r.CssClass)),isNullOrEmpty(r.CssClass)?"":" FlatGroupWithIcon",r.CssClassEx,r._isFirst?" First":"",r._isLast?" Last":"",r.Description)}else i.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),e,f.HeaderText,$nextTabIndex(),f.CssClassEx);i.append("<\/tr><\/table>")},_renderActionBar:function(i){if(!this.get_showActionBar()){this._registerActionBarItems();return}i.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',this._get_colSpan());i.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',this.get_id());this._internalRenderActionBar(i);this._registerViewSelectorItems();i.append('<\/td><td class="ViewSelectorControl">');this.get_showViewSelector()&&(i.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:<\/td><td>',t.ActionBar.View),i.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}<\/a><\/span><\/span><\/span>',this.get_id(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),i.append("<\/td><\/tr><\/table>"));i.append("<\/td><\/tr><\/table>");i.append("<\/td><\/tr>")},_renderStatusBar:function(n){n.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"><\/td><\/tr>',this.get_id(),this._get_colSpan())},_updateStatusBar:function(){var i=this.get_statusBar(),t,n;isNullOrEmpty(i)||(n=$(this._get("$StatusBar")),n.length&&(t=this.statusBar(),t?n.html(t).parent().show():n.parent().hide()))},_renderViewDescription:function(i){var a=this._firstLetters&&this._firstLetters.length>2,c=this.get_showDescription(),f,o,e,s,l,r,u,v,h;if(c||a){if(f=c?this.get_description():"",o=null,a){for(e=new Sys.StringBuilder,e.append('<div class="Letters">'),s=this.findField(this._firstLetters[0]),l=null,r=0;r<this._filter.length;r++)if(u=this._filter[r].match(n._fieldFilterRegex),u&&u[1]==s.Name){u=u[2].match(/^\$beginswith\$(.+?)\0$/);u&&(l=this.convertStringToFieldValue(s,u[1]));break}for(v=String.format("{0} {1} ",n.htmlAttributeEncode(s.Label),nt.Text.List[2].Text.toLowerCase()),r=1;r<this._firstLetters.length;r++)h=this._firstLetters[r],e.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}<\/a> ',this.get_id(),r,h,v,n.htmlAttributeEncode(h),l==h?" Selected":"");e.append("<\/div>");o=e.toString();e.clear()}c&&isNullOrEmpty(f)&&(f=this.get_view().HeaderText);(!isNullOrEmpty(f)||this.get_lookupField()||o)&&(i.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',this._get_colSpan()),this.get_lookupField()!=null&&i.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">'),i.appendFormat('<div id="{0}$HeaderText">',this.get_id()),i.append(this._formatViewText(t.Views.DefaultDescriptions[f],!0,f)),i.append("<\/div>"),o&&i.append(o),this.get_lookupField()!=null&&i.appendFormat('<\/td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),w.Close,$nextTabIndex()),i.append("<\/td><\/tr>"))}},_renderInfoBar:function(n){var i=this.get_filter(),t;i.length>0&&!this.filterIsExternal()&&(t=new Sys.StringBuilder,this.get_viewType()!="Form"&&this._renderFilterDetails(t,i),this.get_viewType()=="Form"||t.isEmpty()||(n.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',this.get_id(),this._get_colSpan(),this.get_viewType()),n.append(t.toString()),n.append("<\/td><\/tr>")),t.clear())},_renderPager:function(n,t){var c,u,f,e,o,s,h,a;if(this.get_showPager().indexOf(t)!==-1){if(c=this.get_isChart(),n.appendFormat('<tr class="FooterRow {2}PagerRow"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{1}">',this._get_colSpan(),c?" Print":"",t),u=this.get_pageCount(),f=this.get_pageSize(),c&&(u=1,f=this._totalRowCount,e=this._get_specialAction("Print"),e&&n.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span><\/span><\/a><\/td><td>',e.text,e.script)),u>1){var r=this._firstPageButtonIndex,v=this.get_pagerButtonCount(),y=v;for(this.get_pageIndex()>0?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()-1,this.get_id(),l.Previous,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',l.Previous),n.appendFormat(" | {0}: ",l.Page),r>0&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage(0,true);return false" class="PaddedLink" tabindex="{2}">1<\/a><a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">...<\/a>',r-1,this.get_id(),$nextTabIndex(),$nextTabIndex());y>0&&r<u;)r==this.get_pageIndex()?n.appendFormat('<span class="Selected">{0}<\/span>',r+1):n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',r,this.get_id(),r+1,$nextTabIndex()),r++,y--;r<=u-1&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...<\/a><a href="#" onclick="$find(\'{1}\').goToPage({3}-1,true);return false" class="PaddedLink" tabindex="{4}">{3}<\/a>',this._firstPageButtonIndex+v,this.get_id(),$nextTabIndex(),u,$nextTabIndex());n.append(" | ");this.get_pageIndex()<u-1?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()+1,this.get_id(),l.Next,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',l.Next)}if(n.append('<\/td><td align="right" class="Pager PageSize">&nbsp;'),o=this.get_showPageSize(),s=this._pageSizes,o&&this._totalRowCount>f){for(n.append(l.ItemsPerPage),i=0;i<s.length;i++)i>0&&n.append(", "),f==s[i]?n.appendFormat("<b>{0}<\/b>",f):n.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}<\/a>',this.get_id(),s[i],$nextTabIndex());n.append(" | ")}this._totalRowCount>0&&(h=(this.get_pageIndex()+1)*f,h>this._totalRowCount&&(h=this._totalRowCount),o&&n.appendFormat(l.ShowingItems,this.get_pageIndex()*f+1,h,this._totalRowCount),a=this.multiSelect(),a&&(n.appendFormat('<span id="{0}$SelectionInfo">',this.get_id()),this._selectedKeyList.length>0&&n.appendFormat(l.SelectionInfo,this._selectedKeyList.length),n.append("<\/span>")),(o||a)&&n.append(" | "));n.appendFormat('<\/td><td align="center" class="Pager Refresh" id="{0}_Wait">',this.get_id());this.get_searchOnStart()||n.appendFormat('<a href="#" onclick="$find(\'{0}\').{3}();return false" tabindex="{2}" title="{1}"><span>&nbsp;<\/span><\/a>',this.get_id(),l.Refresh,$nextTabIndex(),this._hasSearchAction?"search":"sync");n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},_cname:function(n){var t=this.get_viewId();return t==null&&(t="grid1"),String.format("{0}${1}${2}",this._id,t,n)},readContext:function(n){return Web.PageState.read(this._cname(n))},writeContext:function(n,t){Web.PageState.write(this._cname(n),t)},_get_template:function(n){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(n?"_"+n:""))},_renderTemplate:function(t,i,r,u,f){for(var o=typeof t=="string"?t:t.innerHTML,l=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,c=0,e=l.exec(o),s,h;e;)c=e.index+e[0].length,i.append(e[1]),s=this.findField(e[2]),s?e[4]&&e[4].length>0?i.appendFormat("{0:"+e[4]+"}",r[s.Index]):this._renderItem(i,s,r,u,f,null,null,null,!0):(h=n.find(e[2]),h&&(this._embeddedViews||(this._embeddedViews=[]),Array.add(this._embeddedViews,{view:h}),i.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"><\/div>',h.get_id()))),e=l.exec(o);c<o.length&&i.append(o.substring(c))},_renderNewRow:function(n){var e,o,s,u,t;if(this.inserting()){var r=this.get_isDataSheet(),l=this._actionColumn&&!r,f=this._get_focusedCell();if(f||(f={colIndex:0}),e=r?null:this._gridTemplates.New,n.appendFormat('<tr class="Row Selected{0}{1}">',e?" InlineFormRow":"",r?" Inserting":""),o=this.multiSelect(),o&&n.append('<td class="Cell Toggle First">&nbsp;<\/td>'),s=this.get_showIcons(),s&&n.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;<\/span><\/td>',o?"":" First"),this.get_isDataSheet()&&n.appendFormat('<td class="Cell Gap"><div class="Icon"><\/div><\/td>',!o&&!s?" First":""),l&&n.append('<td class="Cell ActionColumn">&nbsp;<\/td>'),u=this._newRow?this._newRow:[],this._mergeRowUpdates(u),this._updateVisibility(u),e)n.appendFormat('<td class="Cell" colspan="{0}">',this.get_fields().length),this._renderTemplate(e,n,u,!0,!0),n.append("<\/td>");else for(t=0;t<this._fields.length;t++){var i=this._fields[t],h=this._allFields[i.AliasIndex],c="";r&&(this._editing=f&&f.colIndex==i.ColIndex,this._editing||(c=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",this.get_id(),t)));n.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',h.Name,h.Type,t==0?" FirstColumn":"",t==this._fields.length-1?" LastColumn":"",c);i.ReadOnly||n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index);this._renderItem(n,i,u,!i.OnDemand,null);this._editing=null;n.append("<\/td>")}n.append("<\/tr>");r||this._renderActionButtons(n,"Bottom","Row")}},_iconClicked:function(n){this.get_isDataSheet()||this.get_lookupField()!=null||this._icons&&this._icons[n]=="Attachment"&&(this._lastClickedIcon="Attachment",this.set_autoSelectFirstRow(!0),this._autoSelect(n))},_renderRows:function(n,t,i){var l=this.get_lookupField()!=null,a=this.get_isDataSheet(),it=!l&&this._actionColumn&&!a,pt=it?this.get_actionGroups("ActionColumn",!0):null,wt=this._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,this.get_viewId()),k,rt,d,r,u,v,s,g,et,nt,tt,y,w,yt;for(n.append('<tr class="HeaderRow">'),k=this.get_showIcons(),i&&(n.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/><\/th>',this.get_id()),this._multipleSelection=!1),k&&n.appendFormat('<th class="Icons{0}">&nbsp;<\/th>',i?"":" First"),a&&n.appendFormat('<th class="Gap{0}">&nbsp;<\/th>',!i&&!k?" First":""),it&&n.appendFormat('<th class="FieldHeaderSelector ActionColumn"><span>{0}<\/span><\/th>',this._actionColumn),rt=this.get_sortExpression(),d=rt?rt.match(/^\s*(\w+)((\s+(asc|desc))|(\s*(,|$)))/i):null,r=0;r<this._fields.length;r++)u=this._fields[r],v=u.Name,u=this._allFields[u.AliasIndex],u.Name==v&&(v=""),n.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',u.Name,u.Items.length>0?"String":u.Type,r==0?" FirstColumn":"",r==this._fields.length-1?" LastColumn":"",v),(u.AllowSorting||u.AllowQBE)&&n.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',this.get_id(),r),n.append(">"),u.AllowSorting?(n.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}<\/a>',this.get_id(),u.Name,u.HeaderText,String.format(o.SortBy,u.HeaderText),r,$nextTabIndex()),d&&d[1]==u.Name&&n.append(String.format('<span class="{0}">&nbsp;<\/span>',d[4]?d[4].toLowerCase()=="asc"?"SortUp":"SortDown":"SortUp")),this.filterOf(u)!=null&&n.append('<span class="Filter">&nbsp;<\/span>')):n.appendFormat("<span>{0}<\/span>",u.HeaderText),n.append("<\/th>");n.append("<\/tr>");var e=this._get_focusedCell(),h=this.editing(),ot=this.inserting(),ut=this._lastSelectedRowIndex;this._gridTemplates||(s={Default:this._get_template(),Edit:this._get_template("edit"),New:this._get_template("new")},s.Default&&(s.Default=s.Default.innerHTML),s.Edit=s.Edit?s.Edit.innerHTML:s.Default,s.New=s.New?s.New.innerHTML:s.Default,this._gridTemplates=s);var ft=a?null:this._gridTemplates.Edit,st=a?null:this._gridTemplates.Default,c=null;this._registerRowSelectorItems();var bt=this.get_showRowNumber(),ht=!1;for(r=0;r<this.get_rows().length;r++){var b=this.get_rows()[r],ct=" "+this._evaluateJavaScriptExpressions(wt,b,!0),f=this._rowIsSelected(r);if(f&&(ht=!0),f&&(this._selectedRowIndex=r),g=null,et="",i&&(nt=Array.indexOf(this._selectedKeyList,this._createRowKey(r))!=-1,nt&&(this._multipleSelection=!0),g=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/><\/td>',this.get_id(),r,nt?' checked="checked"':null,nt?" Selected":""),nt&&(et=" MultiSelectedRow")),tt=k?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}<\/span><\/td>',this._icons?this._icons[r]:"",i?"":" First",bt?this.get_pageSize()*this.get_pageIndex()+r+1+(this._pageOffset?this._pageOffset:0):"&nbsp;",this.get_id(),r):"",a&&(tt+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"><\/div><\/td>',this.get_id(),r,!i&&!k?" First":"")),it&&(tt+=this._renderActionColumnCell(b,r,f,pt)),h&&f&&(this._mergeRowUpdates(b),this._updateVisibility(b)),f&&(h&&ft||st))n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',this.get_id(),r,r%2==0?"":"Alternating"," InlineFormRow",this.get_fields().length,g,tt,h?" Editing":""),this._renderTemplate(h&&ft?ft:st,n,b,!0,!0),n.append("<\/td>");else for(n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',this.get_id(),r,r%2==0?"":"Alternating",f?" Selected"+ct:ct,et,t?"":" ReadOnlyRow",a&&!l?"":"onmouseover=\"$(this).addClass('Highlight');\" onmouseout=\"$(this).removeClass('Highlight')\"",f&&h?" Editing":""),g&&n.append(g),n.append(tt),j=0;j<this._fields.length;j++){u=this._fields[j];y=this._allFields[u.AliasIndex];v=u.Name==y.Name?"":u.Name;e&&(this._editing=h&&e.rowIndex==r&&e.colIndex==u.ColIndex);w=j==0&&t;w&&(c=p.HoverMonitor.Families[String.format("{0}$RowSelector${1}",this.get_id(),r)],c&&c.items.length!=0||(w=!1));var lt=j==0?" FirstColumn":"",at=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",this.get_id(),r,j,a&&!l?"dataSheet":"gridView"),vt=j==this._fields.length-1?" LastColumn":"";w&&!l||f&&h||u.OnDemand&&f?n.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',y.Name,u.Items.length>0?"String":y.Type,lt,f&&h&&(!a||e&&e.colIndex==u.ColIndex)?"":at,vt,v):n.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',this.get_id(),r,y.Name,y.Type=="Byte[]"?"Binary":u.Items.length>0?"String":y.Type,lt,at,vt,v);f&&h&&!u.ReadOnly&&n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),u.Index);w&&(!l&&c&&c.items.length>1&&n.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',this.get_id(),r),f&&h||(yt=l||!c||c.items.length==1?"":String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",this.get_id(),r),l?n.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex()):n.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',this.get_id(),r,$nextTabIndex(),yt)));this._renderItem(n,u,b,f,null,w);w&&!h&&(f&&h||n.append("<\/a>"),!l&&c&&c.items.length>1&&n.append("<\/div>"));n.append("<\/td>");e&&(this._editing=null)}n.append("<\/tr>");f&&e==null&&this._renderActionButtons(n,"Bottom","Row");ot&&ut==r&&(ut=-2,this._renderNewRow(n));this._syncFocusedCell&&e&&f&&(e.rowIndex=r)}ot&&ut!=-2&&this._renderNewRow(n);this._saveAndNew&&(this._saveAndNew=!1,this._syncFocusedCell?this.newDataSheetRow():(e=this._get_focusedCell(),e&&(e.colIndex=0,this._moveFocusToNextRow(e,this.get_pageSize()))));this._syncFocusedCell=!1;ht||(this._selectedRowIndex=null)},_renderActionColumnCell:function(t,i,r,u){var l,a,f,h,e,c,o,s,v;for(this._clonedRow=t,r||(l=this.get_lastCommandName(),a=this.get_lastCommandArgument(),this.set_lastCommandName("Select"),this.set_lastCommandArgument(null)),f=new Sys.StringBuilder,f.append('<td class="Cell ActionColumn">'),h=!0,e=0;e<u.length;e++)for(c=u[e],o=0;o<c.Actions.length;o++)s=c.Actions[o],this._isActionAvailable(s)&&(h?h=!1:f.append('<span class="Divider">&nbsp;<\/span>'),f.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}<\/span><\/span><\/span><\/a>',this.get_id(),n.htmlEncode(s.HeaderText),o,e,i,n.htmlEncode(s.Description),s.CssClass));return h&&f.append("&nbsp;"),f.append("<\/td>"),v=f.toString(),f.clear(),this._clonedRow=null,r||(this.set_lastCommandName(l),this.set_lastCommandArgument(a)),v},_skipNextInputListenerClickEvent:function(){(u.agent!=u.InternetExplorer||u.version>=9)&&(this._skipClickEvent=!0)},_gridViewCellFocus:function(n,t){try{var r=new Sys.UI.DomEvent(n),i=r.target;if((i.tagName==="A"||i.parentNode.tagName==="A")&&!this.get_lookupField()||Sys.UI.DomElement.containsCssClass(i,"RowSelector")||i.tagName==="SPAN"&&i.className==="ObjectRef")return!1;this.get_lookupField()&&(r.stopPropagation(),r.preventDefault());this._skipNextInputListenerClickEvent()}catch(u){}return this.executeRowCommand(t,"Select"),!0},_dataSheetCellFocus:function(n,t,i){var r=this._get_focusedCell(),u=this.inserting(),f;if(u&&t!=-1&&(t=-1),i==-1&&(i=r!=null?r.colIndex:0),this.editing()&&r){this._focusCell(-1,-1,!1);this._focusCell(t,i);f=t==r.rowIndex||u&&t==-1;(f||this._updateFocusedRow(r))&&this._updateFocusedCell(r)?f&&t!=this._selectedRowIndex&&!u&&this.cancelDataSheetEdit():(this._focusCell(t,i,!1),this._focusCell(r.rowIndex,r.colIndex));this._skipNextInputListenerClickEvent();return}if(n){if(!this._gridViewCellFocus(n,t,i))return}else this._skipNextInputListenerClickEvent();r==null||r.rowIndex!=t||r.colIndex!=i||this.editing()||this.get_lookupField()?this._startInputListenerOnCell(t,i):(document.selection&&document.selection.clear(),this._skipEditOnClick!=!0&&this._allowEdit()&&this.editDataSheetRow(r.rowIndex));this._skipEditOnClick=!1},_startInputListenerOnCell:function(t,i){if(this._startInputListener(),this._focusCell(-1,-1,!1),this._focusCell(t,i),!this.get_lookupField()){if(n._activeDataSheetId!=this.get_id()){var r=$find(n._activeDataSheetId);r&&r.cancelDataSheet();n._activeDataSheetId=this.get_id()}this._lostFocus=!1}},_startInputListener:function(){this._stopInputListener();this._inputListenerKeyDownHandler||(this._inputListenerKeyDownHandler=Function.createDelegate(this,this._inputListenerKeyDown),this._inputListenerKeyPressHandler=Function.createDelegate(this,this._inputListenerKeyPress),this._inputListenerClickHandler=Function.createDelegate(this,this._inputListenerClick),this._inputListenerDblClickHandler=Function.createDelegate(this,this._inputListenerDblClick),this._focusedCell=null);$addHandler(document,"keydown",this._inputListenerKeyDownHandler);$addHandler(document,"keypress",this._inputListenerKeyPressHandler);$addHandler(document,"click",this._inputListenerClickHandler);$addHandler(document,"dblclick",this._inputListenerDblClickHandler);this._trackingInput=!0},_stopInputListener:function(){this._trackingInput&&($removeHandler(document,"keydown",this._inputListenerKeyDownHandler),$removeHandler(document,"keypress",this._inputListenerKeyPressHandler),$removeHandler(document,"click",this._inputListenerClickHandler),$removeHandler(document,"dblclick",this._inputListenerDblClickHandler),this._lostFocus=!0,this._trackingInput=!1)},cancelDataSheetEdit:function(){if(this.editing()){var n=this._get_focusedCell();return n!=null&&this.executeRowCommand(n.rowIndex,"Cancel",null,!1),!0}return!1},_inputListenerClick:function(n){if(this._skipClickEvent){this._skipClickEvent=!1;return}if(!this._lookupIsActive){for(var t=n.target,r=!1,i=!1,u=!0;t!=null;){if(t==this._container){r=!0;break}t.className!=null&&(t.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/)?i=!0:t.className.match(/QuickFind|SearchBarFrame\s*/)&&(u=!1));t=t.parentNode}r?(this._lostFocus=u?!i:!0,this._skipEditOnClick=!0,i||this.cancelDataSheetEdit()):this.cancelDataSheet()}},_inputListenerDblClick:function(){if(!this._lostFocus){var n=this._get_focusedCell();n&&!this.editing()&&this._allowEdit()&&(document.selection&&document.selection.clear(),this.editDataSheetRow(n.rowIndex))}},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(t,i,r){var k,p,c,e,s,a,f,v,g,y;if(!this.get_isDataSheet())return this._focusedCell=null,null;if(k=this.inserting(),r==null&&(r=!0),t==-1&&i==-1){if(!this._focusedCell)return null;t=this._focusedCell.rowIndex;i=this._focusedCell.colIndex}for(t>=this._rows.length&&(t=this._rows.length-1),i>=this._fields.length&&(i=this._fields.length-1),p=this._container.childNodes[0].rows,c=-1,e=0;e<p.length;e++)if(s=p[e],(Sys.UI.DomElement.containsCssClass(s,"Row")||Sys.UI.DomElement.containsCssClass(s,"AlternatingRow"))&&c++,k){if(Sys.UI.DomElement.containsCssClass(s,"Inserting"))break}else if(c===t)break;if(c<0)return null;for(a=-1,e=0;e<s.childNodes.length;e++)if(f=s.childNodes[e+this.get_sysColCount()],f&&Sys.UI.DomElement.containsCssClass(f,"Cell")&&a++,a===i)break;if(a<0)return null;var d=f.parentNode.childNodes[this.get_sysColCount()-1],w=this._get_headerRowElement(),h=w.childNodes[i+this.get_sysColCount()];if(r===!0){if(v=$common.getBounds(h),Sys.UI.DomElement.addCssClass(f,"Focused"),Sys.UI.DomElement.addCssClass(d,"CrossHair"),Sys.UI.DomElement.addCssClass(h,"CrossHair"),!this._skipCellFocus){var l=n.scrolling(),b=$common.getClientBounds(),o=$common.getBounds(f);l.y>o.y?(c?f:h).scrollIntoView(!0):l.y+b.height<=o.y+o.height?f.scrollIntoView(!1):(l.x>o.x||l.x+b.width-1<=o.x||l.x+b.width-1<=o.x+o.width)&&f.scrollIntoView(!1);u.agent==u.InternetExplorer&&(g=$common.getBounds(w),w.style.height=g.height+"px")}y=$common.getBounds(h);(v.width!==y.width||v.x!==y.x||v.y!==y.y)&&Sys.UI.DomElement.addCssClass(h,"Narrow");this._skipCellFocus=!1}else Sys.UI.DomElement.removeCssClass(f,"Focused"),Sys.UI.DomElement.removeCssClass(f,"Narrow"),Sys.UI.DomElement.removeCssClass(d,"CrossHair"),Sys.UI.DomElement.removeCssClass(h,"CrossHair");return this._focusedCell={rowIndex:t,colIndex:i},f},_initializeModalPopup:function(){var u;Sys.UI.DomElement.addCssClass(this.get_element(),"ModalPlaceholder");var r=$common.getClientBounds(),n=r.width/5*4,i=w.MaxWidth,t=this.get_confirmContext();t&&t.MaxWidth>0&&t.MaxWidth<n&&(i=t.MaxWidth);n>i&&(n=i);u=r.height/5*4;this._container.style.overflowX!=null?(this._container.style.overflowY="auto",this._container.style.overflowX="hidden"):this._container.style.overflow="auto";this._container.style.height=u+"px";this._container.style.width=n+"px";this._saveTabIndexes();this._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"ModalPopup"+d.getComponents().length,PopupControlID:this.get_element().id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this.get_modalAnchor());this._modalPopup.show()},_internalFocus:function(){var n=$get(this._focusId);if(n)try{n.value="";n.value=this._focusText;Sys.UI.DomElement.setCaretPosition(n,this._focusText.length)}catch(t){}},_showFieldError:function(t,i){var r=this._get("_Item",t.Index+"_Error"),f,h,u,o;if(r&&(Sys.UI.DomElement.setVisible(r,i!=null),i))if(this._skipErrorReset=!0,r.style.marginLeft="0px",r.style.marginTop="0px",r.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;<\/span><\/a>',i,w.Close,this.get_id(),t.Name),this.get_isForm())f=$common.getPaddingBox(r.previousSibling?r.previousSibling:r),r.style.marginLeft=f.left+"px",r.style.marginTop="1px";else{var c=n.scrolling(),l=$common.getClientBounds(),s=$common.getBounds(r),e=s.x+s.width-(c.x+l.width);for(e<0&&(e=0),h=$common.getBounds(r.parentNode),f=$common.getPaddingBox(r.parentNode),u=r.nextSibling;u&&u.nodeType!=1;)u=u.nextSibling;o=$common.getBounds(u?u:r);r.style.marginLeft=-(o.x-h.x+1+e)+"px";r.style.marginTop=o.height+f.bottom+"px"}},_focus:function(t,i){var r,f,u,l,s,e,a,o,w,v,c;if(!this._skipFocus){if(i)for(r=0;r<this.get_fields().length;r++)this._showFieldError(this.get_fields()[r]);if(f=this._get_focusedCell(),f&&this.editing()&&this._id===n._activeDataSheetId){if(!isNullOrEmpty(t)){for(u=null,l=!1,r=0;r<this._fields.length;r++)if(u=this._fields[r],u.Name===t){this._focusCell(f.rowIndex,f.colIndex,!1);l=f.colIndex!==r;f={rowIndex:this._selectedRowIndex,colIndex:r};this._continueAfterScript||(this._saveAndNew=!1);break}!isNullOrEmpty(i)&&u&&(l&&(this._focusCell(f.rowIndex,f.colIndex,!0),this.refresh(!0)),this._showFieldError(u,i))}if(s=this._focusCell(f.rowIndex,f.colIndex,!0),s){for(e=s.getElementsByTagName("input"),a=!1,r=0;r<e.length;r++)if(e[r].type!=="hidden"){a=!0;break}for(a||(e=s.getElementsByTagName("textarea")),e.length||(e=s.getElementsByTagName("select")),e.length||(e=s.getElementsByTagName("a")),r=0;r<e.length;r++)if(o=e[r],o.tagName!=="INPUT"||o.type!=="hidden"){(o.tagName==="INPUT"||o.tagName==="TEXTAREA")&&this._pendingChars!=null?(this._focusText=this._pendingChars,this._focusId=o.id,w=this,setTimeout(function(){w._internalFocus()},50)):Sys.UI.DomElement.setFocus(o);break}}this._pendingChars=null;return}for(isNullOrEmpty(t)&&!isNullOrEmpty(this._focusedFieldName)&&(u=this.findField(this._focusedFieldName),u&&(t=u.Name)),this._focusedFieldName=t,r=0;r<this.get_fields().length;r++)if(u=this.get_fields()[r],v=u.ItemsStyle==="AutoComplete"&&(u.Name===t||u.AliasName===t||isNullOrEmpty(t)),!u.ReadOnly&&(t==null||u.Name===t||v)){c=this.get_id()+"_Item"+(v?u.AliasIndex:u.Index);switch(u.ItemsStyle){case"RadioButtonList":case"CheckBoxList":c+="_0";break;case"Lookup":c+="_ShowLookupLink"}var y=$get(c),p=$(y).data("focus"),b=$get(String.format("{0}_ItemContainer{1}",this.get_id(),u.Index)),k=this._categories[u.CategoryIndex],h=Array.indexOf(this._tabs,k.Tab);if(t&&h>=0&&this.set_categoryTabIndex(h),this._toggleCategoryVisibility(u.CategoryIndex,!0),y&&(!b||Sys.UI.DomElement.getVisible(b)||p)&&(t||h===this.get_categoryTabIndex()||!this._tabs.length)){h>=0&&this.set_categoryTabIndex(h);try{i&&this._showFieldError(u,i);p?p():Sys.UI.DomElement.setFocus(y)}catch(d){}break}}}},_createFieldInputExtender:function(n,t,i,r){var u=null;return t.Type.startsWith("DateTime")?(u=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",this.get_id(),n,t.Index,r),button:i.nextSibling},null,null,i),u.set_format(t.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])):t.AllowQBE&&t.Type=="String"&&t.AllowAutoComplete!=!1&&(u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",n,this.get_id(),t.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",this.get_id(),n,t.Index,r),minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:this.get_servicePath(),useContextKey:!0,enableCaching:n!="SearchBar",typeCssClass:n},null,null,i),u._updateClearButton()),u},showFieldFilter:function(t,i,r){var f,u,c,e,o,l,h,s,v,a;for(this._filterExtenders||(this._filterExtenders=[]),f=this._allFields[t],u=this.get_fieldFilter(f),u&&(c=u.match(/^([\s\S]*?)(\0|$)/),c&&(u=c[1])),u=u&&!String.isJavaScriptNull(u)?u.split(n._listRegex):[""],this._filterFieldIndex=t,this._filterFieldFunc=i,e=this._filterElement=document.createElement("div"),e.id=this.get_id()+"$FieldFilter",e.className="FieldFilter",o=new Sys.StringBuilder,l=f.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",o.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}<\/span> <span class="Function">{1}<\/span><\/div><div class="Value"><input type="text" value="{2}"/>{3}<\/div><\/div>',f.HeaderText,r.toLowerCase(),n.htmlAttributeEncode(f.format(this.convertStringToFieldValue(f,u[0]))),l),i=="$between"&&o.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}<\/span><\/div><div class="Value"><input type="text" value="{1}"/>{2}<\/div><\/div>',b.And,n.htmlAttributeEncode(u[1]?f.format(this.convertStringToFieldValue(f,u[1])):""),l),o.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true);return false">{1}<\/button><button onclick="$find(\'{0}\').closeFieldFilter(false);return false">{2}<\/button><\/div>',this.get_id(),w.OkButton,w.CancelButton),e.innerHTML=o.toString(),this._appendModalPanel(e),this._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$FilterPopup",PopupControlID:e.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]),h=e.getElementsByTagName("input"),s=0;s<h.length;s++)v=h[s],a=this._createFieldInputExtender("Filter",f,v,s),a&&Array.add(this._filterExtenders,a);this._saveTabIndexes();this._filterPopup.show();Sys.UI.DomElement.setFocus(h[0]);$(e).find("input:text").keydown(function(n){n.which==13&&(n.preventDefault(),$(e).find("button:first").click())})},closeFieldFilter:function(n){var e=this._filterElement.getElementsByTagName("input"),o=[],r,i,t,u,f;if(n)for(r=this._allFields[this._filterFieldIndex],i=0;i<e.length;i++){if(t=e[i],y(t.value)){alert(ut.RequiredField);Sys.UI.DomElement.setFocus(t);return}if(this._formatSearchField(t,this._filterFieldIndex),u={NewValue:t.value.trim()},f=this._validateFieldValueFormat(r,u),f){alert(f);Sys.UI.DomElement.setFocus(t);return}Array.add(o,r.Type.startsWith("DateTime")?t.value.trim():u.NewValue)}this._disposeFieldFilter();this._restoreTabIndexes();n&&this.applyFieldFilter(null,null,o)},_disposeSearchBarExtenders:function(){if(this._searchBarExtenders){for(var n=0;n<this._searchBarExtenders.length;n++)this._searchBarExtenders[n].dispose();Array.clear(this._searchBarExtenders)}},_disposeFieldFilter:function(){if(this._filterExtenders){for(var n=0;n<this._filterExtenders.length;n++)this._filterExtenders[n].dispose();Array.clear(this._filterExtenders)}this._filterElement&&(this._filterPopup.hide(),this._filterPopup.dispose(),this._filterPopup=null,this._filterElement.parentNode.removeChild(this._filterElement),delete this._filterElement)},_showSearchBarFilter:function(n,t){if(this._searchBarVisibleIndex=t,n==-1){var i=this._get("$SearchBarValue$",t);i.value="";this._searchBarFuncChanged(t);this._searchBarVisibleIndex=null}else this.showCustomFilter(n)},showCustomFilter:function(i){var f=this._allFields[i],u=this._customFilterPanel=document.createElement("div"),r;this._appendModalPanel(u);u.className="CustomFilterDialog";u.id=this.get_id()+"_CustomFilterPanel";r=new Sys.StringBuilder;r.appendFormat('<div><span class="Highlight">{0}<\/span> {1}:<\/div>',n.htmlEncode(f.Label),b.Includes);r.append('<table cellpadding="0" cellspacing="0">');r.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}<\/div><\/td><\/tr>',this.get_id(),i,t.Common.WaitHtml);r.appendFormat('<tr><td><\/td><td align="right"><button id="{0}Ok">{1}<\/button> <button id="{0}Cancel">{2}<\/button><\/td><\/tr>',this.get_id(),w.OkButton,w.CancelButton);r.append("<\/table>");u.innerHTML=r.toString();r.clear();this._customFilterField=f;this._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:this.get_id()+"Ok",CancelControlID:this.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',this.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',this.get_id()),PopupControlID:u.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",this._bodyKeydownHandler);this._loadFilterListOfValues(f.Name)},_loadFilterListOfValues:function(n){this._busy(!0);var t=this.get_lookupContext();this._invoke("GetListOfValues",this._createArgsForListOfValues(n),Function.createDelegate(this,this._onGetFilterListOfValuesComplete),{fieldName:n})},_renderFilterOption:function(n,t,i,r,u){var f=this._findItemByValue(t,i);f&&(i=f[1]);n.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/><\/td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}<\/label><\/td><\/tr>',this.get_id(),t.Index,r,i,u?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(t,i){var f,c,y,l,r,s,e,a,u,h,d,nt;if(this._busy(!1),f=this.findField(i.fieldName),t[t.length-1]==null&&(Array.insert(t,0,t[t.length-1]),Array.removeAt(t,t.length-1)),c=this._get("$CustomFilterItemList$",f.Index),c){for(y=this._searchBarVisibleIndex!=null?this._createSearchBarFilter(!0):this._filter,l=null,this.findFieldUnderAlias(f)._listOfValues=t,r=0;r<y.length;r++)if(s=y[r].match(n._fieldFilterRegex),s[1]==f.Name){l=s[2];break}if(e=null,a="$in$",l&&(s=l.match(n._filterRegex),s))for(s[1].match(/\$(in|notin|between)\$/)?(a=s[1],e=s[3].split(n._listRegex)):e=[s[3]],r=0;r<e.length;r++)u=e[r],String.isJavaScriptNull(u)?e[r]=o.EmptyValue:(u=this.convertStringToFieldValue(f,u),e[r]=f.format(u));h=new Sys.StringBuilder;h.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/><\/td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}<\/label><\/td><\/tr>',this.get_id(),f.Index,b.SelectAll);var p=[],v=[],g=[],w=[],k=this.findFieldUnderAlias(f);for(r=0;r<t.length;r++)u=t[r],d=u,u==null?u=o.EmptyValue:(u=n.htmlEncode(f.format(u)),u==""&&(u=o.BlankValue)),nt=e&&(a=="$in$"&&Array.contains(e,u)||a=="$notin$"&&!Array.contains(e,u)),nt?(Array.add(v,u),Array.add(p,d)):(Array.add(w,u),Array.add(g,d));for(r=0;r<v.length;r++)this._renderFilterOption(h,f,v[r],r,!0);for(r=0;r<w.length;r++)this._renderFilterOption(h,f,w[r],r+v.length,!1);h.append("<\/table>");c.innerHTML=h.toString();Sys.UI.DomElement.setFocus(c.getElementsByTagName("input")[0]);p.length>0&&(k._listOfValues=[],Array.addRange(k._listOfValues,p),Array.addRange(k._listOfValues,g))}},_selectAllFilterItems:function(n){for(var r=this._get("$CustomFilterItemList$",n),t=r.getElementsByTagName("input"),i=1;i<t.length;i++)t[i].checked=t[0].checked},applyCustomFilter:function(){var r=this._customFilterField,u=this._searchBarVisibleIndex!=null?this._get("$SearchBarValue$",this._searchBarVisibleIndex):null,s=u?this._get("$SearchBarFunction$",this._searchBarVisibleIndex):null,t,o;this.removeFromFilter(r);var n=null,h=this._get("$CustomFilterItemList$",r.Index),i=h.getElementsByTagName("input"),e=this.findFieldUnderAlias(r),f=0;for(t=1;t<i.length;t++)i[t].checked&&(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]),f++);if(n&&(f<=10||f!=i.length-1))if(f<=10||f<=(i.length-1)/2)u?s.value="$in,true":Array.add(this._filter,String.format('{0}:$in${1}\0',this._customFilterField.Name,n));else{for(n=null,t=1;t<i.length;t++)i[t].checked||(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]));u?s.value="$notin,true":Array.add(this._filter,String.format('{0}:$notin${1}\0',this._customFilterField.Name,n))}else n=null;for(t=0;t<this._allFields.length;t++)o=this._allFields[t],o!=e&&(o._listOfValues=null);u?(u.value=n?n:"",this._searchBarFuncChanged(this._searchBarVisibleIndex)):(this._forceSync(),this.refreshData());this.closeCustomFilter()},closeCustomFilter:function(){this._customFilterModalPopupBehavior&&(this._customFilterModalPopupBehavior.dispose(),this._customFilterModalPopupBehavior=null,this._customFilterField=null);this._customFilterPanel&&(this._customFilterPanel.parentNode.removeChild(this._customFilterPanel),delete this._customFilterPanel);$removeHandler(document.body,"keydown",this._bodyKeydownHandler);this._customFilterField=null;this._searchBarVisibleIndex=null},_showUploadProgress:function(n,t){var f=$get(String.format("{0}_Frame{1}",this.get_id(),n)),i=$get(String.format("{0}_ProgressBar{1}",this.get_id(),n)),e,u,c,r;if(f!=null&&i!=null){e=$(t).find("input:file");u=e.val().split(/(\\|\/)/);u=u.length>0?u[u.length-1]:null;var l=this.inserting(),o=$(i).show().text(u).focus(),s=$common.getPaddingBox(i),h=$common.getBorderBox(i);i.style.width=f.offsetWidth-s.horizontal-h.horizontal+"px";i.style.height=f.offsetHeight-s.vertical-h.vertical+"px";c=$(f).hide();l?(r=this._pendingUploads,r||(r=this._pendingUploads=[]),r.push({form:t,progress:i}),o.find("a").button("destroy"),o.addClass("dataview-insert").append($(String.format("<a>{0}<\/a>",it)).button({icons:{primary:"ui-icon-close"},text:!1}).click(function(){o.hide();c.show();for(var n=0;n<r.length;n++)if(r[n].form==t){Array.removeAt(r,n);break}e.replaceWith(e.clone(!0))}))):(this._showDownloadProgress(),t.submit())}},_internalRenderActionButtons:function(n,t,i,r){var u,f,e;for(r||(r=this._actionButtonsInScope(i)),this._clonedRow=this._cloneChangedRow(),u=0;u<r.length;u++)action=r[u],this._isActionAvailable(action)&&(f=isNullOrEmpty(action.CssClass)?"":action.CssClass,action.HeaderText&&action.HeaderText.length>10&&(f.length>0&&(f+=" "),f+="AutoWidth"),e=action.CommandName=="None",n.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false" tabindex="{3}" class="{8}{4}"{7}>{2}<\/button>',this.get_id(),u,action.HeaderText,$nextTabIndex(),f,i,e?"return false;":"",e?' disabled="disabled"':"",action.CssClassEx)),action.WhenClientScript&&(this._dynamicActionButtons=!0);this._clonedRow=null},_renderActionButtons:function(n,i,r){var o,s,h,c;if(this.get_showActionButtons().indexOf(i)!=-1&&(o=this._actionButtonsInScope(r),o)){if(s=this._get_colSpan(),h="",r=="Row"&&this._actionColumn&&(s--,h='<td class="ActionColumn">&nbsp;<\/td>'),n.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow {2}Scope">{3}<td colspan="{1}" class="ActionButtons {2}ActionButtons">',i,s,r,h),n.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>'),c=String.format(' id="{0}$ActionButtons${1}"',this.get_id(),i),r=="Form"){var u=this._position,a=u&&u.count>1&&!this.inserting(),v=u&&u.index>0,y=u&&u.index<u.count-1,f=this._get_specialAction("Print"),e=this.get_isModal()?this._get_specialAction("Annotate"):null;n.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span><\/span><\/a><\/td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span><\/span><\/a><\/td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span><\/span><\/a><\/td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span><\/span><\/a><\/td><td class="Instruction" id="{0}_Wait" align="left">{1}<\/td><\/tr><\/table><\/td><td class="Right" align="right"{14}>&nbsp;',i=="Bottom"?this.get_id():"",this.editing()&&t.Form.RequiredFieldMarker?t.Form.RequiredFiledMarkerFootnote:"",this.get_id(),l.Previous,l.Next,v?"":" Disabled",y?"":" Disabled",a?"":" Hidden",f?f.text:"",f?"":" Hidden",f?f.script:null,e?e.text:"",e?"":" Hidden",e?e.script:null,c)}else n.appendFormat("<td{0}>",c);this._internalRenderActionButtons(n,i,r,o);this._lastActionButtonsScope=r;n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},_inputListenerKeyPress:function(n){var t,i;if((!n.rawEvent||n.rawEvent.charCode!=0)&&!this._lostFocus){if(this.editing()){this._pendingChars&&(this._pendingChars+=String.fromCharCode(n.charCode));return}this._isBusy||(t=this._get_focusedCell(),t!=null)&&((i=this._fields[t.colIndex],i.ReadOnly)||this._allowEdit()&&(this.executeRowCommand(t.rowIndex,"Select"),i.isReadOnly()||(this._pendingChars=String.fromCharCode(n.charCode),this.editDataSheetRow(t.rowIndex))))}},_inputListenerKeyDown:function(n){var i,e,f,s;if(!this._lookupIsActive&&!this._lostFocus&&!p.HoverMonitor._instance.get_isOpen()){if(this._isBusy){if(this._pendingChars)return;n.preventDefault();n.stopPropagation();return}if(!this._isBusy&&(i=this._get_focusedCell(),i!=null)){var t={rowIndex:i.rowIndex,colIndex:i.colIndex},r=!1,o=!1,u=this.get_pageSize();this._rows.length<u&&(u=this._rows.length);switch(n.keyCode){case 83:case Sys.UI.Key.enter:if(n.keyCode==83&&!n.ctrlKey)return;if(this.editing()){if(e=n.target&&n.target.tagName,(e=="TEXTAREA"||e=="A")&&!n.ctrlKey)return;r=!0;this._updateFocusedRow(i);n.preventDefault();n.stopPropagation();return}n.ctrlKey&&!this.editing()||this.get_lookupField()?(r=!0,this.executeRowCommand(i.rowIndex,"Select")):n.shiftKey?t.rowIndex>0&&t.rowIndex--:this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.down:if(this.editing()||n.ctrlKey)return;this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.up:if(this.editing()||n.ctrlKey)return;t.rowIndex>0?t.rowIndex--:(this._pageOffset==0&&this.get_pageIndex()==0?(this._pageOffset=null,r=!0):this._pageOffset==null?this.get_pageIndex()>0&&(this._pageOffset=-1):this._pageOffset--,r=!0,this._pageOffset==-u?(this._pageOffset=null,this.get_pageIndex()>0&&this.goToPage(this.get_pageIndex()-1)):this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:if(f=!0,(n.keyCode==Sys.UI.Key.right||n.keyCode==Sys.UI.Key.left)&&this.editing())return;if(!n.shiftKey&&n.target.parentNode.className=="Date")return;if(n.shiftKey&&n.target.id&&n.target.id.match(/\$Time\d+/))return;if(s=this._pageOffset,n.shiftKey||n.keyCode==Sys.UI.Key.left)if(t.colIndex>0){if(t.colIndex--,n.keyCode==Sys.UI.Key.tab)while(t.colIndex>0&&this._fields[t.colIndex].isReadOnly())t.colIndex--}else this.editing()&&(r=!0);else if(t.colIndex<this._fields.length-1){if(t.colIndex++,n.keyCode==Sys.UI.Key.tab)while(t.colIndex<this._fields.length-1&&this._fields[t.colIndex].isReadOnly())t.colIndex++}else{if(this.editing()){if(this._updateFocusedRow(i,n.keyCode==Sys.UI.Key.tab))f=!1;else{n.preventDefault();n.stopPropagation();return}r=!0}f&&this._moveFocusToNextRow(t,u)&&(r=!0);(t.rowIndex!=i.rowIndex||this._pageOffset!=s)&&(t.colIndex=0,r=!1)}f&&this.editing()&&(o=!0);break;case Sys.UI.Key.home:if(this.editing())return;n.ctrlKey?this.get_pageIndex()>0?(r=!0,this._pageOffset=0,this.goToPage(0),i.rowIndex=0,i.colIndex=0):(t.rowIndex=0,t.colIndex=0):t.colIndex=0;break;case Sys.UI.Key.end:if(this.editing())return;n.ctrlKey?(r=!0,i.colIndex=this._fields.length-1,i.rowIndex=this._totalRowCount%this.get_pageSize()-1,i.rowIndex<0&&(i.rowIndex=this.get_pageSize()),this._pageOffset=null,this.goToPage(this.get_pageCount()-1)):t.colIndex=this._fields.length-1;break;case Sys.UI.Key.pageUp:if(this.editing())return;r=!0;this.get_pageIndex()>0?this.goToPage(this.get_pageIndex()-1):this._pageOffset!=null&&(this._pageOffset=null,this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.pageDown:if(this.editing())return;r=!0;this.get_pageIndex()<this.get_pageCount()-1&&this.goToPage(this.get_pageIndex()+1);break;case Sys.UI.Key.esc:this.cancelDataSheetEdit()||this.cancelDataSheet();r=!0;break;case Sys.UI.Key.del:if(this.editing()||n.shiftKey||n.altKey)return;r=!0;n.ctrlKey?this.deleteDataSheetRow():(this._pendingChars="",this.editDataSheetRow(i.rowIndex));break;case 45:this.editing()||(r=!0,this._allowNew()&&this.newDataSheetRow());break;case 32:if(n.ctrlKey&&this.multiSelect()&&!this.inserting())r=!0,this.toggleSelectedRow(i.rowIndex);else return;break;case 113:if(this.editing())return;r=!0;this._allowEdit()&&this.editDataSheetRow(i.rowIndex)}i.rowIndex==t.rowIndex&&i.colIndex==t.colIndex||r||(this._focusCell(i.rowIndex,i.colIndex,!1),this._focusCell(t.rowIndex,t.colIndex,!0),r=!0);r&&(n.preventDefault(),n.stopPropagation());o&&(this._updateFocusedCell(i)||(this._focusCell(t.rowIndex,t.colIndex,!1),this._focusCell(i.rowIndex,i.colIndex,!0)))}}},_updateFocusedCell:function(n){var u=this._collectFieldValues(),e=this._validateFieldValues(u,!0,n),t=this._fields[n.colIndex],f,r,i;if(e)f=!0,t.Index<u.length&&u[t.Index].Modified&&(f=!this._performValueChanged(t.Index)),f&&this.refresh(!0);else if(t.Behaviors)for(r=0;r<t.Behaviors.length;r++)i=t.Behaviors[r],isInstanceOfType(AjaxControlToolkit.CalendarBehavior,i)&&i.get_isOpen()&&(i.hide(),i.show());return e},_updateFocusedRow:function(t,i){return n.showMessage(),this._syncFocusedCell=this.inserting(),this._lastFocusedCell=t,this._skipSync=!0,this.executeRowCommand(t.rowIndex,this._syncFocusedCell?"Insert":"Update",null,!0),this._valid&&(this._saveAndNew=i),this._valid},newDataSheetRow:function(){var n=this;setTimeout(function(){n.executeCommand({commandName:"New",commandArgument:n.get_viewId()})},100)},editDataSheetRow:function(n){this.get_isDataSheet()&&this.executeRowCommand(n,"Edit","",!1)},deleteDataSheetRow:function(){var n=this._get_focusedCell(),t;n&&(this.executeRowCommand(n.rowIndex,"Select"),t=this,setTimeout(function(){t.executeActionInScope(["Row","ActionBar"],"Delete",null,n.rowIndex)},100))},_moveFocusToNextRow:function(n,t){var i=!1,r=this._get_selectedDataRowIndex(n.rowIndex),u=this._pageOffset;return n.rowIndex<t-1?n.rowIndex++:this._get_selectedDataRowIndex(n.rowIndex)<this._totalRowCount-1&&(this._pageOffset==null?this._pageOffset=1:this._pageOffset++,i=!0,this._pageOffset==t?(this._pageOffset=null,this.goToPage(this.get_pageIndex()+1)):this.goToPage(this.get_pageIndex())),r==this._get_selectedDataRowIndex(n.rowIndex)&&!this.editing()&&this._allowNew()&&(this._ignoreSelectedKey=!0,this.newDataSheetRow(),i=!0),i},_scrollToRow:function(){return},_get_selectedDataRowIndex:function(n){return this.get_pageIndex()*this.get_pageSize()+this.get_pageOffset()+(n!=null?n:this._selectedRowIndex)},set_categoryTabIndex:function(n){n!=this._categoryTabIndex&&(this._categoryTabIndex=n,s||(this._updateTabbedCategoryVisibility(),n!=-1&&(this._modalPopup&&(this._resizeContainerBounds(),this._modalPopup.show()),_body_performResize(),this.editing()&&(this._focusedFieldName=null,this._focus()))))},_resizeContainerBounds:function(){this._modalPopup||(this._container.style.height="");var n=$common.getBounds(this._container),i=$common.getClientBounds(),t=Math.ceil(i.height/5*4);return n.height>t&&(this._container.style.height=t+"px",n.skipResizing=!0),n},_adjustModalPopupSize:function(){var s=this.get_confirmContext(),e,o,r,f,h,v;Sys.UI.DomElement.removeCssClass(this._element,"EmptyModalDialog");var t=new Sys.StringBuilder,i=[],a=this._container.getElementsByTagName("table");for(e=a.length-1;e>=0;e--)o=a[e],o.className=="ActionButtons"&&(t.isEmpty()&&(t.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">'),t.append(o.parentNode.parentNode.innerHTML),t.append("<\/tr><\/table>")),Array.add(i,o.parentNode.parentNode));while(i.length>0)i[0].parentNode.removeChild(i[0]),delete i[0],Array.removeAt(i,0);r=this._container.childNodes[0];r.style.width="";r.style.height="";f=$common.getContentSize(r);f.height+=u.agent===u.InternetExplorer&&u.version<8?3:1;this._buttons?this._modalAutoSized||(this._container.style.width="auto",this._modalAutoSized=!0):(this._buttons=document.createElement("div"),this.get_element().appendChild(this._buttons),this._buttons.style.width=f.width+"px",Sys.UI.DomElement.addCssClass(this._buttons,"FixedButtons"),this._title=document.createElement("div"),Sys.UI.DomElement.addCssClass(this._title,"FixedTitle"),this.get_element().insertBefore(this._title,this._container),__designer()||$(this._element).draggable({handle:this._title,drag:function(n,t){var i=k,f=i.width(),e=i.height(),r=t.offset.left-i.scrollLeft(),u=t.offset.top-i.scrollTop(),o=t.helper.outerWidth();if(r+o<50||u<5||r>f-50||u>e-75)return!1}}));this._buttons.innerHTML=t.toString();t.clear();h=this._resizeContainerBounds();h.height>f.height&&!h.skipResizing&&(v=$common.getBorderBox(r),f.width+=v.horizontal,$common.setContentSize(this._container,f));r.style.width=this._title.offsetWidth+"px";this._buttons.style.width=this._title.offsetWidth+"px";Sys.UI.DomElement.setVisible(this.get_element(),!0);var y=$common.getBounds(this._container),c=$common.getPaddingBox(this._title),l=$common.getBorderBox(this._title);this._title.style.width=y.width-c.horizontal-l.horizontal+"px";c=$common.getPaddingBox(this._buttons);l=$common.getBorderBox(this._buttons);this._buttons.style.width=y.width-c.horizontal-l.horizontal+"px";this._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}<\/div><\/td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),s&&s.WindowTitle?s.WindowTitle:n.htmlEncode(this.get_view().Label),w.Close,$nextTabIndex());this._modalPopup.show();this._modalAutoSized&&!this._modalWidthFixed&&(this._modalWidthFixed=!0,this._container.style.width=this._container.offsetWidth+"px");this._adjustModalHeight(!0)},_adjustModalHeight:function(n){var t=this._container,o,s,i,f,r,h,e,c;if(this._modalPopup&&this.get_viewType()=="Form")if(n)this._lastContainerHeight=$(t).height();else if(this._lastContainerHeight!=null){for(o=t.style.height,s=t.scrollTop,t.style.height="",i=null,f=t.getElementsByTagName("tr"),r=0;r<f.length;r++)if(f[r].className=="Categories"){i=f[r].childNodes[0];break}i&&(i.style.paddingBottom="");containerBounds=$common.getBounds(t);this._lastContainerHeight>containerBounds.height?i&&(h=$common.getPaddingBox(i),e=this._lastContainerHeight-containerBounds.height-h.bottom,u.agent==u.InternetExplorer&&e++,i.style.paddingBottom=e+"px"):(c=$common.getClientBounds(),c.height*.8<=containerBounds.height?(t.style.height=o,t.scrollTop=s):this._lastContainerHeight=containerBounds.height)}},_disposeModalPopup:function(){if(this._modalPopup){this._modalPopup.hide();this._modalPopup.dispose();__designer()||$(this._element).draggable("destroy");delete this._buttons;delete this._title;delete this._modalAnchor;var n=this.get_element();n.parentNode.removeChild(n);this._restoreTabIndexes()}},_adjustLookupSize:function(){if(this.get_lookupField()&&this.get_pageSize()>3){var i=n.scrolling(),r=$common.getClientBounds(),t=$common.getBounds(this.get_element());t.height+t.y>r.height+i.y&&this.set_pageSize(Math.ceil(this.get_pageSize()*.66))}},_get_LEVs:function(){for(var t,i=0;i<n.LEVs.length;i++)if(t=n.LEVs[i],t.controller==this.get_controller())return t.records;return t={controller:this.get_controller(),records:[]},Array.add(n.LEVs,t),t.records},_recordLEVs:function(n){var t,r,i;if(this._allowLEVs&&(n||this._lastArgs.CommandName.match(/Insert|Update/))&&(this._lastArgs||n)){for(n||(n=this._lastArgs.Values),t=this._get_LEVs(),r=!0,i=0;i<n.length;i++)if(n[i].Modified){r=!1;break}r||(t.length>0&&Array.removeAt(t,t.length-1),Array.insert(t,0,n))}},_applyLEV:function(n){for(var t,r=this._allFields[n],e=this._allFields[r.AliasIndex],u=[],f=this._get_LEVs()[0],i=0;i<f.length;i++)t=f[i],(t.Name==r.Name||t.Name==e.Name)&&Array.add(u,{name:t.Name,value:t.NewValue});this.refresh(!0,u)},_useLEVs:function(n){var r,t,e,u;if(n&&this._allowLEVs&&(r=this._get_LEVs(),r.length>0))for(i=0;i<r[0].length;i++)if(t=r[0][i],f=this.findField(t.Name),f&&f.AllowLEV){if(this._lastCommandName==="New"&&t.Modified&&t.NewValue!=null){for(e=!0,u=0;u<this._externalFilter.length;u++)if(this._externalFilter[u].Name.toLowerCase()===t.Name.toLowerCase()){e=!1;break}e&&(n[f.Index]=t.NewValue)}f._LEV=t.Modified?t.NewValue:null}},_bodyKeydown:function(n){var t=!1;this._customFilterField?n.keyCode==Sys.UI.Key.enter?(t=!0,this.applyCustomFilter()):n.keyCode==Sys.UI.Key.esc&&(t=!0,this.closeCustomFilter()):this.get_lookupField()&&n.keyCode==Sys.UI.Key.esc&&(t=!0,this.hideLookup());t&&(n.preventDefault(),n.stopPropagation())},_refreshActionButtons:function(){var t=this._get("$ActionButtons$","Top"),n;t&&this._newTopActionButtons&&(t.innerHTML=this._newTopActionButtons,this._newTopActionButtons=null);n=this._get("$ActionButtons$","Bottom");n&&this._newBottomActionButtons&&(n.innerHTML=this._newBottomActionButtons,this._newBottomActionButtons=null)},_quickFind_focus:function(){var n=this.get_quickFindElement();n.value==a.QuickFindText&&(n.value="");Sys.UI.DomElement.removeCssClass(n,"Empty");Sys.UI.DomElement.removeCssClass(n,"NonEmpty");n.select();this._lostFocus=!0},_quickFind_blur:function(){var n=this.get_quickFindElement();y(n.value)?(n.value=a.QuickFindText,Sys.UI.DomElement.addCssClass(n,"Empty")):Sys.UI.DomElement.addCssClass(n,"NonEmpty");this._lostFocus=!1},showLookup:function(n){var i,e,r,u,f;this.get_enabled()&&(i=this._allFields[n],i._lookupModalBehavior?i._lookupDataControllerBehavior._render():(e=$get(this.get_id()+"_Item"+i.Index+"_ShowLookupLink"),e&&(r=i._lookupModalPanel=document.createElement("div"),this._appendModalPanel(r),r.className="ModalPanel",r.id=this.get_id()+"_ItemLookupPanel"+i.Index,r.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"><\/div><\/td><td><div style="height:1px;font-size:1px"><\/div><\/td><\/tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"><\/td><td class="RightSideShadow"><\/td><\/tr><tr><td colspan="2"><div class="BottomShadow"><\/div><\/td><\/tr><\/table><\/td><\/tr><\/table>',this.get_id(),i.Index),i._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"_ItemLookup"+i.Index,PopupControlID:r.id,BackgroundCssClass:"ModalBackground"},null,null,e))),u=this.get_contextFilter(i),f=!0,i._lookupDataControllerBehavior?u.length>0&&(i._lookupDataControllerBehavior.set_externalFilter(u),i._lookupDataControllerBehavior.goToPage(-1),f=!0):(f=!1,i._lookupDataControllerBehavior=$create(Web.DataView,{id:this.get_id()+"_LookupView"+n,baseUrl:this.get_baseUrl(),pageSize:i.ItemsPageSize?i.ItemsPageSize:l.PageSizes[0],showFirstLetters:i.ItemsLetters,servicePath:this.get_servicePath(),controller:i.ItemsDataController,viewId:i.ItemsDataView,showActionBar:t.Lookup.ShowActionBar,lookupField:i,externalFilter:u,filterSource:u.length>0?"Context":null,showSearchBar:this.get_showSearchBar(),searchOnStart:this.get_showSearchBar()&&i.SearchOnStart,description:i.ItemsDescription},null,null,$get(this.get_id()+"_ItemLookupPlaceholder"+i.Index))),this._saveTabIndexes(),i._lookupModalBehavior.show(),f&&i._lookupDataControllerBehavior._focusQuickFind(!0),$addHandler(document.body,"keydown",i._lookupDataControllerBehavior._bodyKeydownHandler),i._lookupDataControllerBehavior._adjustLookupSize(),this._lookupIsActive=!0)},changeLookupValue:function(n,t,i){var u=this._allFields[n],r=this;r._focusedFieldName=u.Name;setTimeout(function(){var f,o,e;r._restoreTabIndexes();f=r.get_id()+"_Item"+n;o=r.get_id()+"_Item"+u.AliasIndex;Sys.UI.DomElement.setVisible($get(f+"_ClearLookupLink"),!0);e=$get(f+"_ShowLookupLink");e.innerHTML=r.htmlEncode(u,i);Sys.UI.DomElement.setFocus(e);t&&(t=u.format(t));$get(f).value=t;f!=o&&($get(o).value=i);$(e).closest("table").css("width","");r._updateLookupInfo(t,i);r._valueChanged(n);r._adjustModalHeight()},0);r._closeLookup(u)},clearLookupValue:function(n){var i=this._allFields[n],r=this.get_id()+"_Item"+n,o=this.get_id()+"_Item"+i.AliasIndex;if(Sys.UI.DomElement.setVisible($get(r+"_ClearLookupLink"),!1),$get(r+"_ShowLookupLink").innerHTML=t.Lookup.SelectLink,$get(r).value="",$get(o).value="",!isNullOrEmpty(i.Copy)){for(var f=[],e=/(\w+)=(\w+)/g,u=e.exec(i.Copy);u;)u[2]=="null"&&Array.add(f,{name:u[1],value:null}),u=e.exec(i.Copy);f.length>0&&this.refresh(!0,f)}this._updateLookupInfo("",t.Lookup.SelectLink);$get(r+"_ShowLookupLink").focus();this._valueChanged(n);this._adjustModalHeight()},_updateLookupInfo:function(n,t){var i=$get(this.get_id()+"_Text0"),r,u;i&&(i.value=t,i.name=i.id,r=$get(this.get_id()+"_Item0"),r.value=n,r.name=r.id,this.get_lookupPostBackExpression()&&(u=Sys.WebForms.PageRequestManager.getInstance(),u?eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+this.get_lookupPostBackExpression().match(/\w+(.+)/)[1]):eval(this.get_lookupPostBackExpression())))},createNewLookupValue:function(t){var i=this._newLookupValueField=this._allFields[t],r=this._createNewView=n.showModal(this,i.ItemsDataController,i.ItemsNewDataView,"New",i.ItemsNewDataView,this.get_baseUrl(),this.get_servicePath(),this.get_contextFilter(i));r._parentDataViewId=this.get_id();r.add_executed(Function.createDelegate(this,this._saveNewLookupValueCompleted));r.set_showSearchBar(this.get_showSearchBar());this._lookupIsActive=!0},_saveNewLookupValueCompleted:function(t,r){var u,s,e;if(!(r.result.Errors.length>0)){r.handled=!0;n.hideMessage();var h=null,f=this._newLookupValueField,o=f.ItemsDataValueField;for(isNullOrEmpty(o)&&(o=t._keyFields[0].Name),r.result.Values.length==0&&(r.result.Values=t._lastArgs.Values),u=0;u<r.result.Values.length;u++)if(r.result.Values[u].Name==o){h=r.result.Values[u].NewValue;break}for(s=null,e=f.ItemsDataTextField,isNullOrEmpty(e)&&(e=t._fields[0].Name),i=0;i<t._lastArgs.Values.length;i++)if(t._lastArgs.Values[i].Name==e){s=t._lastArgs.Values[i].NewValue;break}this._createNewView.endModalState("Cancel");this._copyLookupValues(null,f,t._lastArgs.Values);this.changeLookupValue(f.Index,h,s);this._lookupIsActive=!1}},hideLookup:function(n){var i=n?this._allFields[n]:this.get_lookupField(),t=this.get_lookupField()._dataView;t._closeLookup(i);t._restoreTabIndexes();$get(t.get_id()+"_Item"+i.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var n=this.get_lookupField();n._dataView.createNewLookupValue(n.Index)},_valueChanged:function(t){var r=this._allFields[t],i;this._showFieldError(r,null);this._skipErrorReset=!1;i=this;i._valueChangedTimeout=setTimeout(function(){n._navigated||i._performValueChanged(t,!0)},200)},_performValueChanged:function(n,t){var i=this._allFields[n],r,u,f;if(i){if(this._skipErrorReset){this._skipErrorReset=!1;return}return this._showFieldError(i,null),this._replaceFieldValue(i),r=this._resetContextLookupValues(i),u=this._copyStaticLookupValues(i),this._updateVisibility(),f=this._updateDynamicValues(i),t&&this._readOnlyChanged&&this.editing()&&(this.refresh(!0),this._focus()),u||f||r||this._readOnlyChanged}},_updateVisibility:function(n){var p,s,h,w,u,e,t,i,f,c,r,l,b,g,a,tt,o,it,y,d;if(this._expressions&&(this._readOnlyChanged=!1,p=this.get_isForm(),s=[],n||(n=this._cloneChangedRow()),n)){for(h=!1,w=!1,u=0;u<this._expressions.length;u++)e=s[0]=this._expressions[u],e.Type==Web.DynamicExpressionType.ClientScript&&(e.Scope==Web.DynamicExpressionScope.DataFieldVisibility?(t=this.findField(e.Target),t&&(i=this._get(p?"_ItemContainer":"Item",t.Index),i&&(f=this._evaluateJavaScriptExpressions(s,n,!1),p&&(c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.containsCssClass(i.parentNode,"FieldPlaceholder")?i=i.parentNode:Sys.UI.DomElement.containsCssClass(i.parentNode.parentNode,"FieldWrapper")&&(i=i.parentNode.parentNode.parentNode.parentNode),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0))))):e.Scope==Web.DynamicExpressionScope.CategoryVisibility?(r=this.findCategory(e.Target),r&&(i=this._get("_Category",r.Index),i&&(r.IsVisible=this._evaluateJavaScriptExpressions(s,n,!1),f=r.IsVisible&&(isNullOrEmpty(r.Tab)||r.Tab==this._get_selectedTab()),c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0),l=this._get("$CategoryDescription$",r.Index),l&&(b=this._processTemplatedText(n,r.Description),l.innerHTML=b,l.style.display=isNullOrEmpty(b)?"none":"block"),isNullOrEmpty(r.Tab)||(w=!0)))):e.Scope==Web.DynamicExpressionScope.ReadOnly&&(t=this.findField(e.Target),t&&(t.OriginalTextMode==null&&(t.OriginalTextMode=t.TextMode),g=t.isReadOnly(),f=this._evaluateJavaScriptExpressions(s,n,!1),t.TextMode=f==!0?4:t.OriginalTextMode,f!=g&&(h=!0,this._readOnlyChanged=!0))));if(w)for(u=0;u<this._tabs.length;u++){var rt=this._tabs[u],nt=!1,k=!1;for(a=0;a<this._categories.length;a++)if(r=this._categories[a],r.Tab==rt&&r.IsVisible!=null&&(nt=!0,k=r.IsVisible,k))break;nt&&Sys.UI.DomElement.setVisible(this._get("_Tab",u),k)}if(this._dynamicActionButtons&&(this._clonedRow=n,tt=this._get("$ActionButtons$","Top"),tt&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Top",this._lastActionButtonsScope),this._newTopActionButtons=o.toString(),o.clear()),it=this._get("$ActionButtons$","Bottom"),it&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Bottom",this._lastActionButtonsScope),this._newBottomActionButtons=o.toString(),o.clear()),y=this,setTimeout(function(){y._refreshActionButtons()},500),this._clonedRow=null),this._updateStatusBar(),h&&(this._adjustModalHeight(),this._modalPopup&&this._modalPopup.show(),_body_performResize()),this.editing()&&!this._lookupIsActive)for(d=this._get_focusedCell(),u=0;u<this._fields.length;u++)if(t=this._fields[u],!t.ReadOnly&&!t.Hidden&&t.AutoSelect&&t.ItemsStyle=="Lookup"&&(d==null||d.colIndex==t.ColIndex)&&(t.AutoSelect=!1,v=n[t.Index],v==null)){this._lookupIsActive=!0;y=this;setTimeout(function(){y.showLookup(t.Index)},100);break}}},cancelDataSheet:function(){this.get_isDataSheet()&&(this._focusCell(-1,-1,!1),this._stopInputListener(),this.set_ditto(null),n._activeDataSheetId=null,this.cancelDataSheetEdit(),this._lostFocus=!1,this._focusedCell=null)},initialize:function(){n.callBaseMethod(this,"initialize");this._filterSourceSelectedHandler=Function.createDelegate(this,this._filterSourceSelected);this._bodyKeydownHandler=Function.createDelegate(this,this._bodyKeydown);this._quickFindHandlers={focus:this._quickFind_focus,blur:this._quickFind_blur,keydown:this._quickFind_keydown};this._checkMaxLengthHandler=function(n){var t=ct(this.getAttribute("maxlength"));this.value.length>t&&(this.value=this.value.substr(0,t),n.preventDefault(),n.stopPropagation())}},_updateLayoutContainerVisibility:function(t){var u=this,i,f,e,o,r,s,h,l,y,a,v,c;if(u._forceVisible&&(t=!0),i=u._element.parentNode,isNullOrEmpty(i.getAttribute("data-visibility-controller"))&&i.setAttribute("data-visibility-controller",u.get_id()),f=isNullOrEmpty(u.dataAttr(i,"activator"))?null:u.dataAttr(i,"activator").match(/^\s*(\w+)\s*\|\s*(.+?)\s*(\|\s*(.+)\s*)?$/),u.get_autoHide()==Web.AutoHideMode.Self){for(u._element.style.display=t?"":"none",t||(t=$(u._element).siblings().is(":visible")),e=i.parentNode.childNodes[0];e.tagName!="DIV";)e=e.nextSibling;if(f&&f[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(e,"TabBar")){if(i.getAttribute("data-visibility-controller")==u.get_id()){for(o=-1,r=0;r<i.parentNode.childNodes.length;r++)if(s=i.parentNode.childNodes[r],s.className&&Sys.UI.DomElement.containsCssClass(s,"TabBody")&&o++,i==s)break;if(o!=-1&&(h=e.getElementsByTagName("td"),l=h[o],l.style.display=t?"":"none",!t&&Sys.UI.DomElement.containsCssClass(l,"Selected")))for(y=e.getElementsByTagName("a"),r=0;r<h.length;r++)if($common.getVisible(h[r])){$find(i.parentNode.id+"$ActivatorMenu").select(r,y[r]);break}}}else u.dataAttr(i,"hidden",!t)}else for(f&&f[1]=="SideBarTask"&&u.dataAttr(i,"hidden",!0);i;){if(!isNullOrEmpty(u.dataAttr(i,"flow"))){i.style.display=t?"":"none";break}i=i.parentNode}if(a=$get("PageContentSideBar"),a&&f)for(v=a.getElementsByTagName("a"),r=0;r<v.length;r++)if(c=v[r],Sys.UI.DomElement.containsCssClass(c.parentNode,"Task")&&c.innerHTML==f[2]){c.parentNode.style.display=t?"":"none";break}n._loaded&&_body_resize()},loadPage:function(){var t=this.get_isDisplayed();this._showWait(!t);this.get_mode()==Web.DataViewMode.View&&!this.get_lookupField()&&(this._delayedLoading=!t)?Array.contains(n._delayedLoadingViews,this)||(Array.add(n._delayedLoadingViews,this),n._startDelayedLoading()):this._source||this._loadPage()},_saveTabIndexes:function(){var t,u,i,r;for(this._lastSavedTabIndexes=this._savedTabIndexes,this._savedTabIndexes=[],t=0;t<n._tagsWithIndexes.length;t++)for(u=document.getElementsByTagName(n._tagsWithIndexes[t]),i=0;i<u.length;i++)r=u[i],r&&Array.add(this._savedTabIndexes,{element:r,tabIndex:r.tabIndex})},_restoreTabIndexes:function(){if(this._savedTabIndexes){for(var n=0;n<this._savedTabIndexes.length;n++)this._savedTabIndexes[n].element.tabIndex=this._savedTabIndexes[n].tabIndex,delete this._savedTabIndexes[n].element;Array.clear(this._savedTabIndexes)}this._savedTabIndexes=this._lastSavedTabIndexes;this._lastSavedTabIndexes=null},_showImport:function(n){n||(n=this.get_viewId());this._importView=n;this._importElement=document.createElement("div");this._importElement.id=this.get_id()+"$Import";this._importElement.className="Import";var t=new Sys.StringBuilder,i=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}<\/a>",this.get_id(),n,e.Import.DownloadTemplate);t.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}<\/span> {2}<\/div>',this.get_id(),e.Import.UploadInstruction,i);t.appendFormat('<div id="{0}$ImportMap" class="Map" style="display:none"><\/div>',this.get_id());t.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"><\/iframe>',this.get_id(),this.resolveClientUrl(this.get_appRootPath()+"Import.ashx"),this.get_controller(),n);t.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/><\/div>',this.get_id(),e.Import.Email);t.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false" style="display:none">{1}<\/button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false">{2}<\/button><\/div>',this.get_id(),e.Import.StartButton,w.CancelButton);this._importElement.innerHTML=t.toLocaleString();this._appendModalPanel(this._importElement);this._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$ImportPopup",PopupControlID:this._importElement.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._saveTabIndexes();this._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){this._importElement&&(this._importPopup.hide(),this._importPopup.dispose(),this._importPopup=null,this._importElement.parentNode.removeChild(this._importElement),delete this._importElement)},_downloadImportTemplate:function(n){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),n)})},_initImportUpload:function(n){var t=n.createElement("div");t.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/><\/form>',this.get_id());n.body.appendChild(t);Sys.UI.DomElement.setFocus(n.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(n){var t=n.split(/\\/);this._importFileName=t[t.length-1];Sys.UI.DomElement.setVisible(this._get_importFrame(),!1);$(this._get_importStatus()).addClass("Wait");this._get_importStatus().innerHTML=e.Import.Uploading},_finishImportUpload:function(t){var h,l,i,r,a,f,o,s,y,v;if(Sys.UI.DomElement.removeCssClass(this._get_importStatus(),"Wait"),Sys.UI.DomElement.addCssClass(this._get_importStatus(),"Ready"),h=t.getElementById("Errors"),h)this._get_importStatus().innerHTML=h.value;else{var w=t.getElementById("FileName"),p=t.getElementById("NumberOfRecords"),u=t.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),c=t.getElementById("FieldMap").value.trim().split(/\r?\n/);for(this._get_importStatus().innerHTML=String.format(e.Import.MappingInstruction,p.value,this._importFileName),this._importFileName=t.getElementById("FileName").value,l=$get(this.get_id()+"$StartImport"),Sys.UI.DomElement.setVisible(l,!0),Sys.UI.DomElement.setFocus(l),i=new Sys.StringBuilder,i.append("<table>"),r=0;r<c.length;r++){for(a=c[r].match(/^(.+?)=(.+?)?$/),i.appendFormat('<tr><td>{2}<\/td><td><select id="{0}$ImportField{1}"><option value="">{3}<\/option>',this.get_id(),r,n.htmlEncode(a[1]),e.Import.AutoDetect),f=0;f<u.length;f++)o=u[f].split("="),o[0]==a[2]&&(i.appendFormat('<option value="{0}"',o[0]),i.append(' selected="selected"'),i.appendFormat(">{0}<\/option>",n.htmlEncode(o[1])));i.append("<\/select><\/td><\/tr>")}i.append("<\/table>");s=$get(this.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(s,!0);s.innerHTML=i.toString();y=$(s).find("select").change(function(){v()});v=function(){var i=Array.clone(c),t=[],n=0;y.each(function(){$(this).css("width","auto");this.value!=""&&Array.add(t,this.value)}).each(function(){var r=this,n,i;for($(r).find("option").filter(function(){return r.value!=this.value&&this.value!=""}).remove(),n=0;n<u.length;n++)i=u[n].split("="),Array.contains(t,i[0])||$(this).append($("<option>",{value:i[0]}).text(i[1]))}).each(function(){var t=$(this).outerWidth();t>n&&(n=t)}).css("width",n)};v()}this._importPopup.show();this._get_importFrame().parentNode.removeChild(this._get_importFrame())},_startImportProcessing:function(){var r=$get(this.get_id()+"$ImportEmail"),u=r.value.replace(/;/g,","),n,t,i;if(y(u)&&!confirm(e.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(r);return}for(n=new Sys.StringBuilder,n.appendFormat("{0};{1};{2};{3};",this._importFileName,this.get_controller(),this._importView,u),t=0;;){if(i=$get(this.get_id()+"$ImportField"+t),!i)break;n.append(i.value);n.append(";");t++}this.executeCommand({commandName:"ProcessImportFile",commandArgument:n.toString()});this._closeImport();alert(e.Import.Processing);this.refresh()},toggleSelectedRow:function(n){for(var s=n!=null?n:0,h=n!=null?n:this._rows.length-1,c=$get(this.get_id()+"_ToggleButton"),f,e,u,i,t,o,r=s;r<=h;r++)if(e=this._createRowKey(r),f=Array.indexOf(this._selectedKeyList,e),f!=-1&&Array.removeAt(this._selectedKeyList,f),u=n==null?c.checked:f==-1,u&&Array.add(this._selectedKeyList,e),i=$get(this.get_id()+"_CheckBox"+r),i){for(i.checked=u,u?$(i).addClass("Selected"):$(i).removeClass("Selected"),t=i;t&&t.tagName!="TR";)t=t.parentNode;u?$(t).addClass("MultiSelectedRow"):$(t).removeClass("MultiSelectedRow")}this._skipCellFocus=this.get_isDataSheet();this.set_selectedValue(this._selectedKeyList.join(";"));o=$get(this.get_id()+"$SelectionInfo");o&&(o.innerHTML=this._selectedKeyList.length?String.format(l.SelectionInfo,this._selectedKeyList.length):"");n>=0?this.executeRowCommand(n,"Select"):this.delayedRefresh()},get_isDisplayed:function(){if(this._hidden)return!1;var t=this.get_element(),n;if(!t)return!1;for(n=t&&t.parentNode;n!=null;){if(n.getAttribute&&n.tagName!=="TABLE"&&this.dataAttr(n,"activator")&&!n._activated||n.style&&n.style.display==="none")return!1;n=n.parentNode}return!0},dataAttr:function(n,t,i){var r=$(n),u="data-"+t;if(i)r.attr(u,i);else return i=r.attr(u),i||(i=r.attr("factory:"+t)),i},_closeLookup:function(n){if($closeHovers(),n&&n._lookupModalBehavior&&(n._lookupModalBehavior.hide(),$removeHandler(document.body,"keydown",n._lookupDataControllerBehavior._bodyKeydownHandler)),this._lookupIsActive=!1,r.event){var t=new Sys.UI.DomEvent(event);t.stopPropagation();t.preventDefault()}},_collectFieldValues:function(t){var c,v,s,u,e,o,k,tt,f,h,l,p,d,b,g,w,a;if(t=!0,s=this.inserting(),c=[],v=this.get_selectedRow(),!v&&!s)return c;for(u=0;u<this._allFields.length;u++){var i=this._allFields[u],nt=i.ItemsStyle=="RadioButtonList",r=this._get("_Item",u);if(i.ReadOnly&&!t)r=null;else if(nt)for(e=0,o=$get(this.get_id()+"_Item"+u+"_"+e);o;){if(o.checked){r=o;break}else r=null;e++;o=$get(this.get_id()+"_Item"+u+"_"+e)}else if(i.ItemsStyle=="CheckBoxList"&&r&&(e=0,o=$get(this.get_id()+"_Item"+u+"_"+e),o))for(r.value="";o;)o.checked&&(r.value.length>0&&(r.value+=","),r.value+=o.value),e++,o=$get(this.get_id()+"_Item"+u+"_"+e);i.ClientEditor&&r?i.ClientEditor=="Web$DataView$RichText"&&(k=n.EditorFactories[i.ClientEditor.replace(".","$")],k.persist&&k.persist(r)):i.Editor&&r&&(tt=$get(r.id+"$Frame"),tt&&(editor=n.Editors[i.EditorId],editor&&(r.value=editor.GetValue())));f=r?r.value:null;f&&(i.Type.startsWith("Date")?(h=Date.tryParseFuzzyDate(f,i.DataFormatString),h!=null&&r.type=="text"&&(f=r.value=i.DateFmtStr?String.format(i.DateFmtStr,h):i.format(h))):!y(i.DataFormatString)&&i.isNumber()&&(l=Number.tryParse(f),l!=null&&(i.DataFormatString.match(/\{0:p\}/i)&&l>1&&(l=l/100),f=r.value=i.format(l))));i.TimeFmtStr&&(p=this._get("_Item$Time",u),p&&(h=Date.tryParseFuzzyTime(p.value),h!=null&&(p.value=String.localeFormat(i.TimeFmtStr,h),f+=" "+p.value)));!i.OnDemand&&(r||i.IsPrimaryKey||!i.ReadOnly||t)&&(d=!0,b=!1,this._lastCommandName=="BatchEdit"&&(g=$get(String.format("{0}$BatchSelect{1}",this.get_id(),i.Index)),b=i.TextMode==4||i.Hidden||i.ReadOnly,d=i.IsPrimaryKey||b||g&&g.checked),d&&Array.add(c,{Name:i.Name,OldValue:s?null:v[i.Index],NewValue:r&&f!=null?i.Type=="Boolean"&&f.length>0?f=="true":f.length==0?null:f:!s&&(i.TextMode==4||i.Hidden||i.ReadOnly)?v[i.Index]:null,Modified:r!=null&&!(!s&&i.Type=="String"&&isNullOrEmpty(f)&&isNullOrEmpty(v[i.Index]))||nt&&s&&!i.AllowNulls,ReadOnly:i.ReadOnly&&!(i.IsPrimaryKey&&s)||b}))}for(u=0;u<this._externalFilter.length;u++)for(w=this._externalFilter[u],e=0;e<c.length;e++)if(a=c[e],a.Name.toLowerCase()==w.Name.toLowerCase()&&a.NewValue==null){a.NewValue=typeof w.Value=="string"?this.convertStringToFieldValue(this.findField(a.Name),w.Value):w.Value;a.Modified=!0;break}return c},_showWait:function(n){var u=t.Common.WaitHtml,i,r;this.get_fields()==null||n?(this._container.innerHTML=this.get_isModal()||this.get_lookupField()?u:'<div class="dataview-busy-whitespace"><\/div>',$(this._container).find(".Wait").addClass("dataview")):(i=$get(this.get_id()+"_Wait"),i&&(this._oldWaitHTML=i.innerHTML,i.innerHTML=u));r=this.extension();r&&r.wait()},_hideWait:function(){if(this._oldWaitHTML!=null){var n=$get(this.get_id()+"_Wait");n&&(n.innerHTML=this._oldWaitHTML)}},_get_colSpan:function(){return this.get_isForm()?2:this.get_fields().length+(this.multiSelect()?1:0)+(this.get_showIcons()?1:0)+(this.get_isDataSheet()?1:0)+(this._actionColumn?1:0)},_renderCreateNewBegin:function(n,t){isNullOrEmpty(t.ItemsNewDataView)||n.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(n,i){isNullOrEmpty(i.ItemsNewDataView)||(n.append("<\/td><td>"),this.get_enabled()&&n.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;<\/a>',this.get_id(),i.Index,String.format(t.Lookup.NewToolTip,i.Label),String.format(' tabindex="{0}"',$nextTabIndex())),n.append("<\/td><\/tr><\/table>"))},_actionButtonsInScope:function(n){var t=this.get_actions(n),r,i;if(t.length!=0){if(n=="Row"){for(r=!1,i=0;i<t.length;i++)if(this._isActionAvailable(t[i])){r=!0;break}if(!r)return null}return t}},_saveViewVitals:function(){this.writeContext("vitals",{PageIndex:this.get_pageIndex(),PageSize:this.get_pageSize(),Filter:this.get_filter(),SortExpression:this.get_sortExpression(),Tag:this.get_tag()})},_restoreViewVitals:function(n){var t,u,i,r,e,h,o;if(!(n.PageIndex>=0)&&(t=this.readContext("vitals"),t!=null)&&(n.RequiresRowCount=!0,n.RequiresMetaData=!0,n.PageIndex==-1&&t.Filter&&n.Filter)){if(n.Tag=t.Tag,n.PageIndex=t.PageIndex,n.PageSize=t.PageSize,n.FilterIsExternal){for(u=n.Filter,i=0;i<t.Filter.length;i++){var f=t.Filter[i],c=f.substring(0,f.indexOf(":")),s=!1;for(r=0;r<n.Filter.length;r++)if(e=n.Filter[r],h=e.substring(0,e.indexOf(":")),h==c){s=!0;break}s||Array.add(u,f)}n.Filter=Array.clone(u)}else(n.Filter==null||n.Filter.length==0)&&(n.Filter=Array.clone(t.Filter));n.SortExpression=t.SortExpression;this.get_isDataSheet()&&this._get_focusedCell()||(o=this.readContext("GridType"),o!=null&&this.changeViewType(o))}},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var n=this.get_actionGroups("Grid");return Array.addRange(n,this.get_actionGroups("ActionBar")),Array.addRange(n,this.get_actionGroups("Form")),Array.addRange(n,this.get_actionGroups("ActionColumn")),n},_findActionsByCommandName:function(n){for(var t,r,u=[],f=this.get_interactiveActionGroups(),i=0;i<f.length;i++)for(actions=f[i].Actions,t=0;t<actions.length;t++)r=actions[t],r.CommandName==n&&Array.add(u,r);return u},_enableButtons:function(n){$("button",this._element).each(function(){$(this).toggleClass("disabled",!n)})},_valueFocused:function(t){var i=this._allFields[t];this._focusedFieldName=i.Name;n._focusedDataViewId=this._id;n._focusedItemIndex=t},_resetContextLookupValues:function(n){var t=[],i;return this._enumerateContextFieldValues(n,t,{}),i=t.length>0,i&&this.refresh(!0,t),i},_copyStaticLookupValues:function(t){var u,o,i,f,c,l;if(!isNullOrEmpty(t.Copy)&&(t.ItemsStyle=="RadioButtonList"||t.ItemsStyle=="ListBox"||t.ItemsStyle=="DropDownList")){var a=this._collectFieldValues(),r=a[t.Index].NewValue,e=null,h=t.DynamicItems||t.Items;for(r!=null&&typeof r!="string"&&(r=r.toString()),u=0;u<h.length;u++)if(o=h[u],i=o[0],i!=null&&typeof i!="string"&&(i=i.toString()),i==r){e=o;break}if(e){for(f=[],c=2;l=n._fieldMapRegex.exec(t.Copy);)Array.add(f,{name:l[1],value:e[c++]});return s?n.input.execute({dataView:this,values:f}):this.refresh(!0,f),!0}}return!1},_replaceFieldValue:function(n){for(var t,o,r=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,n.Name),i=0;i<r.length;i++){t=r[i];try{if(t.Result.match(/\$(\d|\'\`)/)){var s=this._collectFieldValues(),u=s[n.Index],f=u.NewValue?u.NewValue.toString():null,h=new RegExp(t.Test),e=f.replace(h,t.Result);e!=f&&(o=[{name:n.Name,value:e}],this.refresh(!0,o))}}catch(c){}}},_quickFind_keydown:function(n){if(n.keyCode==Sys.UI.Key.enter)n.preventDefault(),n.stopPropagation(),this.quickFind();else if(n.keyCode===Sys.UI.Key.down)return},get_showModalForms:function(){return this._showModalForms==!0},set_showModalForms:function(n){this._showModalForms=n},_javaScriptRowValue:function(n){var t=this,r=t._javaScriptRow[n],u,i;return t._javaScriptRowConvert?(u=t._allFields[n],i={Name:u.Name,NewValue:r,Modified:!0},t._validateFieldValues([i],!1,!1,!1)?i.NewValue:null):r},refreshChildren:function(){var t=this,n;n=t.get_parentDataView(t);n._forceChanged=!0;n._raiseSelectedDelayed=!0;n._isBusy||n.refresh(!0)},showViewMessage:function(n){var r=this._get("$HeaderText"),i,t;r!=null&&n&&(i=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage();return false;" class="Close" title="{2}">&nbsp;<\/a><\/div>',this.get_id(),n,w.Close),t=this.get_view(),t.OriginalHeaderText||(t.OriginalHeaderText=t.HeaderText),t.HeaderText=i,r.innerHTML=i,this._viewMessages||(this._viewMessages={}),this._viewMessages[t.Id]=n)},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},get_selectedValues:function(){var t=this.get_parentDataView(this),n=t?t.get_selectedValue():[],i;return n=n.length?t.multiSelect()?n.split(";"):[n]:[],i=Array.indexOf(n,"null"),i!==-1&&n.splice(i,1),n},__pasteMethodsAbove:function(){}};ot={initialize:function(){g.callBaseMethod(this,"initialize");g._instance||(g._instance=this);this._loginButtonClickHandler=Function.createDelegate(this,this._loginButtonClick);this._loginDialogMouseOverHandler=Function.createDelegate(this,this._loginDialogMouseOver);this._loginDialogMouseOutHandler=Function.createDelegate(this,this._loginDialogMouseOut);this._login_CompletedHandler=Function.createDelegate(this,this._login_Completed);this._method_FailureHandler=Function.createDelegate(this,this._method_Failure);this._textBoxKeyPressHandler=Function.createDelegate(this,this._textBoxKeyPress);this._body_keydownDelegate=Function.createDelegate(this,this._body_keydown);this._body_mousemoveDelegate=Function.createDelegate(this,this._body_mousemove);$addHandler(document.body,"keydown",this._body_keydownDelegate);$addHandler(document.body,"mousemove",this._body_mousemoveDelegate);this._window_beforeUnloadDelegate=Function.createDelegate(this,this._window_beforeUnload);$addHandler(window,"beforeunload",this._window_beforeUnloadDelegate)},dispose:function(){this.idleInterval(!1);this._disposeIdentityResources();$removeHandler(window,"beforeunload",this._window_beforeUnloadDelegate);$removeHandler(document.body,"keydown",this._body_keydownDelegate);$removeHandler(document.body,"mousemove",this._body_mousemoveDelegate);this._loginButton&&$clearHandlers(this._loginButton);this._loginDialog&&$clearHandlers(this._loginDialog);this._userName&&$clearHandlers(this._userName);this._password&&$clearHandlers(this._password);delete this._membershipBar;delete this._bookmarkBar;this._hideHistory();g.callBaseMethod(this,"dispose")},updated:function(){var t,i,f,e,o,s,h,u,y;if(g.callBaseMethod(this,"updated"),t=c.Bar,i=this,i.idleInterval(!0),i._updateLastActivity(),!String.isNullOrEmpty(i.get_cultures())){i._cultureList=[];var p=String.format("Detect,Detect|{0}|False;{1}",c.Bar.AutoDetectLanguageOption,i.get_cultures()),l=p.split(/;/),v="Membership$Cultures",a=[];for(f=0;f<l.length;f++)String.isBlank(l[f])||(e=l[f].split(/\|/),Array.add(i._cultureList,e),o=new Web.Item(v,e[1]),e[2]=="True"&&o.set_selected(!0),o.set_script(String.format("$find('{0}').changeCulture('{1}');",i.get_id(),e[0])),Array.add(a,o),f==0&&Array.add(a,new Web.Item));$registerItems(v,a,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)}s=document.createElement("div");s.className="MembershipBarPlaceholder";document.body.insertBefore(s,document.body.childNodes[0]);i._membershipBar=$get("Membership_Login");h=i.loggedIn();i._membershipBar||(i._membershipBar=document.createElement("div"),document.body.childNodes.length>0?document.body.insertBefore(i._membershipBar,document.body.childNodes[0]):document.body.appendChild(i._membershipBar),u=new Sys.StringBuilder,i._membershipBar.id="Membership_Login",i._membershipBar.className="MembershipBar",!i._cultureList||__tf!=4||u.append(String.format('<div style="float:right" class="CultureLink"> | <a href="javascript:" onclick="$toggleHover();return false;" title="{1}" onfocus="$showHover(this, \'Membership$Cultures\', \'CultureSelector\', 1)" onblur="$hideHover(this)" onmouseover="$showHover(this, \'Membership$Cultures\', \'CultureSelector\', 1)" onmouseout="$hideHover(this)">{0}<\/a><\/div>',this.get_cultureName(),t.ChangeLanguageToolTip)),this.get_displayHelp()&&u.append(String.format('<div style="float:right" class="HelpLink"> | <a href="javascript:" onclick="$find(&quot;{0}&quot;).help();return false;">{1}<\/a><\/div>',this.get_id(),t.HelpLink)),!h&&this.get_authenticationEnabled()?this.get_displayLogin()&&u.append(String.format('<table id="LoginDialog" cellpadding="0" class="LoginDialog"><tr><td id="Anchor"><a href="javascript:" onfocus="$find(&quot;{0}&quot;).changeLoginDialogVisibility(true);return false" >{1}<\/a>{2}<\/td><\/tr><tr id="LoginControlsRow"><td id="LoginControls"><table><tr><td align="right" nowrap="nowrap">{3}<\/td><td><input type="text" id="UserName" size="20" value="" /><\/td><\/tr><tr><td align="right" nowrap="nowrap">{4}<\/td><td><input type="password" id="Password" size="20" /><\/td><\/tr>'+(this.get_displayRememberMe()?String.format('<tr><td align="right" colspan="2"><input type="checkbox" id="RememberMe"{0}/><label for="RememberMe">{1}<\/label><\/td><\/tr>',this.get_rememberMeSet()?' checked="checked"':"",t.RememberMe):"")+(this.get_displayPasswordRecovery()?'<tr><td>&nbsp;<\/td><td align="right" nowrap="nowrap"><a href="javascript:" onclick="$find(&quot;{0}&quot).passwordRecovery();return false;" id="PasswordRecovery">{6}<\/a><\/td><\/tr>':"")+(this.get_displaySignUp()?'<tr><td>&nbsp;<\/td><td align="right" nowrap="nowrap"><a href="javascript:" onclick="$find(&quot;{0}&quot).signUp();return false;" id="SignUp">{7}<\/a><\/td><\/tr>':"")+'<tr><td>&nbsp;<\/td><td align="right"><button id="Login">{5}<\/button><\/td><\/tr><\/table><\/td><\/tr><\/table>',this.get_id(),t.LoginLink,t.LoginText,t.UserName,t.Password,t.LoginButton,t.ForgotPassword,t.SignUp)):u.append(String.format('<table id="LoginDialog" cellpadding="0" class="LoginDialog LoginDialogCollapsed"><tr><td>'+(this.get_welcome()&&!String.isBlank(this.get_welcome())?String.localeFormat(this.get_welcome(),this.get_user(),new Date)+(this.get_authenticationEnabled()?" | ":""):"")+(this.get_displayMyAccount()?'<a id="MyAccount" href="javascript:" onclick="$find(&quot;{0}&quot;).myAccount();return false;">{1}<\/a> | ':"")+(this.get_authenticationEnabled()?'<a href="javascript:" onclick="$find(&quot;{0}&quot;).logout();return false;">{2}<\/a>':"")+"<\/td><\/tr><\/table>",this.get_id(),t.MyAccount,t.LogoutLink)),this._membershipBar.innerHTML=u.toString(),h&&(this.get_enablePermalinks()||this.get_enableHistory())&&(this._bookmarkBar=document.createElement("div"),this._bookmarkBar.className="BookmarkBar",s.appendChild(this._bookmarkBar),u=new Sys.StringBuilder,u.append('<table class="Frame"><tr>'),this.get_enableHistory()&&u.appendFormat('<td><a id="{0}_HistoryLink" href="javascript:" onclick="$find(\'{0}\').showHistory();return false" title="{2}">{1}<\/a><\/td>',this.get_id(),t.History,t.HistoryToolTip),this.get_enableHistory()&&this.get_enablePermalinks()&&u.append("<td>|<\/td>"),this.get_enablePermalinks()&&u.appendFormat('<td><a href="javascript:" onclick="$find(\'{0}\').showPermalink();return false" title="{4}">{1}<\/a><\/td><td style="display:none"><input id="{0}_Permalink" type="text" onfocus="this.select();"/><\/td><td style="display:none"><a id="{0}_AddToFavorites" href="javascript:" onclick="$find(\'{0}\')._addToFavorites();return false" class="AddBookmark" title="{2}">&nbsp;<\/a><\/td><td style="display:none"><a id="{0}_CancelFavorites" href="javascript:" onclick="$find(\'{0}\').showPermalink();return false" class="CancelBookmark" title="{3}">&nbsp;<\/a><\/td>',this.get_id(),t.Permalink,t.AddToFavorites,t.HelpCloseButton,t.PermalinkToolTip),u.append("<\/tr><\/table>"),this._bookmarkBar.innerHTML=u.toString()));document.body.style.paddingTop="0px";!h&&this.get_displayLogin()&&(this._loginDialog=$get("LoginDialog",this._membershipBar),y=n.bounds(this._loginDialog),this._loginDialog.style.width=y.width+"px",$get("LoginControlsRow",this._loginDialog)&&$addHandlers(this._loginDialog,{mouseover:this._loginDialogMouseOverHandler,mouseout:this._loginDialogMouseOutHandler},this),this._loginButton=$get("Login",this._membershipBar),this._loginButton&&$addHandler(this._loginButton,"click",this._loginButtonClickHandler),$(this._membershipBar).find("input").keyup(function(n){n.which==13&&i.login()}),this._userName=$get("UserName",this._membershipBar),this._userName&&$addHandler(this._userName,"keypress",this._textBoxKeyPressHandler),this._password=$get("Password",this._membershipBar),this._password&&$addHandler(this._password,"keypress",this._textBoxKeyPressHandler),this._rememberMe=$get("RememberMe",this._membershipBar),this.changeLoginDialogVisibility(r.location.href.match(/\?ReturnUrl=(.+)$/)!=null))},get_membershipBar:function(){return this._membershipBar},get_isLoginDialogVisible:function(){return this._isLoginDialogVisible},set_isLoginDialogVisible:function(n){this._isLoginDialogVisible=n},hideLoginDialog:function(){this._intevalId&&(r.clearInterval(this._intervalId),this._intervalId=null)},addPermalink:function(t,i){if(this.get_enablePermalinks()||this.get_enableHistory()){var u=location.pathname+"?"+t;this._savePermalinkParams={link:u,html:n.htmlEncode(i)};r.setTimeout("Web.Membership._instance._savePermalink()",500);Sys.UI.DomElement.getVisible(this._membershipBar)||this._encodePermalink_Success("")}},_savePermalink:function(){Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"SavePermalink",!1,this._savePermalinkParams)},showPermalink:function(){if(!this._savePermalinkParams||String.isNullOrEmpty(this._savePermalinkParams.html)){n.alert(c.Messages.PermalinkUnavailable);return}this.encodePermalink(this._savePermalinkParams.link,Function.createDelegate(this,this._encodePermalink_Success))},encodePermalink:function(n,t){t||(t=function(n){location.href=n});Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"EncodePermalink",!1,{link:n,rooted:!0},t,Function.createDelegate(this,this._onMethodFailed))},showHistory:function(){this._historyDiv||Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"ListAllPermalinks",!1,null,Function.createDelegate(this,this._showHistory_Success),Function.createDelegate(this,this._method_Failure))},_focusHistory:function(){var n=$get(this.get_id()+"_RotateHistory");n&&n.focus()},_renderHistory:function(){var h=n.clientBounds(),v=n.scrolling(),f=new Sys.StringBuilder,u,r,y,t,i,s;f.appendFormat('<div onclick="$find(\'{0}\')._hideHistory()" style="width:{1}px;height:{2}px;">',this.get_id(),h.width,h.height);u=this._historyData.length;u>10&&(u=10);var l=0,a=0,o=50,e=30;for(u<=3?(o=65,e=30):u<=6&&(o=65,e=30),r=u-1;r>=0;r--)y=this._historyData[r][1],f.appendFormat('<div style="position:absolute;background-color:#333333;"><\/div><div id="{0}_Card{1}" onclick="$find(\'{0}\')._selectHistory({1});return false;" style="position:absolute;left:{2}px;top:{3}px;" onmouseover="if(this._Activated!=99){{this.style.zIndex=600001;this._Activated=99;var s=this.previousSibling;s.style.zIndex=600000;s.style.backgroundColor=\'black\'}}" onmouseout="this.style.zIndex=\'{4}\';this._Activated=0;var s=this.previousSibling;s.style.zIndex=\'{4}\';s.style.backgroundColor=\'#333333\'">',this.get_id(),r,l,a,Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version>=9?-1:"auto"),f.append(y),f.append("<\/div>"),r==0&&f.appendFormat('<a id="{0}_RotateHistory" class="RotateHistory" href="javascript:" onclick="$find(\'{0}\')._rotateHistory(event);return false;"><div id="{0}_RotateButton" title="{3}" style="position:absolute;z-index:600002;left:{1}px;top:{2}px;" class="RotateHistory">&nbsp;<\/div><\/a>',this.get_id(),l+110,a-15,c.Bar.RotateHistory),l+=o,a+=e;for(f.append("<\/div>"),this._historyDiv.innerHTML=f.toString(),t=$get(this.get_id()+"_Card0"),i=n.bounds(t),o=Math.floor((h.width-(i.x+i.width))/2),e=this._historyOffsetTop?this._historyOffsetTop:Math.floor((h.height-(i.y+i.height))/2),this._historyOffsetTop=e,t=$get(this.get_id()+"_RotateButton"),t.style.left=t.offsetLeft+o+"px",t.style.top=t.offsetTop+e+"px",u==1&&(t.style.width="1px",t.style.height="1px"),r=0;r<u;r++)t=$get(this.get_id()+"_Card"+r),t.style.left=t.offsetLeft+o+"px",t.style.top=t.offsetTop+e+"px",i=n.bounds(t),i.x+=10-v.x,i.y+=4-v.y,s=t.previousSibling,s.style.left=i.x+"px",s.style.top=i.y+"px",s.style.width=i.width-13+"px",s.style.height=i.height-0+"px"},_selectHistory:function(n){this.encodePermalink(this._historyData[n][0])},_hideHistory:function(){this._historyModalPopup&&(this._historyModalPopup.hide(),this._historyDiv&&(this._historyDiv.parentNode.removeChild(this._historyDiv),delete this._historyDiv),this._historyModalPopup.dispose(),delete this._historyModalPopup)},_rotateHistory:function(n){var i=this._historyData[0],t;Array.removeAt(this._historyData,0);Array.add(this._historyData,i);this._renderHistory();this._focusHistory();try{t=new Sys.UI.DomEvent(n);t.stopPropagation();t.preventDefault()}catch(r){}},_showHistory_Success:function(t){if(!t.length){n.alert(c.Messages.HistoryUnavailable);return}this._historyData=t;var i=this._historyDiv=document.createElement("div");document.body.appendChild(i);i.id=this.get_id()+"_HistoryPanel";i.className="History";this._historyOffsetTop=null;this._renderHistory();this._historyModalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{PopupControlID:i.id,DropShadow:!1,BackgroundCssClass:"ModalBackground"},null,null,$get(this.get_id()+"_HistoryLink"));this._historyModalPopup.show();this._focusHistory()},_encodePermalink_Success:function(n){var i=$get(this.get_id()+"_Permalink"),r=$get(this.get_id()+"_AddToFavorites"),u=$get(this.get_id()+"_CancelFavorites"),t=!Sys.UI.DomElement.getVisible(i.parentNode);Sys.UI.DomElement.setVisible(i.parentNode,t);Sys.UI.DomElement.setVisible(r.parentNode,t);Sys.UI.DomElement.setVisible(u.parentNode,t);Sys.UI.DomElement.setVisible(this._membershipBar,!t);t&&(i.value=n);i.parentNode.title=this._savePermalinkParams.html.replace(/<div class="Value">/g," = ").replace(/(\s*<.+?>\s*)+/g,"\r\r").trim().replace(/&\w+;/g,"").replace(/(\r\r)+/g,"; ").replace(/;\s*=/g," = ").replace(/=\s*;/g," = ")},_addToFavorites:function(){var n;this._encodePermalink_Success("");var u=$get(this.get_id()+"_Permalink"),t=u.parentNode.title,i=u.value;r.sidebar?r.sidebar.addPanel(t,i,""):r.opera&&r.print?(n=document.createElement("a"),n.setAttribute("href",i),n.setAttribute("title",t),n.setAttribute("rel","sidebar"),n.click()):document.all&&r.external.AddFavorite(i,t)},changeLoginDialogVisibility:function(n,t){if(this._intevalId&&(r.clearInterval(this._intevalId),this._intevalId=null),t)this._intevalId=r.setInterval(String.format('$find("{0}").changeLoginDialogVisibility({1})',this.get_id(),n),t);else if(n!=this.get_isLoginDialogVisible()){var i=$get("LoginControlsRow",this._membershipBar);i&&(n?Sys.UI.DomElement.removeCssClass(this._loginDialog,"LoginDialogCollapsed"):Sys.UI.DomElement.addCssClass(this._loginDialog,"LoginDialogCollapsed"),Sys.UI.DomElement.setVisible(i,n));!n||document.activeElement&&document.activeElement.id=="Password"||this._userName.focus();this.set_isLoginDialogVisible(n);n&&Web.HoverMonitor._instance.close()}},_idle:function(){var r,i,n,t;for(Web.HoverMonitor._instance.close(),r=Sys.Application.getComponents(),i=r.length-1;i>=0;i--)n=r[i],Web.DataView.isInstanceOfType(n)&&(n.get_isModal()?n.endModalState("Cancel"):n.get_lookupField()&&n.hideLookup());this._protecting=!0;t=this._idleDialog=document.createElement("div");t.id=this.get_id()+"$IdentityValidation";document.body.appendChild(t);t.innerHTML=String.format('<div class="ModalPlaceholder FixedDialog UserIdle"><div class="Text">{1}<\/div><div class="Buttons"><button onclick="$find(\'{0}\').logout();return false;" >{2}<\/button><\/div><\/div>',this.get_id(),c.Bar.UserIdle,c.Bar.LoginLink);this._identityModalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{PopupControlID:t.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._membershipBar.getElementsByTagName("a")[0]);this._identityModalPopup.show()},_body_keydown:function(n){this._updateLastActivity();this._historyDiv&&(n.keyCode==Sys.UI.Key.esc?(n.preventDefault(),this._hideHistory()):n.keyCode==Sys.UI.Key.tab?(n.preventDefault(),this._rotateHistory()):n.keyCode==Sys.UI.Key.enter&&(n.preventDefault(),this._selectHistory(0)))},_body_mousemove:function(){this._updateLastActivity()},_window_beforeUnload:function(){this._protecting&&(this._protecting=!1,this._disposeIdentityResources(),this.logout())},_login_Completed:function(t){var i,u;this._wait(!1);t?(u=r.location.href.match(/\?ReturnUrl=(.+)$/),setTimeout(function(){n._navigated=!0;r.location.replace(n.unanchor(u?unescape(u[1]):r.location.href))})):(i=this,n.alert(c.Messages.InvalidUserNameAndPassword,function(){s||i.changeLoginDialogVisibility(!0);i._userName.focus()}))},_method_Failure:function(t,i,r){this._wait(!1);n.alert(String.format("Method {0} has failed. {1}",r,t.get_message()))},_loginButtonClick:function(){this.login()},_loginDialogMouseOver:function(){this.changeLoginDialogVisibility(!0,50)},_loginDialogMouseOut:function(){this.changeLoginDialogVisibility(!1,500)},_textBoxKeyPress:function(n){n.charCode==Sys.UI.Key.enter&&(n.preventDefault(),this.login());n.charCode==Sys.UI.Key.esc&&(n.preventDefault(),this.set_isLoginDialogVisible(!0),this.changeLoginDialogVisibility(!1))},login:function(){var t=this,i;if(t.loggedIn(),!t._waitDataView||!t._waitDataView._busy())if(this._userName&&this._password){if(i=/^\s*$/,i.exec(this._userName.value)){n.alert(c.Messages.BlankUserName,function(){t.set_isLoginDialogVisible(!1);t._userName.focus()});return}if(i.exec(this._password.value)){this.set_isLoginDialogVisible(!1);n.alert(c.Messages.BlankPassword,function(){t.set_isLoginDialogVisible(!1);t._password.focus()});return}this._wait(!0);n.login(this._userName.value,this._password.value,this._rememberMe!=null&&this._rememberMe.checked,function(){t._login_CompletedHandler(!0)},function(){t._login_CompletedHandler(!1)})}else n.alert("UserName and/or Password elements are not found in the Memership_Login")},_wait:function(n){var t=this._waitDataView;t||(this._waitDiv=$("<div/>"),t=this._waitDataView=$create(Web.DataView,{},null,null,this._waitDiv[0]));t._busy(n)},signUp:function(){this.changeLoginDialogVisibility(!1);Web.DataView.showModal($get("SignUp",this.get_membershipBar()),"MyProfile","signUpForm","New","signUpForm",this.get_baseUrl(),this.get_servicePath())},passwordRecovery:function(){this.changeLoginDialogVisibility(!1);Web.DataView.showModal($get("PasswordRecovery",this.get_membershipBar()),"MyProfile","passwordRequestForm","New","passwordRequestForm",this.get_baseUrl(),this.get_servicePath())},myAccount:function(){Web.DataView.showModal($get("MyAccount",this.get_membershipBar()),"MyProfile","myAccountForm","Edit","myAccountForm",this.get_baseUrl(),this.get_servicePath())},help:function(n){var a,i,e,o,u,t,l,h,f;if(typeof __settings!="undefined"&&__settings.help){a=this;i=a.helpUrl();s&&s.busy({progress:!0});$.ajax(i).done(function(n){i=n.match(/404 Not Found/)?__baseUrl+"help":i;s?(s.busy({progress:!1}),s.navigate({href:i})):r.open(i,"_blank")});return}if(e=r.location.pathname,o=this.get_baseUrl()=="./"?e.substr(e.lastIndexOf("/"),100):"",o.length==0)for(u=this.get_baseUrl().split(/\//),t=e.split(/\//),u[u.length-1]==""&&Array.removeAt(u,u.length-1),t[t.length-1]==""&&Array.removeAt(t,t.length-1),t[0]==""&&Array.removeAt(t,0),l=u.length,t[t.length-1].indexOf(".")==-1&&l--,h=t.length-l-1;h<t.length;h++)o+="/"+t[h];if(f=String.format("{0}help{1}",this.get_baseUrl(),o),f=String.format("{0}Help/Default.aspx?topic={1}",this.get_baseUrl(),encodeURI(f)),n){r.open(f);this.help();return}this._helpBar||(this._helpDiv=document.createElement("div"),document.body.appendChild(this._helpDiv),this._helpDiv.className="HelpBar",this._helpDiv.innerHTML=String.format('<div class="Title">{1}<\/div><iframe id="help" frameBorder="0"><\/iframe><div class="Buttons"><button onclick="$find(&quot;{0}&quot;).help()">{2}<\/button><button onclick="$find(&quot;{0}&quot;).help(true)">{3}<\/button><\/div>',this.get_id(),c.Bar.HelpLink,c.Bar.HelpCloseButton,c.Bar.HelpFullScreenButton),this._helpFrame=$get("help",this._helpDiv),this._helpBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{HorizontalSide:AjaxControlToolkit.HorizontalSide.Right,VerticalSide:AjaxControlToolkit.VerticalSide.Top,HorizontalOffset:18,VerticalOffset:30},null,null,this._helpDiv),Sys.UI.DomElement.setVisible(this._helpDiv,!1));Sys.UI.DomElement.setVisible(this._helpDiv,!Sys.UI.DomElement.getVisible(this._helpDiv));Sys.UI.DomElement.getVisible(this._helpDiv)&&(this._helpFrame.src==""&&(this._helpFrame.src=f),this._helpBar._reposition())},__pasteMethodsAbove:function(){}};n._load=function(){var l,r,e,ot,s,u,c,st,i,k,d,a,g,v,ht,nt,p,ct,w,lt,at;if(!n._loaded){Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(n._partialUpdateBeginRequest);n._loaded=!0;updateACT();typeof ft=="undefined"&&(ft="../");$("#PageHeaderSideBar .PageLogo").attr("src",ft+"app_themes/_shared/placeholder.gif");n.supportsPlaceholder="placeholder"in document.createElement("input");var b=$get("PageContent"),vt,yt=[],pt=$("body");if(b){for(pt.find('div[data-app-role="page"]').each(function(){$(this).attr("data-content-framework")&&yt.push($(this).attr("id"))}).each(function(){var t=$(this),e=t.attr("id"),u=location.search.match(/_hash=(\w+)/),f=t.attr("data-content-framework"),i=t.find('> div[data-role="content"]'),r;if(i.length||(i=$('<div data-role="content"><\/div>'),t.contents().appendTo(i),i.appendTo(t)),f&&!vt&&(!u||u[1]===e)){r=$(b).closest("table");t.insertAfter(r);pt.addClass("app-min-md app-min-lg app-theme-"+__settings.ui.theme.accent.toLowerCase());vt=!0;i=t.find('> div[data-role="content"]').addClass("app-bootstrap app-content-desktop");n.configureFramework(f,i);t.css({position:"absolute",top:r.offset().top,width:"100%"});r.hide();t.find("a").each(function(){var i=$(this),n=i.attr("href"),t=n&&n.startsWith("#")&&n.length>1&&n.substring(1);t&&Array.indexOf(yt,t)!==-1&&i.attr("href","?_hash="+t)});$("#PageFooterBar").hide();return}t.remove()}),$(b).find('div[data-role="placeholder"]').each(function(){var t=$(this),i=n._contentFactories[t.attr("data-placeholder")];i&&i(t)}),l=document.body.getElementsByTagName("div"),r=0;r<l.length;r++)if(l[r].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(l[r],"Loading");break}l=b.getElementsByTagName("div");var o=[],tt=0,wt=!1,it=!1,h=null,rt=[];for(n._numberOfContainers=0,e=n.prototype.dataAttr,r=0;r<l.length;r++){var f=l[r],ut=e(f,"width"),et=e(f,"flow");if(!isNullOrEmpty(ut)||!isNullOrEmpty(et)){if($(f).find("div[data-flow]").length)continue;for(et!=="NewColumn"&&et!=="column"&&(f.style.clear="left",tt++),isNullOrEmpty(f.id)&&(f.id="_lc"+o.length),Sys.UI.DomElement.addCssClass(f,"LayoutContainer"),n._numberOfContainers++,ut!=="100%"&&(f.style.overflow="hidden"),Array.add(o,{id:f.id,width:ut,rowIndex:tt,peersWithoutWidth:0}),ot=f.getElementsByTagName("div"),s=[],u=0;u<ot.length;u++)c=ot[u],st=e(c,"activator"),isNullOrEmpty(st)||y(c.innerHTML)||(c.id=isNullOrEmpty(c.id)?f.id+"$a"+u:c.id,i={elem:c,activator:n.eval(st).split("|"),id:c.id},i.activator[0]=i.activator[0].trim(),i.activator.length===1&&(i.activator[1]=u.toString()),Array.add(s,i));for(u=1;u<s.length;){for(i=s[u],k=0;k<u;k++)if(d=s[k],d.activator[0]==i.activator[0]&d.activator[1]==i.activator[1]){while(i.elem.childNodes.length>0)d.elem.appendChild(i.elem.childNodes[0]);delete i.elem;Array.removeAt(s,u);i=null;break}i&&u++}if(s.length>0){for(wt=!0,a=[],g=!0,u=0;u<s.length;u++)i=s[u],i.activator[0]==="Tab"?(a.length||(v=document.createElement("div"),v.className="TabBar",f.insertBefore(v,i.elem)),ht={title:i.activator[1],elementId:i.id,selected:a.length==0,description:e(i.elem,"description"),hidden:e(i.elem,"hidden")},Array.add(a,ht),Sys.UI.DomElement.setVisible(i.elem,ht.selected),i.elem._activated=!0,Sys.UI.DomElement.addCssClass(i.elem,"TabBody TabContainer")):i.activator[0]==="SideBarTask"?(h||(h=new Sys.StringBuilder,h.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}<\/div>',t.Menu.Tasks)),i.elem._activated=g,g&&(g=!1),Sys.UI.DomElement.setVisible(i.elem,i.elem._activated),h.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"$app._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}<\/a><\/div>",i.activator[1],it?"":" Selected",i.id,n.htmlAttributeEncode(e(i.elem,"description")),e(i.elem,"hidden")=="true"?' style="display:none"':""),it=!0):i.activator[0]==="SiteAction"&&Web.Menu.get_siteActionsFamily()?(nt=new Web.Item(Web.Menu.get_siteActionsFamily(),i.activator[1],e(i.elem,"description")),nt.set_cssClass(e(i.elem,"cssClass")),nt.set_script('$app._activate(null,"{0}","SiteAction")',i.id),Array.add(rt,nt),Sys.UI.DomElement.setVisible(i.elem,!1)):Sys.UI.DomElement.setVisible(i.elem,!1),i.elem=null;a.length>0&&($create(Web.Menu,{id:f.id+"$ActivatorMenu",nodes:a},null,null,v),a.length<2&&!r&&Sys.UI.DomElement.addCssClass(v,"EmptyTabBar"))}}}for(wt&&n._performDelayedLoading(),it&&h&&(p=$getSideBar(),p&&(h.append("<\/div><\/div>"),ct=document.createElement("div"),ct.innerHTML=h.toString(),h.clear(),p.insertBefore(ct,p.childNodes[0]),p._hasActivators=!0)),rt.length>0&&Web.Menu.set_siteActions(rt),w=tt;o.length>0&&w>=o[0].rowIndex;){for(lt=0,at=0,r=0;r<o.length;r++)lc=o[r],lc.rowIndex==w&&(at++,isNullOrEmpty(lc.width)&&lt++);for(r=0;r<o.length;r++)lc=o[r],lc.rowIndex===w&&(lc.peersWithoutWidth=lt,at===1&&isNullOrEmpty(lc.width)&&(lc.width="100%"));w--}n._layoutContainers=o;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}n._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)}};n._unload=function(){this._state&&(Array.clear(this._state),delete this._state);n._delayedLoadingTimer&&(clearInterval(n._delayedLoadingTimer),Array.clear(n._delayedLoadingViews),delete n._delayedLoadingViews);$get("PageContent")&&($removeHandler(window,"resize",_body_resize),$removeHandler(window,"scroll",_body_scroll));$removeHandler(document.body,"keydown",_body_keydown)};d.add_init(function(){yt=n.findDataView;isNullOrEmpty=String.isNullOrEmpty;y=String.isBlank;for(var t in et)Web.DataView.prototype[t]=et[t];if(g=Web.Membership,g){for(t in ot)Web.Membership.prototype[t]=ot[t];Type.registerNamespace("Web");Web.MembershipManager=function(n){Web.MembershipManager.initializeBase(this,[n])};Web.MembershipManager.prototype={get_servicePath:function(){return this._servicePath},set_servicePath:function(n){this._servicePath=n},get_baseUrl:function(){return this._baseUrl},set_baseUrl:function(n){this._baseUrl=n},initialize:function(){Web.MembershipManager.callBaseMethod(this,"initialize")},dispose:function(){Web.MembershipManager.callBaseMethod(this,"dispose")},updated:function(){var n;Web.MembershipManager.callBaseMethod(this,"updated");var t=this.get_element(),i=Web.MembershipResources.Manager,r=this.get_baseUrl();s?$(String.format('<div data-flow="NewRow"><div data-activator="Tab|{0}">    <div id="membershipUsers"><\/div> <\/div> <div data-activator="Tab|{1}">    <div id="membershipRoles"><\/div><\/div><div data-activator="Tab|{2}">    <div id="membershipRoleUsers"><\/div><\/div><\/div>',i.UsersTab,i.RolesTab,i.UsersInRole)).appendTo(t):(Sys.UI.DomElement.addCssClass(t,"MembershipManager"),n=new Sys.StringBuilder,n.append('<div class="TabContainer" id="MembershipManager1_SecurityTabs" style="visibility:hidden;">'),n.append('<div id="MembershipManager1_SecurityTabs_header">'),n.append(String.format('<span id="__tab_MembershipManager1_SecurityTabs_UsersTab">{0}<\/span><span id="__tab_MembershipManager1_SecurityTabs_RolesTab">{1}<\/span>',i.UsersTab,i.RolesTab)),n.append('<\/div><div id="MembershipManager1_SecurityTabs_body">'),n.append('<div id="MembershipManager1_SecurityTabs_UsersTab" style="display:none;visibility:hidden;">'),n.append('<div id="MembershipManager1_SecurityTabs_UsersTab_Users"><\/div>'),n.append('<\/div><div id="MembershipManager1_SecurityTabs_RolesTab" style="display:none;visibility:hidden;">'),n.append('<div id="MembershipManager1_SecurityTabs_RolesTab_Roles"><\/div>'),n.append('<div id="MembershipManager1_SecurityTabs_RolesTab_UsersInRoles" style="margin-top: 8px"><\/div>'),n.append("<\/div>"),n.append("<\/div>"),n.append("<\/div>"),t.innerHTML=n.toString());$create(Web.DataView,{baseUrl:r,controller:"aspnet_Membership",id:"MembershipManager1_SecurityTabs_UsersTab_UsersExtender",pageSize:10,servicePath:this.get_servicePath(),showActionBar:!0,viewId:null,showSearchBar:!0,showFirstLetters:!0,tags:"multi-select-none"},null,null,s?$("#membershipUsers")[0]:$get("MembershipManager1_SecurityTabs_UsersTab_Users",t));s||$create(AjaxControlToolkit.TabPanel,{headerTab:$get("__tab_MembershipManager1_SecurityTabs_UsersTab",t)},null,{owner:"MembershipManager1_SecurityTabs"},$get("MembershipManager1_SecurityTabs_UsersTab",t));$create(Web.DataView,{baseUrl:r,controller:"aspnet_Roles",id:"MembershipManager1_SecurityTabs_RolesTab_RolesExtender",pageSize:5,servicePath:this.get_servicePath(),showActionBar:!0,viewId:null,showSearchBar:!0,tags:"multi-select-none"},null,null,s?$("#membershipRoles")[0]:$get("MembershipManager1_SecurityTabs_RolesTab_Roles",t));$create(Web.DataView,{baseUrl:r,controller:"aspnet_Membership",filterFields:"RoleId",filterSource:"MembershipManager1_SecurityTabs_RolesTab_RolesExtender",id:"MembershipManager1_SecurityTabs_RolesTab_UsersInRolesExtender",pageSize:5,servicePath:this.get_servicePath(),showActionBar:!0,viewId:"usersInRolesGrid",autoHide:1,showSearchBar:!0,showFirstLetters:!0,tags:"multi-select-none"},null,null,s?$("#membershipRoleUsers")[0]:$get("MembershipManager1_SecurityTabs_RolesTab_UsersInRoles",t));s||($create(AjaxControlToolkit.TabPanel,{headerTab:$get("__tab_MembershipManager1_SecurityTabs_RolesTab",t)},null,{owner:"MembershipManager1_SecurityTabs"},$get("MembershipManager1_SecurityTabs_RolesTab",t)),$create(AjaxControlToolkit.TabContainer,{activeTabIndex:0,clientStateField:$get("MembershipManager1_SecurityTabs_ClientState",t)},null,null,$get("MembershipManager1_SecurityTabs",t)))}};Web.MembershipManager.registerClass("Web.MembershipManager",Sys.UI.Behavior);Sys.Extended&&typeof AjaxControlToolkit=="undefined"&&(AjaxControlToolkit=Sys.Extended.UI)}});d.add_load(function(){n._parse();$(document).trigger("start.app")});d.add_load(n._load);d.add_unload(n._unload);r.updateACT=function(){var i,r,t,f;Sys.Extended&&typeof AjaxControlToolkit=="undefined"&&(AjaxControlToolkit=Sys.Extended.UI);Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);u.WebKit={};navigator.userAgent.indexOf("WebKit/")>-1&&(u.agent=u.WebKit,u.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]),u.name="WebKit");u.agent==u.InternetExplorer||u.agent==u.Firefox||u.agent==u.Opera||Sys.Extended||($common.old_getBounds=$common.getBounds,$common.getBounds=function(t){var r=$common.old_getBounds(t),i=n.scrolling();return(i.y||i.x)&&(r.x+=i.x,r.y+=i.y),r});i=AjaxControlToolkit.CalendarBehavior;i&&!i.prototype.old_show&&(i.prototype.old_show=i.prototype.show,i.prototype.show=function(){function i(){r.position({my:"left "+(t?"bottom":"top"),at:"left "+(t?"top":"bottom"),of:n})}this.old_show();var r=$(this._container).zIndex(100100),n=$(this._element),t=n.parent().find(".Error:visible").length||n.closest("div.Item").find(".Error:visible").length;i();setTimeout(i,10)},i.prototype.old_raiseDateSelectionChanged=i.prototype.raiseDateSelectionChanged,i.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()});r=AjaxControlToolkit.TabContainer;r&&!r.prototype.old_set_activeTabIndex&&(r.prototype.old_set_activeTabIndex=r.prototype.set_activeTabIndex,r.prototype.set_activeTabIndex=function(n){var t=this.get_activeTabIndex();this._headerAssigned||(this._headerAssigned=!0,Sys.UI.DomElement.addCssClass(this._element.getElementsByTagName("div")[0],"tab-header"));this.old_set_activeTabIndex(n);n!==t&&_body_performResize()});t=AjaxControlToolkit.AutoCompleteBehavior;t&&!t.prototype.old_dispose&&(t.prototype.old_dispose=t.prototype.dispose,t.prototype.dispose=function(){this.old_dispose();this._completionListElement&&(this._completionListElement.parentNode.removeChild(this._completionListElement),delete this._completionListElement)},t.prototype.old__handleFlyoutFocus=t.prototype._handleFlyoutFocus,t.prototype._handleFlyoutFocus=function(){this._completionListElement&&this.old__handleFlyoutFocus()},t.prototype.old_showPopup=t.prototype.showPopup,t.prototype.showPopup=function(){var f,r,t,u,e,o;if(this.old_showPopup(),Sys.UI.DomElement.getVisible(this._completionListElement)){if(f=n.scrolling(),this._completionListElement.style.height="",Sys.UI.DomElement.addCssClass(this._completionListElement,"CompletionList"),this._completionListElement.style.width="",this._completionListElement.style.zIndex=200100,r=$common.getClientBounds(),t=$common.getBounds(this._completionListElement),t.width>r.width/3&&(t.width=r.width/3),u=this._element,Sys.UI.DomElement.containsCssClass(u.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(u.parentNode,"AutoCompleteFrame"))u=u.parentNode;var i=$common.getBounds(u),s=$common.getBorderBox(this._completionListElement),h=$common.getPaddingBox(this._completionListElement);t.width<=i.width&&(this._completionListElement.style.width=i.width-s.horizontal-h.horizontal+"px");t=$common.getBounds(this._completionListElement);t.x!==i.x&&(t.x=i.x,this._completionListElement.style.left=t.x+"px");t.y!==i.y&&(t.y=i.y+i.height-1,this._completionListElement.style.top=t.y+"px");t.x+t.width>r.width&&(this._completionListElement.style.left=r.width-t.width+"px");bound=$common.getBounds(this._completionListElement);e=i.y-f.y;o=r.height-(i.y+i.height-f.y);bound.height<=o||o>=e?t.y+t.height-f.y>r.height&&(this._completionListElement.style.height=r.height-(t.y-f.y)-4+"px",this._completionListElement.style.overflow="auto"):e<t.height?(this._completionListElement.style.top=i.y-e+"px",this._completionListElement.style.height=e+"px",this._completionListElement.style.overflow="auto"):this._completionListElement.style.top=i.y-t.height+3+"px"}},f=AjaxControlToolkit.ModalPopupBehavior,f&&!f.prototype.old__attachPopup&&(f.prototype.old__attachPopup=f.prototype._attachPopup,f.prototype._attachPopup=function(){this.old__attachPopup();this._dropShadowBehavior&&(this._dropShadowBehavior.set_Width(4),(u.agent!=u.InternetExplorer||u.version>=9)&&this._dropShadowBehavior.set_Rounded(!0))}))};Sys.UI.DomElement.setFocus=function(n){var t=document.selection;t&&t.type!=="Text"&&t.type!=="None"&&t.clear();n&&(n.focus(),n.select&&n.select(),document.focus&&document.focus())};Sys.UI.DomElement.getCaretPosition=function(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart==="0")&&(t=n.selectionStart),t};Sys.UI.DomElement.setCaretPosition=function(n,t){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};p.AutoComplete=function(n){Web.AutoComplete.initializeBase(this,[n])};p.AutoComplete.prototype={initialize:function(){Web.AutoComplete.callBaseMethod(this,"initialize");this._textBoxMouseOverHandler=Function.createDelegate(this,this._onTextBoxMouseOver);this._textBoxMouseOutHandler=Function.createDelegate(this,this._onTextBoxMouseOut);this._completionListItemCssClass="Item";this._highlightedItemCssClass="HighlightedItem"},dispose:function(){this._viewPage=null;this._element&&($removeHandler(this._element,"mouseover",this._textBoxMouseOverHandler),$removeHandler(this._element,"mouseout",this._textBoxMouseOutHandler));Web.AutoComplete.callBaseMethod(this,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(n){this._fieldName=n},updated:function(){var n=document.createElement("div");n.className="AutoCompleteFrame "+this.get_typeCssClass();n.innerHTML=String.format('<table><tr><td class="Input"><\/td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;<\/span><\/td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;<\/span><\/td><\/tr><\/table>',this.get_id(),it,this.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");this._element.setAttribute("autocomplete","off");this._element.parentNode.insertBefore(n,this._element);n.getElementsByTagName("td")[0].appendChild(this._element);u.agent===u.WebKit&&(n.style.marginLeft="2px");this._completionSetCount===10&&(this._completionSetCount=100);$addHandler(this._element,"mouseover",this._textBoxMouseOverHandler);$addHandler(this._element,"mouseout",this._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(this,"updated");document.body.appendChild(this._completionListElement);this._completionListElement.className="CompletionList AutoComplete";this._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],!1)},_showFullList:function(){var t,i,n;if(!this._webRequest&&(t=this._popupBehavior.get_visible(),this._hideCompletionList(),this._element.focus(),!t)){if(this._completionWord="%",this._cache&&this._cache["%"]){i=this;setTimeout(function(){i._showCachedFullList()},50);return}n={prefixText:this._completionWord,count:this._completionSetCount};this._useContextKey&&(n.contextKey=this._contextKey);this._ignoreCompletionWord=!0;this._invoke(n,this._completionWord)}},_showDropDown:function(n){for(var t=this._element;t.tagName!="TR";)t=t.parentNode;n?Sys.UI.DomElement.addCssClass(t,"Active"):this._textBoxHasFocus?Sys.UI.DomElement.addCssClass(t,"Active"):Sys.UI.DomElement.removeCssClass(t,"Active")},_onKeyDown:function(n){var i,t;n.keyCode==Sys.UI.Key.down&&n.altKey&&(n.preventDefault(),n.stopPropagation(),this._showFullList());i=this._popupBehavior._visible;Web.AutoComplete.callBaseMethod(this,"_onKeyDown",[n]);(n.keyCode==Sys.UI.Key.enter||n.keyCode==Sys.UI.Key.esc)&&(t=this._get_fieldDataView(!0),t&&(t.get_isDataSheet()&&i?(n.preventDefault(),n.stopPropagation()):t.get_searchBarIsVisible()&&(n.preventDefault(),n.stopPropagation(),i||setTimeout(function(){t._performSearch()},100))))},_update:function(n,t,i){var r,u,f,e;if(Web.AutoComplete.callBaseMethod(this,"_update",[n,t,i]),t){for(r=-1,u=this._currentCompletionWord().toLowerCase(),f=0;f<t.length;f++)if(e=t[f],e!=null&&(e=e.toLowerCase(),r==-1&&e.startsWith(u)&&(r=f),e==u)){r=f;break}r>=0&&r<this._completionListElement.childNodes.length&&(this._selectIndex=r,u=this._completionListElement.childNodes[r],this._highlightItem(u),this._handleScroll(u,r+5))}},_get_fieldDataView:function(t){var r=null,i=this._get_contextInfo();return i&&(i.type=="Field"||t&&i.type=="SearchBar")&&(r=n.find(i.controller)),r},_setText:function(n){var u,c,t,o,y,l,r;if(Web.AutoComplete.callBaseMethod(this,"_setText",[n]),this._updateClearButton(),u=this._get_fieldDataView(),u){var f=u.findField(this.get_fieldName()),a=this.get_element().value,e=[];if(a!=h&&(c=this._enumerateViewPageItems(a),c!=-1)){var i=this._viewPage,v=i.Rows[c],s=[];for(t=0;t<i.Fields.length;t++)o=i.Fields[t],o.Name==f.ItemsDataValueField&&Array.add(s,o);if(s.length==0)for(t=0;t<i.Fields.length;t++)if(o=i.Fields[t],o.IsPrimaryKey){Array.add(s,o);break}for(t=0;t<s.length;t++)y=v[s[0].Index],Array.add(e,y)}if($get(u.get_id()+"_Item"+f.Index).value=e.toString(),this._originalElementText=this.get_element().value,this._get_isInLookupMode()){if(!isNullOrEmpty(f.Copy)){for(e=[],l=/(\w+)=(\w+)/g,r=l.exec(f.Copy);r;){if(r[2]=="null")Array.add(e,{name:r[1],value:null});else for(t=0;t<i.Fields.length;t++)i.Fields[t].Name==r[2]&&Array.add(e,{name:r[1],value:v[t]});r=l.exec(f.Copy)}u.refresh(!0,e)}u._valueChanged(f.Index)}}},_get_isInLookupMode:function(){var n=this._get_contextInfo();return n!=null&&n.type=="Field"},_updateClearButton:function(){var n=this._element.parentNode.parentNode;y(this._element.value)?Sys.UI.DomElement.removeCssClass(n,"Filtered"):Sys.UI.DomElement.addCssClass(n,"Filtered")},_onGotFocus:function(n){if(Web.AutoComplete.callBaseMethod(this,"_onGotFocus",[n]),this._showDropDown(!0),this._updateClearButton(),this._get_isInLookupMode()){var t=this.get_element();this._originalElementText=t.value;this._originalElementText==h&&(t.value="",t.select())}},_onLostFocus:function(n){Web.AutoComplete.callBaseMethod(this,"_onLostFocus",[n]);this._showDropDown(!1);this._updateClearButton();this._get_isInLookupMode()&&this._originalElementText!=null&&(this.get_element().value=this._originalElementText)},_onTextBoxMouseOver:function(){this._showDropDown(!0)},_onTextBoxMouseOut:function(){this._showDropDown(!1)},_currentCompletionWord:function(){if(this._completionWord){var n=this._completionWord;return this._completionWord=null,n}return Web.AutoComplete.callBaseMethod(this,"_currentCompletionWord")},_onTimerTick:function(n,t){var i,r;if(this._timer.set_enabled(!1),this._servicePath&&this._serviceMethod){if(i=this._currentCompletionWord(),i.trim().length<this._minimumPrefixLength){this._currentPrefix=null;this._update("",null,!1);return}if(this._currentPrefix!==i||i==""&&this._minimumPrefixLength==0){if(this._currentPrefix=i,i!=""&&this._cache&&this._cache[i]){this._update(i,this._cache[i],!1);return}if(t=new Sys.CancelEventArgs,this.raisePopulating(t),t.get_cancel())return;r={prefixText:this._currentPrefix,count:this._completionSetCount};this._useContextKey&&(r.contextKey=this._contextKey);this._webRequest&&(this._webRequest.get_executor().abort(),this._webRequest=null);this._invoke(r,i);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var n=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return n?{type:n[1],controller:n[2],fieldName:n[3]}:null},_invoke:function(t,i){var e=this,o=e._get_contextInfo(),u,h,k,f,c,w;if(o){var r=n.find(o.controller),s=[],v=o.fieldName,b="beginswith";if(o.type=="SearchBar"?s=r._createSearchBarFilter(!0):o.type=="Filter"?s=r.get_filter():(u=r.findField(this.get_fieldName()),v=isNullOrEmpty(u.ItemsDataTextField)?u.Name:u.ItemsDataTextField),!this._ignoreCompletionWord){for(h=0;h<s.length;h++)if(k=s[h].match(/^(\w+):/),k[1]==o.fieldName){Array.removeAt(s,h);break}u||(u=r.findField(v));u&&u.AutoCompleteAnywhere&&(b="contains");Array.add(s,String.format('{0}:${1}${2}\0',v,b,this._currentCompletionWord()))}var y=null,l=null,a=null,p,d;if(o.type=="Field"){if(l=u.ItemsDataController,a=u.ItemsDataView||"grid1",p=[u.ItemsDataTextField],u.Copy)while(d=n._fieldMapRegex.exec(u.Copy))p.push(d[2]);for(f={FieldName:u.Name,Controller:r.get_controller(),View:r.get_viewId()},c=r.get_contextFilter(u),h=0;h<c.length;h++)w=c[h],Array.add(s,String.format('{0}:={1}\0',w.Name,w.Value));y={PageIndex:0,RequiresMetaData:!0,RequiresRowCount:!1,PageSize:300,FieldFilter:p,SortExpression:u.ItemsDataTextField,Filter:s,ContextKey:r.get_id(),FilterIsExternal:c.length>0,LookupContextFieldName:f?f.FieldName:null,LookupContextController:f?f.Controller:null,LookupContextView:f?f.View:null,LookupContext:f,View:r.get_viewId(),Tag:r.get_tag(),MetadataFilter:["fields"],ExternalFilter:c}}else l=r.get_controller(),a=r.get_viewId(),y={FieldName:o.fieldName,Filter:s,LookupContextFieldName:f?f.FieldName:null,LookupContextController:f?f.Controller:null,LookupContextView:f?f.View:null,AllowFieldInFilter:this._ignoreCompletionWord!=!0,Controller:l,View:a,Tag:r.get_tag(),ExternalFilter:r.get_externalFilter()};r._busy(!0);e._webRequest=r._invoke(e.get_serviceMethod(),{controller:l,view:a,request:y},function(n,t){o.type=="Field"?(r._busy(!1),e._onGetPageComplete(n,t)):(r._busy(!1),e._onGetListOfValuesComplete(n,t))},i);e._ignoreCompletionWord=!1}else e._webRequest=Sys.Net.WebServiceProxy.invoke(e.get_servicePath(),e.get_serviceMethod(),!1,t,Function.createDelegate(e,e._onMethodComplete),Function.createDelegate(e,e._onMethodFailed),i)},_onGetListOfValuesComplete:function(n,t){n.length>0&&n[0]==null&&(n[0]=o.EmptyValue);this._webRequest=null;this._update(t,n,!0)},_onGetPageComplete:function(n,t){if(this._element){this._viewPage=n;var i=this._enumerateViewPageItems();this._onGetListOfValuesComplete(i,t)}},_enumerateViewPageItems:function(n){for(var i,f,e,r=this._viewPage,s=this._get_fieldDataView(),o=s.findField(this.get_fieldName()),u=[],t=0;t<r.Fields.length;t++)i=r.Fields[t],i.Index=t,i.Type||i.Type==="String",i.Name===o.ItemsDataTextField&&Array.add(u,i);if(!u.length)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden&&i.Type==="String"){Array.add(u,i);break}if(!u.length)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden){Array.add(u,i);break}for(f=[],o.AllowNulls&&Array.add(f,h),t=0;t<r.Rows.length;t++)if(e=r.Rows[t][u[0].Index],n!=null){if(e===n)return t}else Array.add(f,e);return n!=null?-1:f},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(n){this._typeCssClass=n}};n.borderBox=function(n){var t=$(n);return{horizontal:t.outerWidth()-t.innerWidth(),vertical:t.outerHeight()-t.innerHeight()}};n.paddingBox=function(n){var t=$(n);return{horizontal:t.innerWidth()-t.width(),vertical:t.innerHeight()-t.height()}};n.marginBox=function(n){var t=$(n);return{horizontal:t.outerWidth(!0)-t.outerWidth(),vertical:t.outerHeight(!0)-t.outerHeight()}};n.bounds=function(n){var t=$(n),i=t.offset();return{x:i.left,y:i.top,width:t.outerWidth(),height:t.outerHeight()}};n.scrolling=function(){return{x:k.scrollLeft(),y:k.scrollTop()}};n.clientBounds=function(){return{width:k.width(),height:k.height()}};r._body_hideLayoutContainers=function(){var t,i;if(n._layoutContainers)for(t=0;t<n._layoutContainers.length;t++)i=n._layoutContainers[t],i.width!="100%"&&Sys.UI.DomElement.setVisible($get(i.id),!1)};r._body_resizeLayoutContainers=function(){var r=n._layoutContainers,e,o,h,u,i,t;if(r&&r.length!=0&&(e=$get("PageContent"),e)){var s=n.bounds(e),y=n.paddingBox(e),p=n.borderBox(e),w=n.marginBox(e);for(s.width-=y.horizontal+p.horizontal+w.horizontal,o=r[r.length-1].rowIndex;o>=r[0].rowIndex;){for(h=0,u=0;u<r.length;u++)if(i=r[u],i.rowIndex==o&&!isNullOrEmpty(i.width)&&(t=$get(i.id),t)){var c=n.paddingBox(t),l=n.borderBox(t),a=n.marginBox(t),v=i.width.match(/(\d+)(%|px|)/),f=v[2]!="%"?parseFloat(v[1]):Math.floor(s.width*parseFloat(v[1])/100);h+=f;f-=c.horizontal+l.horizontal+a.horizontal;i.width!="100%"?(t.style.width=f+"px",Sys.UI.DomElement.setVisible(t,!0)):$(t).removeClass("LayoutContainer").addClass("RowContainer")}if(h<s.width)for(u=0;u<r.length;u++)i=r[u],i.rowIndex==o&&isNullOrEmpty(i.width)&&(t=$get(i.id),t&&(c=n.paddingBox(t),l=n.borderBox(t),a=n.marginBox(t),f=Math.floor((s.width-h)/i.peersWithoutWidth),f-=c.horizontal+l.horizontal+a.horizontal,f<1&&(f=1),t.style.width=f+"px",Sys.UI.DomElement.setVisible(t,!0)));o--}}};r._body_keydown=function(t){var i,r;if(t.keyCode==Sys.UI.Key.enter&&n._focusedItemIndex!=null){if(i=$find(n._focusedDataViewId),i&&i._get_focusedCell())return;r=$get(n._focusedDataViewId+"_Item"+n._focusedItemIndex);r&&r.tagName=="INPUT"&&r.type=="text"&&r==t.target&&(t.preventDefault(),t.stopPropagation(),i=$find(n._focusedDataViewId),i&&i._valueChanged(n._focusedItemIndex))}};r._body_resize=function(){$getSideBar()&&$("body,.MembershipBarPlaceholder").width("");n._resizeInterval&&clearInterval(n._resizeInterval);n._resizing||n._resized?$closeHovers():n._resizeInterval=setInterval(function(){_body_hideLayoutContainers();_body_resizeLayoutContainers();_body_performResize()},200);n._resized=!1};r._body_scroll=function(){var t=$getSideBar(),e,i,o;if(t){var r=n.scrolling(),s=$common.getClientBounds(),f=$common.getBounds(t);t._originalTop==null&&(t._originalTop=f.y);e=t._originalTop;i=0;n.MessageBar&&(o=$common.getBounds(n.MessageBar._element),e+=i=o.height);r.y>t._originalTop&&f.height+4<=s.height&&r.x==0?(t.style.width=f.width+"px",u.agent==u.InternetExplorer&&u.version<=6?(t.style.top=4+r.y+i+"px",t.style.position="absolute"):(t.style.top=4+i+"px",t.style.position="fixed")):(t.style.top="",t.style.width="",t.style.position="");$("body,.MembershipBarPlaceholder").width($("table#PageBody").outerWidth())}};r._body_createPageContext=function(t){var i=$get("PageContent");if(i){var u=$common.getBounds(i),f=$common.getPaddingBox(i),e=$common.getBorderBox(i),r={height:u.height-f.vertical-e.vertical,scrolling:n.scrolling()};return t!=!1&&(n._pageContext=r),r}};r._body_performResize=function(){var t,e,y,i,o,f,p,h,c,l,r,a;if(n._resizeInterval&&clearInterval(n._resizeInterval),n._resizeInterval=null,$closeHovers(),t=$get("PageContent"),t&&!s){if(e=$common.getClientBounds(),y=$common.getClientBounds(),n.MessageBar&&(i=n.MessageBar._element,$common.getVisible(i)&&(o=$common.getPaddingBox(i),i.style.width=y.width-o.horizontal+"px",f=i.childNodes[0],f.style.height="",p=$common.getBounds(f),h=Math.ceil(e.height*.15),p.height>h&&(f.style.height=h+"px",f.style.overflow="auto"),o=Sys.UI.DomElement.getBounds(i),c=n.OriginalBodyTopOffset+o.height,document.body.style.paddingTop=c+"px",l=$get("Membership_Login"),l&&(l.style.marginTop=c+"px"))),n._resizing=!0,r=n._pageContext,r==null?r=_body_createPageContext(!1):n._pageContext=null,a=n.scrolling(),a.y==0&&(t.style.height="10px"),_body_resizeLayoutContainers(),typeof __cothost=="undefined"){var w=n.bounds(t),b=n.paddingBox(t),k=n.borderBox(t),d=Web.Menu.MainMenuElemId?$get(Web.Menu.MainMenuElemId):null,g=d?$common.getBorderBox(d):null,nt=$get("PageFooterContent"),tt=$get("PageFooterBar"),v=a.y+e.height-w.y-(tt?tt.offsetHeight:0)-(nt?nt.offsetHeight:0)-k.vertical-b.vertical-(g?g.vertical:0);w.height<v&&u.agent==u.Opera&&(v+=k.vertical+b.vertical);!r.scrolling.y||n._numberOfContainers<2?t.style.height=document.body.offsetHeight>e.height?"":v+"px":(t.style.height=r.height+"px",scrollTo(0,r.scrolling.y))}_body_scroll();n._resizing=!1;n._resized=!0}};n._activate=function(t,i,r){var v=new RegExp("^\\s*"+r+"\\s*\\|"),u=$get(i),e,o,f,h,s,c;if(r==="SideBarTask"){for(e=u;e&&isNullOrEmpty(this.prototype.dataAttr(e,"flow"));)e=e.parentNode;for(o=e.getElementsByTagName("div"),f=0;f<o.length;f++)h=this.prototype.dataAttr(o[f],"activator"),!isNullOrEmpty(h)&&v.exec(h)&&$(o[f]).hide()}if(Sys.UI.DomElement.setVisible(u,r==="SideBarTask"?!0:!Sys.UI.DomElement.getVisible(u)),u._activated=!0,r==="SiteAction"&&u.childNodes[0].className!=="CloseSiteAction"&&(s=document.createElement("div"),s.className="CloseSiteAction",s.innerHTML=String.format("<a href=\"javascript:\" onclick=\"$app._activate(null,'{0}','SiteAction')\">{1}<\/a>",i,w.Close),u.insertBefore(s,u.childNodes[0])),Sys.UI.DomElement.getVisible(u)){var l=$common.getBounds(u),y=$common.getClientBounds(),a=n.scrolling();(l.y<a.y||l.y>a.y+y.height)&&u.scrollIntoView(!1)}if(t){while(t&&!Sys.UI.DomElement.containsCssClass(t,"Task"))t=t.parentNode;for(f=0;f<t.parentNode.childNodes.length;f++)c=t.parentNode.childNodes[f],c.className&&Sys.UI.DomElement.removeCssClass(c,"Selected");Sys.UI.DomElement.addCssClass(t,"Selected")}_body_performResize()};n._partialUpdateBeginRequest=function(t,i){for(var r,e,h,o=i.get_request(),s=d.getComponents(),u=[],f=0;f<s.length;f++)r=s[f],r._controller&&r._viewId&&isInstanceOfType(n,r)&&(e=r.get_tag(),isNullOrEmpty(e)||(Array.add(u,e),Array.add(u,r.get_selectedKey())));h=rt(u);o.set_body(o.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(h))};n._updateBatchSelectStatus=function(n,t){for(var r=t?"Item":"Cell",i=n.parentNode;i!=null&&!Sys.UI.DomElement.containsCssClass(i,r);)i=i.parentNode;i&&(n.checked?Sys.UI.DomElement.addCssClass(i,"BatchEditFrame"):Sys.UI.DomElement.removeCssClass(i,"BatchEditFrame"))};n.highlightFilterValues=function(n,t,i){while(n&&n.tagName!=="TABLE")n=n.parentNode;n&&(t&&!n.className.match(i)?Sys.UI.DomElement.addCssClass(n,i):!t&&n.className.match(i)&&Sys.UI.DomElement.removeCssClass(n,i))};r.$hoverTab=function(n,t){while(n&&n.tagName!=="TD")n=n.parentNode;n&&(t?(Sys.UI.DomElement.addCssClass(n,"Active"),n.focus()):Sys.UI.DomElement.removeCssClass(n,"Active"))};r.$getSideBar=function(){var t=$get("PageContentSideBar"),n,i;if(!t)return null;for(n=0;n<t.childNodes.length;n++)if(i=t.childNodes[n],i.className==="SideBarBody")return i;return null};r.$dvget=function(t,i,r,u){for(var e,s,h,c=d.getComponents(),l="_"+t,o=null,f=0;f<c.length;f++)if(e=c[f],e._id===t||isInstanceOfType(n,e)&&(e._id.endsWith(l)||e._controller===t&&(!i||e.get_viewId()===i))){o=e;break}if(o){if(r){if(s=o.findField(r),s){if(u){if(element=$get(o._id+"_ItemContainer"+s.Index),element)for(f=0;f<element.childNodes.length;f++)if(h=element.childNodes[f],h.className==="Value")return h}else return $get(o._id+"_Item"+s.Index);return element}return null}return o}return null};r.Web$DataView$RichText=function(){};r.Web$DataView$RichText.prototype={attach:function(n){var e=$(n),u,i,o,r,f,s;return e.addClass("dataview-rich-text"),u=$("html").attr("lang"),isNullOrEmpty(u)&&(u=$("html").attr("xml:lang")),typeof CKEDITOR!="undefined"?($("<div><\/div>").insertAfter(e).width(e.outerWidth()).height(1),CKEDITOR.replace(n.id,{language:u,on:{instanceReady:function(t){var i=CKEDITOR.instances[n.id].getCommand("maximize");i&&(i._old_exec=i.exec,i.exec=function(n){this._old_exec(n);$(t.editor.container.$).find(".cke_maximized").css("z-index",10001)})}}})):(i=t.Editor,o=[{CommandName:"Undo",Tooltip:i.Undo},{CommandName:"Redo",Tooltip:i.Redo},{CommandName:"Bold",Tooltip:i.Bold,ElementWhiteList:{b:["style"],strong:["style"]}},{CommandName:"Italic",Tooltip:i.Italic,ElementWhiteList:{i:["style"],em:["style"]}},{CommandName:"Underline",Tooltip:i.Underline,ElementWhiteList:{u:["style"]}},{CommandName:"StrikeThrough",Tooltip:i.Strikethrough,ElementWhiteList:{strike:["style"]}},{CommandName:"Subscript",Tooltip:i.Subscript,ElementWhiteList:{sub:["style"]}},{CommandName:"Superscript",Tooltip:i.Superscript,ElementWhiteList:{sup:["style"]}},{CommandName:"JustifyLeft",Tooltip:i.JustifyLeft,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["left"]},{CommandName:"JustifyCenter",Tooltip:i.JustifyCenter,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["center"]},{CommandName:"JustifyRight",Tooltip:i.JustifyRight,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["right"]},{CommandName:"JustifyFull",Tooltip:i.JustifyFull,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["justify"]},{CommandName:"insertOrderedList",Tooltip:i.InsertOrderedList,ElementWhiteList:{ol:[],li:[]}},{CommandName:"insertUnorderedList",Tooltip:i.InsertUnorderedList,ElementWhiteList:{ul:[],li:[]}},{CommandName:"createLink",Tooltip:i.CreateLink,ElementWhiteList:{a:["href"]}},{CommandName:"UnLink",Tooltip:i.UnLink},{CommandName:"RemoveFormat",Tooltip:i.RemoveFormat},{CommandName:"SelectAll",Tooltip:i.SelectAll},{CommandName:"UnSelect",Tooltip:i.UnSelect},{CommandName:"Delete",Tooltip:i.Delete},{CommandName:"Cut",Tooltip:i.Cut},{CommandName:"Paste",Tooltip:i.Paste},{CommandName:"BackColor",Tooltip:i.BackColor,ElementWhiteList:{font:"style",span:"style"},AttributeWhiteList:{style:"background-color"}},{CommandName:"ForeColor",Tooltip:i.ForeColor,ElementWhiteList:{font:"color"},AttributeWhiteList:{font:"color"}},{CommandName:"FontName",Tooltip:i.FontName,ElementWhiteList:{font:["face"]},AttributeWhitList:{face:[]}},{CommandName:"FontSize",Tooltip:i.FontSize,ElementWhiteList:{font:["size"]},AttributeWhitList:{size:[]}},{CommandName:"Indent",Tooltip:i.Indent,ElementWhiteList:{blockquote:["style","dir"]},AttributeWhitList:{style:["margin","margin-right","padding","border"],dir:["ltr","rtl","auto"]}},{CommandName:"Outdent",Tooltip:i.Outdent},{CommandName:"InsertHorizontalRule",Tooltip:i.InsertHorizontalRule,ElementWhiteList:{hr:["size","width"]},AttributeWhiteList:{size:[],width:[]}},{CommandName:"HorizontalSeparator",Tooltip:""}],navigator.appVersion.match(/MSIE/)&&o.splice(0,2),r=Sys.Extended.UI.HtmlEditorExtenderBehavior,r._customized||(r.prototype.old_executeCommand=r.prototype._executeCommand,r.prototype._executeCommand=function(n){$(this._editableDiv).focus();this.old_executeCommand(n)},r._customized=!0),f=$create(r,{ToolbarButtons:o,id:n.id+"$Editor"},null,null,n),f._noEncoding=!0,f._editableDiv.tabIndex=n.tabIndex,s=$(f._topButtonContainer),s.find("nobr span").hide(),s.find("select").css({"font-family":"","font-size":""})),!0},detach:function(n){if(typeof CKEDITOR!="undefined")CKEDITOR.remove(n.id);else{var t=$find(n.id+"$Editor");t&&t.dispose()}return!0},persist:function(n){if(typeof CKEDITOR!="undefined")n.value=CKEDITOR.instances[n.id].getData();else{var t=$find(n.id+"$Editor");t&&(n.value=t._editableDiv.innerHTML)}}};p.PageState={};p.PageState._init=function(){var n=this,i,t;n._state||(i=n._ostate=$("#__COTSTATE"),t=i.val(),n._state=t?st.deserialize(t):{})};p.PageState._save=function(){this._ostate.length&&this._ostate.val(rt(this._state))};p.PageState.read=function(n){return this._init(),this._state[n]};p.PageState.write=function(n,t){this._init();this._state[n]=t;this._save()};n._startDelayedLoading=function(){n._delayedLoadingViews.length>0&&!n._delayedLoadingTimer&&(n._delayedLoadingTimer=setInterval(function(){n._performDelayedLoading()},500))};n._delayedLoadingViews=[];n._performDelayedLoading=function(){for(var r=0,i=n._delayedLoadingViews,t,u,e,f;r<i.length;)t=i[r],u=t._filterSource,t.get_isDisplayed()?(Array.remove(i,t),t._delayedLoading&&(u&&(f=n.find(u),f&&f._busy()&&(e=!0)),e||t._loadPage())):r++;i.length||(clearInterval(n._delayedLoadingTimer),n._delayedLoadingTimer=null)};n._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];n.showMessage=function(t){var r,i,u,o,s,f,e;y(t)&&(t=null);r=document.getElementsByTagName("body")[0];n.MessageBar||(i=document.createElement("div"),i.id="DataView_MessageBar",r.appendChild(i),Sys.UI.DomElement.setVisible(i,!1),Sys.UI.DomElement.addCssClass(i,"MessageBar"),n.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},null,null,i),u=Sys.UI.DomElement.getBounds(r),u.y<0&&(u.y=0),n.OriginalBodyTopOffset=u.y);i=$get("DataView_MessageBar");o=Sys.UI.DomElement.getVisible(i);i.innerHTML=t?String.format('<div>{0}<\/div><div class="Stub"><\/div>',t):"";Sys.UI.DomElement.setVisible(i,t!=null);s=Sys.UI.DomElement.getBounds(i);f=t?n.OriginalBodyTopOffset+s.height:n.OriginalBodyTopOffset;r.style.paddingTop=f+"px";e=$get("Membership_Login");e&&(e.style.marginTop=f+"px");Sys.UI.DomElement.getVisible(i)!==o&&_body_performResize()}})();
/*!
* Data Aquarium Framework - If This Than That + Kiosk UI
* Copyright 2020 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function v(n,t,i){var r=n.id;return r||(r=n.id="flow"+pu++),t=r+"_"+t,arguments.length<3?lr[t]:lr[t]=i}function ar(n,t,i){var r=v(n,t);return r==null&&(r=i,v(n,t,r)),r}function w(t,i,r){n.notify(arguments.length>1?{text:t,force:i,duration:r}:t)}function b(){return n.busy()||n.isInTransition()}function vr(){return $.mobile.activePage||$()}function s(n){return $('<div class="'+n+'"><\/div>')}function ni(){return!1}function ot(n){o.barcode(":always",n)}function at(){return r&&!r.nextAll(".ui-page-active").length}function k(i){if(arguments.length)i?(ot(!r||at()),t&&t.input.barcode&&$(document.activeElement).blur(),o.valid()&&(dt||(dt=it("ui.transitions.style")),it("ui.transitions.style","none"),tt.addClass("app-ui-automation"),vr().addClass("app-ui-automation-root"))):(ot(at()),$(".app-ui-automation,.app-ui-automation-root").removeClass("app-ui-automation app-ui-automation-root"),o.barcode(":peek")==null&&n.resetUI(),it("ui.transitions.style",dt));else return tt.is(".app-ui-automation")}function vt(n){n===!0?(tt.addClass("app-ui-automation-system"),it("ui.transitions.style",dt)):(tt.removeClass("app-ui-automation-system"),it("ui.transitions.style","none"))}function yr(){vt();r&&ot(!0)}function y(n){return n="ui.automation."+n,it.apply(this,arguments)}function st(n){n&&e.error(n);et&&et.resolve()}function yi(){et&&et.reject()}function ti(n){return JSON.stringify(n).replace(/","/g,'", "')}function pr(n){return new RegExp(RegExp.escape(n).replace(/\\\+/g,".+?"),"i")}function h(n,t,i){var o=t&&t.length,u,e,r,f;if(n&&n._extended)return n;if(o===1&&typeof n=="object"&&!("selector"in n)){n._extended||(n._extended={});for(e in n)li.indexOf(e)<0&&(n.selector=e,u=n[e],u instanceof d&&(n[e]=u=u.unwrap()),n._extended.mapped||(n.value=u,n._extended.mapped=!0))}return n==null&&(n=""),typeof n=="string"&&(n={selector:n,_extended:{}}),r=n.regex,r||(r=n.selector,r==null&&(r=""),r instanceof RegExp||(r=r.toString(),r!=null&&r.match(/^@/)?(r=r.substring(1),n.identifier=r):r=pr(r)),n.regex=r),t&&(o>1&&(u=t[1],u instanceof d&&(u=t[1]=u.unwrap()),n.value=u,i===2&&(n.in=u)),o>2&&(n.in=t[2])),n.in&&(f={selector:n.in},f=h(f),f.identifier?n.inIdentifier=f.identifier:n.inRegex=f.regex),n}function pi(n){var i=n&&n._survey,t=i&&i.context;return t&&typeof t=="object"&&"model"in t&&"search"in t&&(n=f.find(t.id)),n}function wi(){var t=r&&!k()?lt(r.prevAll(".ui-page-active,.ui-page").first().attr("id")):n.dataView(),i;return t=r&&!k()?r.prevAll(".ui-page-active").length?n.dataView():lt(r.prevAll(".ui-page:first").attr("id")):n.dataView(),t||(i=$("#Main .app-echo:first"),i.length&&(t=lt(i.data("for")))),t}function yt(n){var t=wi(),i;return t&&(t=pi(t),n.in&&(n.inIdentifier?i=t.findField(n.inIdentifier):t._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(i=t),!i}),t=i?f.find(i._dataViewId):null)),t}function wr(n,t,i,r){!n._allFields||n._busy()||ni()?setTimeout(wr,32,n,t,i,r):br(n,t,i,r)}function br(n,i,r,u){if(r)u(n,i)!==!1&&(t.error?i.reject():setTimeout(e._wait,nt,i));else{var f=u(n,i);f&&f.then||(f?i.resolve(f):i.reject())}}function bi(n,t,i,r){var u=wi(),s,e;return u&&(u=pi(u),n.in&&(n.inIdentifier?e=u.findField(n.inIdentifier):u._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(e=t),!e}),e?(u=f.find(e._dataViewId),s=!u._allFields||u._busy()):u=null)),r&&(s?(o.focus({field:e}),wr(u,t,i,r)):br(u,t,i,r)),u}function p(n,t){var i,r=n.identifier;return t||(t=yt(n)),t&&(r?i=t.findField(r):t._allFields.every(function(t){return t.HeaderText.match(n.regex)&&(i=t),!i})),i}function kr(n,t){var u={},i,r,f=[];if(n._extended.mapped)for(r in n)li.indexOf(r)<0&&(i=p(h({selector:r,"in":n.in})),i?u[i.Name]=n[r]:f.push(r));else i=p(n),i?u[i.Name]=n.value:f.push(n.selector);return f.length&&(e.error(t+': "'+f.join('", "')+'" not found.'),st(!1),u=null),u}function ki(t,i,r){var u,o=n.contextScope(),e=i.identifier,f;return t&&(f=!t.get_isForm(),r||(r=[]),r.length||(n.contextScope(t),n.navContext(r),n.contextScope(o)),r.every(function(n){var r=n.text;return(e==null||n.path!==e)&&(!r||n.system&&!i.system||n.command==="New"&&f&&(n.argument===t._viewId||!n.argument)||n.command==="Edit"&&f&&(n.argument===t._viewId||!n.argument)||!r.match(i.regex))||(u=n),!u})),u}function dr(n,t,i,r){var f=[],e=[],o,s;if(r.method==="filter"){f=null;for(o in i)s=n.findField(o),s&&e.push(s.Name+":=%js%"+JSON.stringify(i[o]))}else n._allFields.forEach(function(n){n.IsPrimaryKey&&(f.push(t[n.Name]),e.push(n.Name+":=%js%"+JSON.stringify(t[n.Name])))});r.filter&&!u&&(n._syncFilter=!0,n.set_filter(e));n.sync(f);n._syncFilter=!1}function d(n){this._deferred=$.Deferred();this._pending=n?n._pending.slice():[]}function bu(){var c=$app.userName(),i=$('<span class="app-avatar"/>').attr("data-title",c).appendTo(r),e=Web.Menu.currentNode,l=y("kiosk.copyright"),a,o,h,t;for(a=$('<span class="app-logo"/>').appendTo(r).html(n.appName()),e&&n.icon("material-icon-chevron-right",$('<span class="app-page-title"/>').appendTo(a.attr("data-title",e.description)).text(e.title)),$('<span class="app-btn-menu ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"/>').appendTo(r).attr("data-title",rt.Menu),o=$('<span class="app-btn-context ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"/>').appendTo(r).attr("data-title",rt.More),f.AccountManager.avatar(c,$('<i class="app-icon-avatar"/>').text(n.initials(f.userName())).appendTo(i)),f.userName()?o=i:(i.hide(),$('<span class="app-login ui-btn"><\/span>').appendTo(r).attr("data-title",Web.MembershipResources.Bar.LoginLink)),u=s("app-display").appendTo(r),l!==!1&&s("app-copyright app-acc-footer").appendTo(r.addClass("app-has-copyright")).html(l||$("#PageFooterBar,footer small").html()),h=r.width()-o.offset().left-28,t=1;t<3;t++)h+=50,$('<span class="ui-btn ui-btn-icon-notext ui-btn-left app-btn app-btn'+t+'"><i class="app-icon material-icon"><\/i><\/span>').css("right",h).appendTo(r).hide()}function pt(n){if(u)if(n===!0){var i=u.data("config"),t;navigator.userAgent.match(/Edge/)&&(t=$(".app-kiosk > .ui-btn,.app-kiosk > .app-logo").hide());u.empty();gi(i);t&&t.show()}else clearTimeout(or),or=setTimeout(pt,200,!0)}function wt(n){if(u)if(n){var t=n.dataView._id,i=ut.indexOf(t);i===-1&&ut.push(n.dataView._id);setTimeout(wt)}else b()?setTimeout(wt,nt):ut.length&&ou()}function ku(n){return'&nbsp;<i class="app-icon material-icon" aria-hidden="true">expand_'+(n?"less":"more")+"<\/i >"}function du(){return 8}function gu(n){return n.toString()}function nf(){return this._config.columns||8}function ii(n,t){n&&(n._dataView=t,n.val=t?tf:null)}function tf(n){var r=this,u=r._dataView,t,i;return n&&(n.match(/^@/)?n=n.substring(1):t=n instanceof RegExp?n:pr(n)),u._allFields.every(function(r){return(t&&r.HeaderText.match(t)||r.Name===n)&&(i=r.Name),!i}),r[i]}function gr(n){var t=n._inDataView;return n._hasFields&&!t.get_isForm()&&n._count>1}function rf(n){return{width:n[0].offsetWidth-n[0].clientWidth+1,height:n[0].offsetHeight-n[0].clientHeight+1}}function nu(n,t){var r=t==="fill",i;return t!=null&&(i=s("app-container-content").attr("tabindex",0).appendTo(n.toggleClass("app-container-autosize",r)),i.css({"margin-right":i[0].clientWidth-i[0].offsetWidth-1,height:!r&&t!==!1?t:null})),i}function di(n){var t=n.perform;return"barcode"in n||t&&(typeof t=="function"||t.show||t.hide||typeof t.pick=="string")}function uf(n){var i=[],t=y("numPad.buttons"),r=n.label;return t||(t=standardNumPadButtons,n.compact&&(t=JSON.parse(JSON.stringify(t)),t[1][3]=t[3][2],t[2][3]=t[4][0],t[2][3].tall=!0,t.splice(t.length-1))),i.push('<div class="app-numpad">'),r&&i.push('<div class="app-label">'+f.htmlEncode(r)+"<\/div>"),i.push('<div class="app-text app-null"><span class="app-value"/><i class="app-icon material-icon" aria-hidden="true" title="'+rt.ClearText+'" data-key="Clear">clear<\/i><\/span><\/div>'),t.forEach(function(n){var t=0,r;n.forEach(function(n){t+=n.width||1;n.tall&&(r=!0)});i.push('<div class="app-row'+(r?" app-tall":"")+'">');n.forEach(function(n){var f=n.icon,e=n.font,r=n.key,u=n.test;typeof r=="function"&&(r=r());u&&ai.push(u);i.push('<span class="app-btn app-feedback'+(n.accent?" app-accent":"")+(n.dark?" app-dark":"")+(n.tall?" app-tall":"")+'" style="width:'+(n.width||1)/t*100+"%;"+(e?"font-size:"+e+";":"")+'" data-key="'+r+'"'+(u?' data-test="'+(ai.length-1)+'"':"")+">");i.push(f?'<i class="app-icon material-icon" aria-hidden="true">'+f+"<\/i>":n.text||r);i.push("<\/span>")});i.push("<\/div>")}),i.push("<\/div>"),i.join("")}function gi(t){var a,d,o,i,v,w,nt,l,tt,b,it,e,k;if(!arguments.length||typeof t!="string"&&!t.length)return"[Invalid display]";for(u.data("config")!==t&&u.removeData("created"),u.data("config",t),c=s("app-display-content").attr("tabindex",0).appendTo(u),typeof t=="string"?t={other:t}:Array.isArray(t)&&(t={other:t}),u.css({width:"",height:"",left:"","margin-left":"",display:""}),d=n.toWidth(u.width()),o=logicalWidthArray.indexOf(d),hi=o;o>=0;)if(i=t[logicalWidthArray[o]],i)break;else i=null,o--;return i||(i=t.other),v=Math.min(Math.max(r.width(),n.toWidth(d)),y("kiosk.maxWidth")||n.toWidth("xxl")),w=rf(c),u.css({width:v,height:u.height(),left:"50%","margin-left":-v/2+1}),c.css("width",v+w.width),c.css("height",u.height()+w.height),typeof i=="string"?s("app-content app-text").appendTo(c).html(i):(u.data("created")||(u.data("created",new Date),i.forEach(function(n){delete n._lastResult})),g(i,function(n){tu(n);g(n,function(n){tu(n)},!1)},!1),nt=wi(),l=c,ir(i,u),i.forEach(function(n,t){var d=n.in,v,ct,ft,ot,lt,at,vt;if(d?(d=p(h({"in":d})),d?(v=d._dataView,n._inDataView=v):a='Invalid DataView field "'+n.in+'".'):(v=nt,n._inDataView=nt),!n.hidden){n._count=n.count||10;n._newRow&&(tt=s("app-row").appendTo(c));n._newCol&&(l=ri(s("app-column"),n._width).appendTo(tt));var rt=n.append?l.find(".app-container:last"):null,i=rt?rt.length?rt:l:s("app-container").attr("data-index",t).appendTo(l).data(n),u,ut,o=n.tab,pt=o||n.label,et,ht=n.height;if(o?b&&(ut=b):(b=null,e=null),pt!=null&&(ut||(ut=s("app-header").appendTo(i)),o!=null&&o===it&&e?(et=e,k=e.data("tab")):(et=s("app-text").text(pt).data("config",n).appendTo(ut),o!=null&&(k=[],e=et.data("tab",k))),o!=null&&(it=o,b=ut.addClass("app-tabset"),e=et,k.push(i))),v)if(ct=[],g(n,function(t,i){var e=t.type,r,u,f;t.expression?(n._hasFields=!0,u=!0):di(t)||(i==="numpad"?f=uf(t):i==="#"?("tall"in t||(t.tall=ft?ft.tall:!0),t.field={Name:"#",HeaderText:"#",Type:"Int32",_config:t,format:gu,toColumns:nf},u=!0):i===">"?(t.tall=ft?ft.tall:!0,t.field={Name:">",Type:"Boolean",HtmlEncode:!1,_config:t,format:ku,toColumns:du},t.label=!1,u=!0):(r=e==="field"||!e?p(h(t.clone||i),v):null,r&&(t.field=v._allFields[r.AliasIndex],n._hasFields=!0,u=!0)));t.dense&&(t.density="condensed");t._label=t.label!=null?t.label:r?r.HeaderText:i;ct.push({html:f?f:'<div data-type="'+(u?"field":"button")+'" data-name="'+i+'"'+(r?' data-field="'+r.Name+'"':"")+">"+(u?'<span class="app-label"/><span class="app-value"/>':'<span class="app-button app-feedback"><span class="app-text"/><\/span>')+"<\/div>",obj:t});ft=t}),n._propCount)n._items=ct,gr(n)?(ot=0,lt=[],g(n,function(t,i,r){var u=t.field;if((!t.flow||!r&&t.flow==="row")&&u)t._grid=!0,i===">"&&(n.expand=!0,n._expanded=ar(n,"expanded",{})),lt.push(t),at=u.toColumns(),t._columns=at,ot+=at;else return!1}),ot&&(vt=s("app-row-header").appendTo(i),lt.forEach(function(n){var t=n.field,i=n._label;n._width=n._columns/ot;$('<span class="app-text"/>').appendTo(ri($('<span class="app-column-header"/>'),n._width).appendTo(vt).attr("data-name",t.Name).attr("data-type",t.Type).toggleClass("app-field-type-numeric",t.Type.match(f._numericTypeRegex)!=null)).text(i!==!1?i:"")})),ir(n,vt||i),nu(i,ht||!1),n.letters&&s("app-letters").data("config",n).appendTo(i.addClass("app-has-letters"))):(ht!=null?u=nu(i,ht):(u=i,rt&&(u=i.find(".app-container-content"),u.length||(u=i))),ir(n,u),iu(n,u));else{rt&&(u=i.find(".app-container-content"),u.length&&(i=u),i=s("").appendTo(i));var yt=n.image,r=n.content,st=yt!=null||r!=null?!1:n.gapColor||y("kiosk.gapColor"),kt=st!==!1&&n.gapAccent,wt=n.dense?"condensed":n.density,bt=n._gap=i.addClass("app-gap").toggleClass("app-accent",n.gapAccent===!0).toggleClass("app-gap-bkg",st===!0).css({height:yt||r?"":n._vertGap?"100%":tr(n),"background-color":kt||st===!1?null:n.gapColor||st});yt?r=$("<img/>").appendTo(bt).attr("src",f.resolveClientUrl(n.image)):r&&(r.match(/^\s*<\w+/)||(r='<div class="app-html">'+r+"<\/div>"),r=$(r).appendTo(bt),parseInt(r.css("font-size"))||r.addClass("app-html"),wt&&r.addClass("app-density-"+wt));r&&r.css({"max-width":i.width(),"max-height":c.height()-w.height})}return!a}})),a||(rr(),ut.splice(0),ou(!1),u.find(".app-tabset .app-text:first").each(function(){var n=$(this),t=n.parent().find(".app-text"),i=ar(n.data("config"),"selectedTab",0);$(t[i<t.length?i:0]).trigger("vclick")}),nr(),fi()),a}function nr(){var i=c.find(".app-container-autosize:not(.app-hidden)"),n,t;i.length&&i.each(function(){var o=$(this),i=o.find(".app-container-content"),r,f,s,h,e;i.data("sized")||i.is(".app-hidden")||(n==null&&(n=u.offset().top+u.height(),t=c.children().last()),i.data("sized",!0),r=o.parent(),f=r.children().filter(":visible").last(),s=r.offset().top+r.height()-(f.offset().top+f.outerHeight(!0)),h=n-(t.offset().top+t.outerHeight(!0)),e=i.height()+h+s,e>100&&i.height(e))})}function tu(n){var i=n.alter,e=i,r,h,t,o,l,a,s,f,c,y=["_lastResult"],v=[];for(t in n)t.match(/^_/)&&y.indexOf(t)<0&&v.push(t);if(v.forEach(function(t){delete n[t]}),i){s=e.remove||{};for(t in s)delete n[t];f=e.restore||{};for(t in f)n[t]=f[t];r=i.portrait;r&&u.width()<u.height()?i=r:(r=i.landscape,r&&u.width()>u.height()&&(i=r));for(t in i)if(o=t.match(vu),o&&(l=logicalWidthArray.indexOf(o[1]||logicalWidthArray[0]),a=logicalWidthArray.indexOf(o[3]||logicalWidthArray[logicalWidthArray.length-1]),l<=hi&&hi<=a)){h=i[t];for(t in h)t in n?f[t]=n[t]:s[t]=!0,c=h[t],c==null?delete n[t]:n[t]=c;e.remove=s;e.restore=f;break}}}function tr(n){var t=n.gapSize,i=t!=null?t:y("kiosk.gapSize");return i==null?12:i}function bt(n){return!n._propCount&&n.content==null&&n.image==null}function ir(n,t){var e=[],r,f,s=t.width(),i,o;g(n,function(t){var s=Array.isArray(n)&&typeof n=="object",u;s&&g(t);u=t.flow;t._grid||(u!=="row"&&r?u==="column"&&(o=!0,f=[],r.push(f),bt(t)&&s&&(t.width==null&&(t.width=tr(t)),t._vertGap=!0)):(s&&(u==="column"||u==="row"&&(!i||i.flow==="row"&&bt(i)))&&bt(t)&&(t.width==null?t.width=tr(t):t._keepWidth=!0,t._vertGap=!0),r=[],f=[],e.push(r),r.push(f)),f.push(t),!u&&t._propCount&&i&&bt(i)&&i._vertGap&&(i._keepWidth&&delete i.width,delete i._vertGap));i=t});o&&e.forEach(function(n){var r=0,i=0,t=n[0][0];n.length===1&&n[0].length===1&&bt(t)?(delete t._vertGap,t._keepWidth||delete t.width,t._width=1,t._newCol=!0,t._newRow=!0):n.forEach(function(t,f){var o=t[0].width,h,c;o!=null?(typeof o=="string"&&(o.match(/%$/)?o=parseFloat(o)/100:o.match(/^\d+x$/)?(ct||(h=$('<div class="app-container"><div data-type="button"><div class="app-button app-no-text"><\/div><\/div><\/div>').appendTo(u),c=h.find(".app-button"),ct={w:c.width(),g:parseInt(c.css("margin-left"))},h.remove()),o=parseInt(o)*(ct.w+ct.g)+ct.g):o=parseInt(o)),t[0]._width=o=o<=1?o:o/s,r+=o):(i++,t[0]._width=null);(n.length>1||e.length>1)&&(f||(t[0]._newRow=!0),t[0]._newCol=!0)});i&&n.forEach(function(n){n[0]._width==null&&(n[0]._width=(1-r)/i)})})}function ri(n,t){return t=t!=null?t*100+"%":"",n.toggleClass("app-full-width",t==="100%"),n.css({width:t,minWidth:t,maxWidth:t})}function ui(n,t){return typeof n=="function"&&(n=n(t)),n}function iu(n,t){var o=n._items,u=t,i=0,r,h=0,e;o.forEach(function(c){var l=c.obj,y=c.html,a,p=l._grid,v=l.darkest?.75:l.dark,k=l._width,w=l._newRow,b=0;if((w||!r&&p)&&(e=!1,u=r=s("app-row").toggleClass("app-collapsed",n.expand&&h>0).appendTo(t),w&&i--)){while(i>=0)b+=o[i--].obj._width;r.css("margin-left",b*100+"%")}l.field&&!e&&(e=!0,h++);l._newCol&&(u=ri(s("app-column"),k).appendTo(r||t));(p||l._label===!1)&&(y=y.replace('<span class="app-label"/>',""));a=l.item=$(y).appendTo(u);p&&(a.toggleClass("app-field-type-numeric",l.field.Type.match(f._numericTypeRegex)!=null),l.tall&&i++);v!=null&&(v===!0&&(v=.5),su(a.find(".app-button"),1-v));di(l)&&a.find(".app-button").data("obj",l)})}function g(n,t,i){var u,r,e,f=0;for(u in n)if(yu.indexOf(u)===-1&&!u.match(/^_/)&&u!=="alter"&&(r=n[u],typeof r=="function"&&(r=n[u]={expression:r}),r!=null&&typeof r=="object"&&(!r.hidden||r.visible||i===!1)&&(e=t?t(r,u,f++):++f,e===!1)))return;n._propCount==null&&(n._propCount=f)}function ru(t,i,r){var u=t._inDataView,e=u.get_isForm(),f;g(t,function(o,s){var c=o.field,tt=o.expression,y,rt,g,a=o.item,ft=a,b,k,w=o.tooltip,nt,ut;if((c||tt)&&r){var p=tt?tt.apply(r,[r]):r[c.Name],et=p==null,l,ht=o.text!==!1,ot=o._label,st=!nt&&ot===!1,ct=c?c.HtmlEncode:!0,d=a.find(".app-value"),lt=a.find(".app-label");et?l=au:p.getMonth&&it("ui.smartDates")?(l=n.toSmartDate(p,new Date),d.attr({"data-smart-type":c?c.Type:"DateTime","data-smart-value":JSON.stringify(p),"data-title":c?c.format(p):String.format("{0:"+$app.dateFormatStrings["{0:g}"]+"}",p)})):l=c?c.format(p):p.toString();ct?d.text(l):d.html(l);nt=o._grid;d.toggleClass("app-medium",o.medium===!0||o.mediumValue===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0).toggleClass("app-accent",o.accent===!0||o.accentValue===!0).toggleClass("app-nowrap",!nt&&o.wrap===!1).css("color",ui(o.colorValue,r));ut=o._width;ut&&nt?ri(a.addClass("app-cell").toggleClass("app-nowrap",o.wrap===!1),ut):lt.text(ot).toggleClass("app-medium",o.medium===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeLabel===!0).toggleClass("app-accent",o.accent===!0||o.accentLabel===!0).css("color",ui(o.colorLabel,r));a.toggleClass("app-label-hidden",st).toggleClass("app-null",et).toggleClass("app-medium",o.medium===!0||o.mediumValue===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0||o.largeLabel===!0);(st&&c||w!=null)&&a.attr("data-title",w!=null?w:c.HeaderText);o.density&&a.addClass("app-density-"+o.density);o.align&&a.addClass("app-align-"+o.align);c&&c.Name===">"&&d.attr("data-title",p?cr.Minimize:cr.Maximize);c&&e&&a.css("display",$("#"+t._inDataView._id+' [data-field="'+u._allFields[c.OriginalIndex].Name+'"]').is(":visible")?"":"none")}else ft=y=a.find(".app-button"),rt=y.find(".app-text"),g=v(o,"checked"),ht&&(l=o.text),l==null&&(l=s),di(o)?rt.text(l):(f=i[u._id],f||(i[u._id]=f=[]),b=ki(u,h(s),f),b?(y.show().data({obj:o,contextItem:b}),l=b.text,w=b.tooltip,rt.text(l)):y.hide()),w==null&&(w=l),k=o.icon||(b?b.icon:null),y.find("i").remove(),k&&n.icon(k,y),y.toggleClass("app-no-icon",k===!1||k==null).toggleClass("app-wide",o.wide===!0),g!==!0&&(typeof g!="function"||!g(r))||n.icon("material-icon-check-circle",y).addClass("app-checked"),o.text===!1&&(y.addClass("app-no-text"),l=null),w!==l&&y.attr("data-title",w);ft.css({backgroundColor:ui(o.colorBackground,r),color:ui(o.color,r)});o.when&&a.css("display",r&&o.when(r)?"":"none")})}function uu(n,t){var r=[],u=[],i;return n._lastResult.primaryKey.forEach(function(n){i=t[n.Name];r[n.Index]=i;u.push(i)}),{row:r,key:u}}function fu(t,i,r){t._lastResult=r;var y=t._inDataView,k={},p,c=i.find(".app-container-content").empty(),e,u=r.pageIndex,f=r.pageSize,o=r.totalRowCount,w=t._expanded,h,l,a=r.letters,b=[],d=v(t,"beginsWithLetter");r.list.forEach(function(n,i){n["#"]=u*f+i+1;h=s("app-item app-feedback").appendTo(c).data({id:y._id,obj:n,config:t});iu(t,h);var r=uu(t,n);w&&(l=w[r.key.toString()]===!0,n[">"]=l,l||h.addClass("app-collapsed"));ii(n,y);ru(t,k,n);ii(n);p||t._inDataView.rowIsSelected(r.row)&&(p=!0,h.addClass("app-selected"))});f<o&&(e=s("app-row-pager").appendTo(c).data("config",t),n.icon("material-icon-navigate-before",$('<span class="app-btn app-feedback app-prev"/>').appendTo(e).attr("data-title",ci.Previous).toggleClass("app-disabled",!u)),n.icon("material-icon-navigate-next",$('<span class="app-btn app-feedback app-next"/>').appendTo(e).attr("data-title",ci.Next).toggleClass("app-disabled",u===Math.ceil(o/f)-1)),$('<span class="app-info"/>').appendTo(e).html(String.format(ci.ShowingItems,u*f+1,Math.min(o,(u+1)*f),o)));fi(c);t.letters&&a&&(a.list.forEach(function(n){b.push('<span title="'+n+'"'+(d===n?' class="app-selected"':"")+">"+n+"<\/span > ")}),i.find(".app-letters").html(b.join("")).data("letters",a))}function fi(n){if(n){var r=n.find(".app-selected"),t,i;r.length&&(i=r[0].getBoundingClientRect(),t=n[0].getBoundingClientRect(),(i.top<t.top||i.bottom>t.bottom)&&n.scrollTop(i.top-t.top+n.scrollTop()-(t.height-i.height)/2))}else $(".app-display .app-row-header+.app-container-content").each(function(){fi($(this))})}function eu(n,t,i){var u=n._inDataView,e=n.letters,r,s=i==null,o=n.loadOnStart;o===!1&&delete n.loadOnStart;i=i||0;e&&(r=v(n,"beginsWithFilter"));f.execute({from:u,as:"list",pageSize:n._count,pageIndex:i,requiresRowCount:!0,_filter:r?[r]:null,sync:s?u._selectedKey:null,requiresData:o==null,letters:e&&i===0}).then(function(i){fu(n,t,i)})}function ou(n){var i=u.data("config"),r={},f={},o={},t,e;typeof i!="string"&&(t=c.children().last(),t&&(e=t.offset().top),i.forEach(function(n,t){var i=n._inDataView,l=ut.length,s=s=u.find('.app-container[data-index="'+t+'"]'),a=i._dataViewFieldOwnerId||i._id,h=f[i._id],c,e;(h==null&&(h=f[a]=$("#"+a+".ui-page-active").length>0||!ei("ontop")),h)&&(!l||ut.indexOf(i._id)>=0)&&(gr(n)?(c=n._lastResult,n.loadOnStart!==!1||n.letters?!l&&c?fu(n,s,c):eu(n,s):delete n.loadOnStart):(e=r[i._id],e===undefined&&(e=r[i._id]=i.data()),e=i.extension().commandRow()?e:null,n._hasFields&&s.css("display",e?"":"none"),ii(e,i),ru(n,o,e),ii(e)))}),ut.splice(0),e!==t.offset().top&&n!==!1&&nr())}function su(n,t){var i=n.css("background-color").match(/^rgba?\((\d+,\s*\d+,\s*\d+)/);i&&n.css("background-color",typeof t=="number"?"rgba("+i[1]+","+t+")":"rgb("+i[1]+")")}function rr(){c&&c.focus()}function ur(i){var f=e.error(),r=f,u,s=t.runOnce;i=r?!1:typeof i=="boolean"?i:!0;t.input.barcode!=null&&(i||(u=t.input.barcode,r=r?u+" > "+r:u));t=null;r!=null&&w(r,!0,f?3e4:null);k(!1);o.barcode(!0);o.barcode().length||(s?(clearTimeout(hr),n.kiosk()?n.kiosk("focus"):hr=setTimeout(o.focus,200,{lastFocused:!0})):ft({runOnce:!0}))}function fr(){if(t.error)b()||t.discarding?setTimeout(fr,nt):ur();else{t.index++;var n=(new Date).getTime();n-oi>16?(oi=n,setTimeout(kt,nt)):kt()}}function kt(i){var s=f.ifThisThenThat(),h,u,r,o;if(i){if(t&&!s.length)return;if(r=n.dataView(),o=i.id,u=b(),pi(r)!==r&&(ni(!0)?(u=!0,i._notified||(w(rt.Reading,!0,3e4),i._notified=!0)):i.input.barcode&&(w(!1),n.goBack(),u=!0)),r&&r._inlineEditor)if(ni(!0))u=!0;else{r.tag("discard-changes-prompt-none");n.goBack(function(){setTimeout(kt,nt,i)});return}if(u){setTimeout(kt,nt,i);return}t=i;o&&s.every(function(n,i){return n.id===o&&(t.index=i),t.index==null});t.index==null&&(oi=(new Date).getTime(),t.index=0);k(!0)}else if(!t)return;if(t.context=new d,t.index<s.length)if(h=s[t.index],h.background||o&&h.id===o){et=$.Deferred();$.when(et).then(ur).fail(fr);try{h.execute(e,t.context).done(st).fail(yi)}catch(c){st(c)}}else fr();else ur(!1),ft()}function ft(n){n||(n={});var u=n.id||n.input||n.runOnce,i=f.ifThisThenThat._interval,r;n.input||(n.input={});"numpad"in n||(a=er(a),n.input.numpad=a,String.isNullOrEmpty(a)||(r=parseFloat(a),n.input["numpad.number"]=isNaN(r)?null:r,n.input["numpad.date"]=Date.tryParseFuzzyDate(a),n.input["numpad.time"]=Date.tryParseFuzzyTime(a)));clearTimeout(si);u?si=b()||t?setTimeout(ft,96,n):setTimeout(kt,n.interval||0,n):i&&(n.interval=i,i&&ft(n))}function ff(){var u=f.odp.offline("icon"),r=[],t,i,e;if(n.navContext(r),u)for(t=0;t<r.length;t++)if(i=r[t],i.icon===u){e=!0;break}e?i.callback(i.context):f.alert(ht.ODP.SaveAndSync)}function ef(){w("Not supported.")}function of(){var n=[],t;f.odp.offline()&&(vi.icon=f.odp.offline("icon")||"material-icon-cloud",vi.tooltip=f.odp.offline("tooltip"),n.push(vi));f.host&&n.push(wu);r.find("> .app-btn").each(function(i){var u=$(this),r=n[i];i<n.length?(u.data("btn",r).show().attr("data-title",r.tooltip).find("i").css("transform",r.transform||"").text(r.icon.replace("material-icon-","").replace("-","_")),t=u):u.hide()});t&&r.find(".app-logo").css("right",r.width()-t.offset().left)}function sf(){l.one("touchinit.app",function(){n.kiosk(y("kiosk.enabled"))}).on("pagereadycomplete.app",function(){if(r)if(gt){var i=n.pageInfo();i&&!i.home||t?ot(at()):l.trigger("ifttt.app")}else gi(""),gt=!0;else gt=!0}).on("barcode.app",function(n){if(!n.isDefaultPrevented()&&f.ifThisThenThat().length)return t?o.barcode().push(n.text):ft({input:{barcode:n.text}}),!1}).on("ifttt.app",function(n,t){var i=n.ifThis||t;ft({id:i,runOnce:i==null});sr=!0}).on("vclick",".app-kiosk .app-avatar",function(){return setTimeout(function(){$(".app-bar-toolbar .app-avatar").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-btn-context",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-context").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-logo",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-menu").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-login",function(){return n.showAccountManager(null,!0),!1}).on("vclick",".app-kiosk .app-button",function(){var t=$(this);return b()||k()||(n.callWithFeedback(t),setTimeout(cf,0,t)),!1}).on("vclick",".app-kiosk .app-numpad .app-btn, .app-kiosk .app-numpad .app-text i",function(){var t=$(this);return b()||k()||(n.callWithFeedback(t),setTimeout(af,0,t)),!1}).on("vclick",".app-kiosk .app-item",function(t){var i=$(this),o=$(t.target).closest('[data-name=">"]'),f,u,r,e;return o.length?(f=i.data("config"),u=i.data("obj"),r=!u[">"],u[">"]=r,f._expanded[uu(f,u).key.toString()]=r,i.toggleClass("app-collapsed",!r),e=o.find(".app-value"),e.find("i").text("expand_"+(r?"less":"more")),n.toggleTooltip(e,r)):(n.callWithFeedback(i),b()||k()||(i.is(".app-selected")?fi(i.parent()):setTimeout(hf,0,i))),!1}).on("vclick",".app-kiosk .app-tabset .app-text",function(){var n=$(this),r=n.parent().find(".app-text"),t=[n.addClass("app-selected")],i=n.prevAll(".app-text"),u=i.length?i.last():n;return r.each(function(i){var r=$(this);r.is(n)?v(u.data("config"),"selectedTab",i):t.push(r.removeClass("app-selected"))}),t.forEach(function(n,t){var i=!n.prev().length;n.data("tab").forEach(function(r,u){var f=i&&!u?n.parent().nextAll():r;f.toggleClass("app-hidden",!!t)})}),nr(),!1}).on("vclick",".app-row-pager .app-btn",function(){var t=$(this);return b()||k()||t.is(".app-disabled")||(n.callWithFeedback(t),setTimeout(lf,0,t)),!1}).on("vclick",".app-kiosk .app-letters span",function(){var r=$(this),u=r.parent(),i=u.data("config"),e=u.data("letters"),n,o=v(i,"beginsWithLetter"),t=i._inDataView,f=e.field;return u.find(".app-selected").removeClass("app-selected"),r.addClass("app-selected"),t&&(n=r.text(),n===o&&(n=null),v(i,"beginsWithFilter",n==null?null:f+":$beginswith$%js%"+JSON.stringify(n)),v(i,"beginsWithLetter",n),t.removeFromFilter(f),n==null?t.sync():t.applyFilter(t.findField(f),"$beginswith$",n)),!1}).on("vclick",".app-kiosk > .app-btn",function(){var n=$(this).data("btn");return setTimeout(n.exec),!1}).on("dataviewrefresh.app datainputbroadcast.app",wt).on("themechanged.app",pt).on("useravatarchanged.app",function(){r&&f.AccountManager.avatar(f.userName(),r.find("> .app-avatar i"))});lu.on("throttledresize",pt)}function hf(n){n.parent().find(".app-item").removeClass("app-selected");n.addClass("app-selected");dr(lt(n.data("id")),n.data("obj"),{},{})}function hu(n){var t;return g(u.data("config"),function(i){return g(i,function(i,r){if(r===n)return t=i,!1},!1),t?!1:void 0},!1),t}function cf(n){var r=n.data("obj"),a=n.data("contextItem"),k=r.barcode,u=r.perform,f,e,s,c,i,t,l,y,b;a?a.callback(a.context):(u&&(typeof u=="function"?u(r):(e=u.pick,s=u.show,c=u.hide,e&&(t=p(h({selector:e})),t&&(y=t.Type.match(/^Date/),t=t._dataView._allFields[t.OriginalIndex],(t.ItemsStyle||y)&&(f=!0,o.focus({field:t}),l=$('.ui-page-active [data-field="'+t.Name+'"]'),b=l.find(".app-data-input-button"),y?(l.trigger("vclick"),setTimeout(w,0,r._label||t.HeaderText,!0)):b.length?b.trigger("vclick"):o.methods.lookup.click($.Event("vclick",{target:l})))),f||w("pick: "+e,!0)),!f&&s&&(i=hu(s),i&&!i.visible&&(i.visible=!0,v(r,"checked",c!=null?!0:null),pt(!0),f=!0)),!f&&c&&(i=hu(c),i&&i.visible&&(i.visible=!1,v(r,"checked",s!=null?!1:null),pt(!0),f=!0)))),k!=null&&o.barcode(k))}function lf(n){var r=n.closest(".app-row-pager"),u=n.closest(".app-container"),t=r.data("config"),i=t._lastResult.pageIndex;eu(t,u,n.is(".app-next")?++i:--i)}function af(n){n=$(n);var f=n.closest(".app-numpad"),i=n.data("key"),e=n.data("test"),t=f.data("text"),u,r,s;t==null&&(t="");u=$.Event("numpadkey.app",{numPad:f,key:i,text:t});l.trigger(u);u.isDefaultPrevented()||(i=u.key,t=u.text,r=t.length,i==="BackSpace"?t.length&&(t=t.substring(0,r-1)):i==="Enter"?r&&(t!==er(t)?t=er(t):(o.barcode(t),t="")):i==="PlusMinus"?r<1?t="-":(s=t[r-1],t.match(/\W$/)?t=t.substring(0,r-1)+(s==="+"?"-":"+"):t+="+"):i==="*"?r&&(t.match(/\W$/)?t=t.substring(0,r-1)+"*":t+="*"):i==="abc"||(i==="Clear"?t="":i!=null&&(e==null||ai[e](t))&&(t+=i)),cu(t))}function er(n){var u=0,f=/((-|\+).+?)(-|\+|$)/,t,e,r,o=/(\*(.+?))(\*|$)/,i;if(!String.isNullOrEmpty(n)&&n.substring(1).match(/(-|\+|\*)/)){for(n.match(/^(-|\+)/)||(n="+"+n),t=n.match(f);t;){for(r=1,t=t[1],n=n.substring(t.length),e=t[0]==="+"?1:-1,t=t.substring(1),t.match(/^\*/)||(t="*"+t),i=t.match(o);i;)i=i[1],t=t.substring(i.length),i=i.substring(1),r*=Number.parseLocale(i),i=t.match(o);u+=e*r;t=n.match(f)}n=u.toString()}return n}function cu(n){n==null&&(n="");a=n.toString();c.find(".app-numpad").data("text",a).find(".app-text").toggleClass("app-null",!a.length).find(".app-value").text(a)}var e,f=$app,n,o,ei,et,t,nt=16,oi,tt=$("body"),l=$(document),lu=$(window),dt,gt,si,or,sr,r,u,c,hi,hr,ht=Web.DataViewResources,rt=ht.Mobile,ci=ht.Pager,cr=ht.Form,au=ht.Data.NullValueInForms,vu=/^(tn|xxs|xs|sm|md|lg|xl|xxl)?(_)?(tn|xxs|xs|sm|md|lg|xl|xxl)?$/,li=["selector","value","regex","inSelector","inRegex","qualifier","_extended"],yu=[],ut=[],ct,it,a,ai=[],pu=0,lr={},lt=f.findDataView,vi={exec:ff},wu={icon:"line_weight",tooltip:"Scan",transform:"rotate(270deg)",exec:ef};standardNumPadButtons=[[{key:"7"},{key:"8"},{key:"9"},{key:"BackSpace",icon:"backspace",dark:!0}],[{key:"4"},{key:"5"},{key:"6"},{key:"PlusMinus",text:String.fromCharCode(177),dark:!0}],[{key:"3"},{key:"2"},{key:"1"},{key:"*",dark:!0}],[{key:"0",width:2},{key:function(){return Sys.CultureInfo.CurrentCulture.numberFormat.NumberDecimalSeparator},test:function(n){return!n.match(/(\.|\.\d+)$/)}},{key:"abc",font:"1em",dark:!0}],[{key:"Enter",icon:"keyboard_return",accent:!0}]];d.prototype={deferred:function(n,t){var i=this._deferred;if(n&&n.match(/^:/))return n=n.substring(1),i.state()===n;if(n==="resolve")i.resolve(t);else if(n==="reject")i.reject(t);else if(n==="pending")this._deferred=$.Deferred();else return i},_generic:function(n,t,i){var r=this,f=r._andNot,u;return r.deferred(":rejected")||(r=new d(r),n=h(n,i),u=t(n,r),u&&u.then?r.pending(u):(f&&(u=!u,r._andNot=!1),u?r.deferred("resolve",u):r.deferred("reject",n))),r},pending:function(n){if(arguments.length)this._pending.push(n);else return this._pending},not:function(){var n=this;return n._andNot=!0,n},page:function(n){return this._generic(n,function(n){var t=Web.Menu.currentNode,u=n.identifier,i,r;if(t)if(i=t.title,u)t.url===f.resolveClientUrl(u)&&(r=!0);else if(i!=null)try{r=i.match(n.regex)}catch(e){}return r})},controller:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=yt(n);return t&&(i=r?t._controller===r:t.get_view().Label.match(n.regex)),i})},view:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=yt(n),u=n.selector;return t&&(i=r?t._viewId===r:u.match(/^:/)?t.extension().viewStyle().toLowerCase()===u.substring(1).toLowerCase():t.get_view().Label.match(n.regex)),i})},form:function(){return this.view(":form")},list:function(){return this.not().form()},field:function(n){return this._generic(n,function(n){return p(n)})},action:function(n){n=h(n,arguments,2);var t=this._andNot;return this._generic(n,function(n,i){var r=i.deferred();return bi(n,r,!1,function(i){var r=ki(i,n);return t&&(r=!r),r==null?!1:r}),r.promise()})},input:function(n,i){return n!=null&&(arguments.length<2?i=n.test:n.test=i),!i||i instanceof RegExp||typeof i=="function"||(i=new RegExp(RegExp.escape(i),"i")),this._generic(n,function(n){var r,u=n.selector,f;if(u==="")for(f in t.input){u=f;break}return t&&(r=t.input[u],i&&(typeof i=="function"?r=i(r):r!=null&&typeof r=="string"&&(r=r.match(i)))),r})},barcode:function(n){var t={selector:"barcode"};return arguments.length>0&&(t.test=n),this.input(t)},display:function(n){return this._generic({},function(){return typeof n=="string"&&(n={id:n}),u!=null&&n===u.data("display")})},reading:function(n){return this.not().editing(n)},editing:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.editing()})},inserting:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.inserting()})},val:function(n,t){var r=this,i;return n!=null&&(arguments.length<2?(i=typeof n=="object"&&"test"in n,t=n.test):(n.test=t,i=!0)),r._generic(n,function(n){var r,u=p(n),f;return u&&(f=u._dataView.data(),r=f[u.Name],i&&(t instanceof RegExp?r!=null&&(r=r.toString().match(t)):t==null?r=r==null:typeof t=="function"?r=t(r):retult=r===t)),r})},row:function(n){var i=this._andNot;return this._generic(n,function(n,r){var u=r.deferred();return bi(n,u,!1,function(r,u){var o={},s;if(r){if(o=kr(n,"context:row"),!o)return!1;if(s=t.input[JSON.stringify(o)],s)return s;f.execute({controller:r._controller,view:r._viewId,externalFilter:r.get_externalFilter(),filter:o,odp:!0}).done(function(f){var e=f[r._controller],s=n._extended.mapped?n.qualifier:n.selector,c,h;if(s=s?s+=".":"",e&&e.length){e=e[0];t.input[JSON.stringify(o)]=e;for(c in e)t.input[s+c]=e[c];h=e}i&&(h=!h);h?u.resolve(e):u.reject()}).fail(function(t){e.error("context.row: "+t.get_message()+"\n"+ti(n));st(!1)})}else e.error("context.row: Data view "+(n.in||"")+" is not found."),yi(!1);return u}),u},arguments)},confirm:function(i){return this._generic(i,function(i,r){function e(n){var t=n.text===s;return setTimeout(function(){t?f.action({path:"form/submit"}):history.go(-1)}),!1}var u=r.deferred(),o=i.selector,s=t.context.barcode().unwrap();s&&(o+="\r\n"+rt.ScanToConfirm);l.on("barcodebefore.app",e);return vt(!0),n.whenPageShown(yr),f.confirm(o).then(function(){l.off("barcodebefore.app",e);u.resolve()}).fail(function(){l.off("barcodebefore.app",e);u.reject()}),u})},key:function(n){return typeof n=="string"&&(n={"in":n}),this._generic(n,function(n){var i,r=yt(n),t;return r&&(t=r.get_selectedKey(),t.length&&(i=t.length===1?t[0]:t)),i})},unwrap:function(){var t=this.deferred(),n;return $.when(t).then(function(t){n=t}),n},toString:function(){return this.unwrap()}};e={"if":function(){function h(){t.context._andNot=null;f.resolve()}function e(){f.reject()}for(var n,s,u,r=!0,f=$.Deferred(),i=[],o=0;o<arguments.length;o++)if(n=arguments[o],n instanceof d)if(n.deferred(":rejected")){r=!1;break}else s=n.pending(),s.length&&(i=i.concat(s));else if(n&&n.promise)i.push(n);else if(typeof n=="function"){if(u=n(),u&&u.promise)i.push(u);else if(!u){r=!1;break}}else if(!n){r=!1;break}return r?i.length?$.when.apply($,i).then(function(){for(var n=0;n<i.length;n++)if(i[n].state()!=="resolved"){r=!1;break}r?h():e()}).fail(function(){e()}):h():e(),f.promise()},resolve:function(){return st(),$.when(!0)},reject:function(){return yi(),$.when(!0)},discard:function(i){var r=$(".app-ui-automation-root").attr("id");return t.error=i,t.discarding=!0,e._exec(function(i){function u(){var f=n.dataView(),e;f?f._id===r?(wt({dataView:f}),t.discarding=!1,i.resolve()):(e=f._parentDataViewId,e&&wt({dataView:lt(e)}),f.get_isForm()&&f.tag("discard-changes-prompt-none"),n.goBack(u)):i.resolve()}return u(),!1})},notify:function(n,t){return n instanceof d&&(n=n.unwrap()),typeof n!="object"&&(n={text:n,force:!0,duration:t}),e._exec(function(){w(n)})},_wait:function(n){n.resolve&&(n={deferred:n,attempts:0});var r=n.deferred,i=ni();if(b()||i)i&&!n.notified&&(t.confirmed?t.confirmed=!1:o.barcode().length&&(w(rt.Reading,!0,3e4),n.notified=!0)),n.attempts++,setTimeout(e._wait,nt,n);else{n.notified&&w(!1);try{r.resolve()}catch(u){st(u)}}},_exec:function(n){var i=$.Deferred(),r=arguments.length>1&&arguments[0];return r?bi(r,i,!0,arguments[1]):n(i)!==!1&&(t.error?i.reject():setTimeout(e._wait,nt,i)),i.promise()},error:function(n){if(arguments.length)typeof n=="object"&&n.message&&(n=n.message+"\n"+n.stack),typeof n=="string"&&(n={error:n}),t&&(t.error=n.error);else return t.error},action:function(n){return n=h(n,arguments,2),e._exec(n,function(t){var i=ki(t,n),r=i&&i.callback;r?r(i.context):e.error('app.action: "'+n.selector+'" is not available in the context'+(n.in?' "'+n.in+'"':"")+".")})},_countBarcodes:function(n){var r=1,t;if(n!=null){for(n instanceof d&&(n=n.unwrap()),t=o.barcode(),i=0;i<t.length&&t[i++]===n;)r++;t.splice(0,r-1)}return r},inc:function(n,t){n=h(n);var r=p(n),u,i,f=n._method||"inc";if(r)return u=r._dataView.data(),n=r.Name,i=u[n],i==null&&(i=0),i+=e._countBarcodes(t)*(f==="inc"?1:-1),e.val(n,i);e.error("app."+f+": Failed to change "+ti(n))},dec:function(n){return arguments[0]=n=h(n),n._method="dec",e.inc.apply(e,arguments)},val:function(n){return n=h(n,arguments),delete n.in,e._exec(function(t){function y(n,t,i){n.map[t]=i;n.reverseMap[i]=t;a[t]=n}function w(n){o.execute(i);n!==!1&&t.resolve(i)}var s=p(n),c,l,i=[],r=[],a={},v=[],u;if(s){if(l=s._dataView,n._extended.mapped)for(u in n)li.indexOf(u)<0&&(c=p(h({selector:u})),c?i.push({field:c,value:n[u]}):r.push('"'+u+'"'));else i.push({field:s,value:n.value});if(i.forEach(function(n){n.value instanceof d&&$.when(n.value.deferred()).done(function(t){n.value=t})}),!r.length){if(l._allFields.forEach(function(n){if(n.ItemsStyle&&n.ItemsDataController){var i={field:n,map:{},reverseMap:{}},r=n.Copy,t,u=f._fieldMapRegex;if(y(i,n.Name,n.ItemsDataValueField),y(i,l._allFields[n.AliasIndex].Name,n.ItemsDataTextField),r)for(t=u.exec(r);t;)y(i,t[1],t[2]),t=u.exec(r)}}),i.forEach(function(n){var r=a[n.field.Name],o,s,h,c={},u,l;r&&!r.pending&&(o=r.field,s=o.ItemsDataController,ItemsDataView=o.ItemsDataView,i.forEach(function(n){a[n.field.Name]===r&&(c[r.map[n.field.Name]]=n.value)}),u={controller:s,filter:c,odp:!0},h&&(u.view=h),l=ti(u),r.pending=f.execute(u).done(function(n){var u=n[s],f;if(u&&u.length)for(f in r.reverseMap)i.push({field:r.reverseMap[f],value:u[0][f]});else e.error("app.val: failed to lookup \n"+l),t.reject(i)}),v.push(r.pending))}),v.length)return $.when.apply($,v).done(w).fail(function(n){i.forEach(function(n){var t=n.field.Name;t&&(n.field=t)});e.error("app.val: failed to lookup - "+n.get_message()+"\n"+ti(i));t.reject(i)}),!1;w(!1)}}else r.push('"'+n.selector+'"');r.length&&e.error("app.val: "+r.join(", ")+" not found.")})},focus:function(n,t){return n=h(n),arguments.length>1?n.message=t:t=n.message,e._exec(function(){var i=p(n);i?(i=i._dataView._allFields[i.OriginalIndex],i.Type!=="DataView"&&vt(!0),o.focus({field:i,message:t}),vt()):e.error("app.focus: field "+n.selector+" not found.")})},confirm:function(i){var r=t.context.barcode().unwrap(),s,u;if(r&&(u=o.barcode(),u.length))for(s=!0;u[0]===r;)u.splice(0,1);return e._exec(function(u){function o(i){var u=i.text===r;return t.confirmed=!0,setTimeout(function(){n.isInTransition()||(u?f.action({path:"form/submit"}):history.go(-1))}),!1}if(s)return!0;if(vt(!0),n.whenPageShown(yr),r){l.on("barcodebefore.app",o);i+="\n\n"+rt.ScanToConfirm}return f.confirm(i).then(function(){l.off("barcodebefore.app",o);u.resolve(i)}).fail(function(){l.off("barcodebefore.app",o);e.resolve();u.reject(i)}),!1})},row:function(n){return n=h(n,arguments),e._exec(function(){function a(){o.focus({field:s})}var c=n._extended,u=c.method||"row",v=u==="filter",f=kr(n,u),i,s,h,r;if(!f)return!1;if(h=JSON.stringify(f),r=t.input[h],!r&&v&&(r={}),r){if(i=yt(n),i&&(dr(i,r,f,c),s=i._dataViewFieldName,s))if(i._busy())l.one("dataviewrefresh.app",a);else a();return i}e.error("app."+u+": This method requires a data row in the input.\n Specify 'app.if(context.row("+h+"))' in the activity. Use the same filter when invoking '"+u+"' method.")})},rowFilter:function(n){return n=h(n,arguments),n._extended.method="rowFilter",n._extended.filter=!0,this.row(n)},filter:function(n){return n=h(n,arguments),n._extended.method="filter",n._extended.filter=!0,this.row(n)},input:function(n,i){var u=n,f,e;u==null&&(u={});typeof n!="object"&&(u={},u[n]=i);for(f in u)e=u[f],t.input[f]=e,f==="numpad"&&r&&cu(e)},display:function(t){function i(){f.resolve()}function s(n){e.error("app.display: "+n);f.reject()}var f=$.Deferred(),o,h;return arguments.length?u&&t===u.data("display")?u.is(":visible")?i():u.fadeIn("fast",i):(h=r!=null,y("kiosk.enabled")!==!1?(n.kiosk(!0),u.empty().data("display",t),o=gi(t),h?(u.hide(),u.fadeIn("fast")):(r.hide(),r.fadeIn("fast")),o?s(o):i()):i()):s("Missing display configuration."),f.promise()},page:function(n){function r(u){u.every(function(u){var e=u.title;if(i)u.url===f.resolveClientUrl(i)&&(t=u);else if(e!=null)try{e.match(n.regex)&&(t=u)}catch(o){}return!t&&u.children&&r(u.children),!t})}var i=n.identifier,t;return n=h(n),i=n.identifier,r(Web.Menu.nodes),t&&t.url&&(location.href=t.url),t}};ei=function(){var v=arguments,t,h,i=v[0],f,e,p,l,a;if(v.length&&y("kiosk.enabled")!==!1)if(f=i,e=typeof f=="number"&&f>0&&f<=1?f:!1,e!==!1&&(f=!0),typeof f=="boolean")i?(r||(ot(!0),p=!0,r=s("app-kiosk").attr("tabindex",0).toggleClass("app-fullscreen",y("kiosk.fullscreen")===!0),l=y("kiosk.density"),l&&r.addClass("app-density-"+l),a=vr(),a.length?r.insertAfter(a):r.appendTo(tt),bu(),tt.addClass("app-is-kiosk")),e!==!1&&su(r,e),rr(),sr&&p&&!k()&&ft({runOnce:!0})):r&&(ot(!1),r.remove(),r=null,u=null,c=null,_displayId=null,tt.removeClass("app-is-kiosk"),n.resetUI(),$(".ui-page-active .app-wrapper").focus(),o.focus({lastFocused:!0}));else if(typeof i=="string"&&r){if(i==="get")return!gt||tt.is(".app-ui-automation:not(.app-ui-automation-system)")?r:null;if(i==="ontop")return at();i==="focus"?(t=at(),t||(h=n.pageInfo(),h&&h.home&&(t=!0)),t&&rr()):i==="refresh"&&of()}return t==null&&(t=r!=null),t};l.on("beforetouchinit.app",function(){n=f.touch;o=f.input;n.kiosk=ei;it=n.settings;logicalWidthArray=n.toWidth();n&&y("enabled")===!0&&sf()})})();